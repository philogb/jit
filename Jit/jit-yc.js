/*
Copyright (c) 2013 Sencha Inc. - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

 */
 
(function(){this.$jit=function(F){F=F||window;for(var G in $jit){if($jit[G].$extend){F[G]=$jit[G]}}};$jit.version="2.0.1";var e=function(F){return document.getElementById(F)};e.empty=function(){};e.extend=function(H,F){for(var G in (F||{})){H[G]=F[G]}return H};e.lambda=function(F){return(typeof F=="function")?F:function(){return F}};e.time=Date.now||function(){return +new Date};e.splat=function(G){var F=e.type(G);return F?((F!="array")?[G]:G):[]};e.type=function(G){var F=e.type.s.call(G).match(/^\[object\s(.*)\]$/)[1].toLowerCase();if(F!="object"){return F}if(G&&G.$$family){return G.$$family}if(G&&G.nodeType==9){return"htmldocument"}return(G&&G.nodeName&&G.nodeType==1)?"element":F};e.type.s=Object.prototype.toString;e.each=function(K,J){var I=e.type(K);if(I=="object"){for(var H in K){J(K[H],H)}}else{for(var G=0,F=K.length;G<F;G++){J(K[G],G)}}};e.indexOf=function(I,H){if(I.indexOf){return I.indexOf(H)}for(var G=0,F=I.length;G<F;G++){if(I[G]===H){return G}}return -1};e.map=function(H,G){var F=[];e.each(H,function(J,I){F.push(G(J,I))});return F};e.reduce=function(J,H,G){var F=J.length;if(F==0){return G}var I=arguments.length==3?G:J[--F];while(F--){I=H(I,J[F])}return I};e.merge=function(){var J={};for(var I=0,F=arguments.length;I<F;I++){var G=arguments[I];if(e.type(G)!="object"){continue}for(var H in G){var L=G[H],K=J[H];J[H]=(K&&e.type(L)=="object"&&e.type(K)=="object")?e.merge(K,L):e.unlink(L)}}return J};e.unlink=function(H){var G;switch(e.type(H)){case"object":G={};for(var J in H){G[J]=e.unlink(H[J])}break;case"array":G=[];for(var I=0,F=H.length;I<F;I++){G[I]=e.unlink(H[I])}break;default:return H}return G};e.zip=function(){if(arguments.length===0){return[]}for(var H=0,G=[],F=arguments.length,K=arguments[0].length;H<K;H++){for(var I=0,J=[];I<F;I++){J.push(arguments[I][H])}G.push(J)}return G};e.rgbToHex=function(J,I){if(J.length<3){return null}if(J.length==4&&J[3]==0&&!I){return"transparent"}var G=[];for(var F=0;F<3;F++){var H=(J[F]-0).toString(16);G.push(H.length==1?"0"+H:H)}return I?G:"#"+G.join("")};e.hexToRgb=function(H){if(H.length!=7){H=H.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);H.shift();if(H.length!=3){return null}var F=[];for(var G=0;G<3;G++){var I=H[G];if(I.length==1){I+=I}F.push(parseInt(I,16))}return F}else{H=parseInt(H.slice(1),16);return[H>>16,H>>8&255,H&255]}};e.destroy=function(F){e.clean(F);if(F.parentNode){F.parentNode.removeChild(F)}if(F.clearAttributes){F.clearAttributes()}};e.clean=function(I){for(var H=I.childNodes,G=0,F=H.length;G<F;G++){e.destroy(H[G])}};e.addEvent=function(H,G,F){if(H.addEventListener){H.addEventListener(G,F,false)}else{H.attachEvent("on"+G,F)}};e.addEvents=function(G,H){for(var F in H){e.addEvent(G,F,H[F])}};e.hasClass=function(G,F){return(" "+G.className+" ").indexOf(" "+F+" ")>-1};e.addClass=function(G,F){if(!e.hasClass(G,F)){G.className=(G.className+" "+F)}};e.removeClass=function(G,F){G.className=G.className.replace(new RegExp("(^|\\s)"+F+"(?:\\s|$)"),"$1")};e.getPos=function(H){var K=J(H);var F=I(H);return{x:K.x-F.x,y:K.y-F.y};function J(M){var L={x:0,y:0};while(M&&!G(M)){L.x+=M.offsetLeft;L.y+=M.offsetTop;M=M.offsetParent}return L}function I(M){var L={x:0,y:0};while(M&&!G(M)){L.x+=M.scrollLeft;L.y+=M.scrollTop;M=M.parentNode}return L}function G(L){return(/^(?:body|html)$/i).test(L.tagName)}};e.getDir=function(H){var G=document.getElementById(H)||document.body;if(G.currentStyle){var F=G.currentStyle.direction}else{if(window.getComputedStyle){var F=document.defaultView.getComputedStyle(G,null).getPropertyValue("direction")}}return F};e.event={get:function(G,F){F=F||window;return G||F.event},getWheel:function(F){return F.wheelDelta?F.wheelDelta/120:-(F.detail||0)/3},isRightClick:function(F){return(F.which==3||F.button==2)},getPos:function(I,H){H=H||window;I=I||H.event;var G=H.document;G=G.documentElement||G.body;if(I.touches&&I.touches.length){I=I.touches[0]}var F={x:I.pageX||(I.clientX+G.scrollLeft),y:I.pageY||(I.clientY+G.scrollTop)};return F},stop:function(F){if(F.stopPropagation){F.stopPropagation()}F.cancelBubble=true;if(F.preventDefault){F.preventDefault()}else{F.returnValue=false}}};$jit.util=$jit.id=e;var v=function(G){G=G||{};var F=function(){for(var J in this){if(typeof this[J]!="function"){this[J]=e.unlink(this[J])}}this.constructor=F;if(v.prototyping){return this}var I=this.initialize?this.initialize.apply(this,arguments):this;this.$$family="class";return I};for(var H in v.Mutators){if(!G[H]){continue}G=v.Mutators[H](G,G[H]);delete G[H]}e.extend(F,this);F.constructor=v;F.prototype=G;return F};v.Mutators={Implements:function(F,G){e.each(e.splat(G),function(I){v.prototyping=I;var H=(typeof I=="function")?new I:I;for(var J in H){if(!(J in F)){F[J]=H[J]}}delete v.prototyping});return F}};e.extend(v,{inherit:function(F,I){for(var H in I){var G=I[H];var K=F[H];var J=e.type(G);if(K&&J=="function"){if(G!=K){v.override(F,H,G)}}else{if(J=="object"){F[H]=e.merge(K,G)}else{F[H]=G}}}return F},override:function(G,F,J){var I=v.prototyping;if(I&&G[F]!=I[F]){I=null}var H=function(){var K=this.parent;this.parent=I?I[F]:G[F];var L=J.apply(this,arguments);this.parent=K;return L};G[F]=H}});v.prototype.implement=function(){var F=this.prototype;e.each(Array.prototype.slice.call(arguments||[]),function(G){v.inherit(F,G)});return this};$jit.Class=v;$jit.json={prune:function(G,F){this.each(G,function(I,H){if(H==F&&I.children){delete I.children;I.children=[]}})},getParent:function(F,J){if(F.id==J){return false}var I=F.children;if(I&&I.length>0){for(var H=0;H<I.length;H++){if(I[H].id==J){return F}else{var G=this.getParent(I[H],J);if(G){return G}}}}return false},getSubtree:function(F,J){if(F.id==J){return F}for(var H=0,I=F.children;I&&H<I.length;H++){var G=this.getSubtree(I[H],J);if(G!=null){return G}}return null},eachLevel:function(F,K,H,J){if(K<=H){J(F,K);if(!F.children){return}for(var G=0,I=F.children;G<I.length;G++){this.eachLevel(I[G],K+1,H,J)}}},each:function(F,G){this.eachLevel(F,0,Number.MAX_VALUE,G)}};var D;(function(){function K(M){return document.getElementById(M)}K.empty=function(){};K.time=Date.now;K.uid=(function(){var M=K.time();return function(){return M++}})();K.extend=function(O,N){for(var M in N){O[M]=N[M]}return O};K.type=(function(){var N=Object.prototype.toString,M=function(P){var O=N.call(P);return O.substr(8,O.length-9).toLowerCase()};return function(O){var P=M(O);if(P!="object"){return P}if(O.$$family){return O.$$family}return(O&&O.nodeName&&O.nodeType==1)?"element":P}})();(function(){function M(R){var Q=K.type(R),O;if(Q=="object"){O={};for(var S in R){O[S]=M(R[S])}return O}else{if(Q=="array"){O=[];for(var P=0,N=R.length;P<N;P++){O[P]=M(R[P])}return O}else{return R}}}K.merge=function(){var R={};for(var Q=0,N=arguments.length;Q<N;Q++){var O=arguments[Q];if(K.type(O)!="object"){continue}for(var P in O){var T=O[P],S=R[P];if(S&&K.type(T)=="object"&&K.type(S)=="object"){R[P]=K.merge(S,T)}else{R[P]=M(T)}}}return R}})();K.splat=(function(){var M=Array.isArray;return function(N){return M(N)&&N||[N]}})();D=function(M){this.opt=K.merge({delay:0,duration:1000,transition:function(N){return N},compute:K.empty,complete:K.empty},M||{})};var I=D.Queue=[];D.prototype={time:null,start:function(M){this.opt=K.merge(this.opt,M||{});this.time=K.time();this.animating=true;I.push(this)},setOptions:function(M){this.opt=K.merge(this.opt,M||{});return this},pause:function(){this.animating=false},stopTimer:function(){this.animating=false},step:function(){if(!this.animating){return}var O=K.time(),Q=this.time,N=this.opt,M=N.delay,P=N.duration,R=0;if(O<Q+M){N.compute.call(this,R);return}if(O<Q+M+P){R=N.transition((O-Q-M)/P);N.compute.call(this,R)}else{this.animating=false;N.compute.call(this,1);N.complete.call(this)}}};D.compute=function(O,N,M){return O+(N-O)*M};D.Transition={linear:function(M){return M}};var L=$jit.Trans=D.Transition;(function(){var M=function(Q,P){P=K.splat(P);return K.extend(Q,{easeIn:function(R){return Q(R,P)},easeOut:function(R){return 1-Q(1-R,P)},easeInOut:function(R){return(R<=0.5)?Q(2*R,P)/2:(2-Q(2*(1-R),P))/2}})};var O={Pow:function(Q,P){return Math.pow(Q,P[0]||6)},Expo:function(P){return Math.pow(2,8*(P-1))},Circ:function(P){return 1-Math.sin(Math.acos(P))},Sine:function(P){return 1-Math.sin((1-P)*Math.PI/2)},Back:function(Q,P){P=P[0]||1.618;return Math.pow(Q,2)*((P+1)*Q-P)},Bounce:function(S){var R;for(var Q=0,P=1;1;Q+=P,P/=2){if(S>=(7-4*Q)/11){R=P*P-Math.pow((11-6*Q-11*S)/4,2);break}}return R},Elastic:function(Q,P){return Math.pow(2,10*--Q)*Math.cos(20*Q*Math.PI*(P[0]||1)/3)}};for(var N in O){L[N]=M(O[N])}["Quad","Cubic","Quart","Quint"].forEach(function(Q,P){L[Q]=M(function(R){return Math.pow(R,[P+2])})})})();var H=self||window,F=function(){var P=I;I=[];if(P.length){for(var N=0,M=P.length,O;N<M;N++){O=P[N];O.step();if(O.animating){I.push(O)}}D.Queue=I}};if(H){var J=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(M){if(M in H){D.animationTime=function(){return H[M]};J=true}});if(!J){D.animationTime=K.time}J=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(M){if(M in H){D.requestAnimationFrame=function(N){H[M](function(){F();N()})};J=true}});if(!J){D.requestAnimationFrame=function(M){setTimeout(function(){F();M()},1000/60)}}}(function G(){D.requestAnimationFrame(G)}())}());var q=function(){var H=arguments;for(var J=0,F=H.length,G={};J<F;J++){var I=q[H[J]];if(I.$extend){e.extend(G,I)}else{G[H[J]]=I}}return G};q.AreaChart={$extend:true,animate:true,labelOffset:3,type:"stacked",Tips:{enable:false,onShow:e.empty,onHide:e.empty},Events:{enable:false,onClick:e.empty},selectOnHover:true,showAggregates:true,showLabels:true,filterOnClick:false,restoreOnRightClick:false};q.Margin={$extend:false,top:0,left:0,right:0,bottom:0};q.Canvas={$extend:true,injectInto:"id",type:"2D",width:false,height:false,useCanvas:false,withLabels:true,background:false,Scene:{Lighting:{enable:false,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[0.5,0.3,0.1]}}}};q.Tree={$extend:true,orientation:"left",subtreeOffset:8,siblingOffset:5,indent:10,multitree:false,align:"center",levelSpacing:"even"};q.Node={$extend:false,overridable:false,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:false,autoWidth:false,lineWidth:1,transform:true,align:"center",angularWidth:1,span:1,CanvasStyles:{}};q.Edge={$extend:false,overridable:false,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}};q.Fx={$extend:true,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:true};q.Label={$extend:false,overridable:false,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};q.Tips={$extend:false,enable:false,type:"auto",offsetX:20,offsetY:20,force:false,onShow:e.empty,onHide:e.empty};q.NodeStyles={$extend:false,enable:false,type:"auto",stylesHover:false,stylesClick:false};q.Events={$extend:false,enable:false,enableForEdges:false,type:"auto",onClick:e.empty,onRightClick:e.empty,onMouseMove:e.empty,onMouseEnter:e.empty,onMouseLeave:e.empty,onDragStart:e.empty,onDragMove:e.empty,onDragCancel:e.empty,onDragEnd:e.empty,onTouchStart:e.empty,onTouchMove:e.empty,onTouchEnd:e.empty,onTouchCancel:e.empty,onMouseWheel:e.empty};q.Navigation={$extend:false,enable:false,type:"auto",panning:false,zooming:false};q.Controller={$extend:true,onBeforeCompute:e.empty,onAfterCompute:e.empty,onCreateLabel:e.empty,onPlaceLabel:e.empty,onComplete:e.empty,onBeforePlotLine:e.empty,onAfterPlotLine:e.empty,onBeforePlotNode:e.empty,onAfterPlotNode:e.empty,onBeforeRemoveNode:e.empty,request:false};var C={initialize:function(H,F){this.viz=F;this.canvas=F.canvas;this.config=F.config[H];this.nodeTypes=F.fx.nodeTypes;var G=this.config.type;this.dom=G=="auto"?(F.config.Label.type!="Native"):(G!="Native");this.labelContainer=this.dom&&F.labels.getLabelContainer();this.isEnabled()&&this.initializePost()},initializePost:e.empty,setAsProperty:e.lambda(false),isEnabled:function(){return this.config.enable},isLabel:function(K,J,I){K=e.event.get(K,J);var F=this.labelContainer,H=K.target||K.srcElement,G=K.relatedTarget;if(I){return G&&G==this.viz.canvas.getCtx().canvas&&!!H&&this.isDescendantOf(H,F)}else{return this.isDescendantOf(H,F)}},isDescendantOf:function(G,F){while(G&&G.parentNode){if(G.parentNode==F){return G}G=G.parentNode}return false}};var j={onMouseUp:e.empty,onMouseDown:e.empty,onMouseMove:e.empty,onMouseOver:e.empty,onMouseOut:e.empty,onMouseWheel:e.empty,onTouchStart:e.empty,onTouchMove:e.empty,onTouchEnd:e.empty,onTouchCancel:e.empty};var B=new v({initialize:function(F){this.viz=F;this.canvas=F.canvas;this.node=false;this.edge=false;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var H=this.canvas.getElement(),G=this;H.oncontextmenu=e.lambda(false);e.addEvents(H,{mouseup:function(K,J){var I=e.event.get(K,J);G.handleEvent("MouseUp",K,J,G.makeEventObject(K,J),e.event.isRightClick(I))},mousedown:function(K,J){var I=e.event.get(K,J);G.handleEvent("MouseDown",K,J,G.makeEventObject(K,J),e.event.isRightClick(I))},mousemove:function(J,I){G.handleEvent("MouseMove",J,I,G.makeEventObject(J,I))},mouseover:function(J,I){G.handleEvent("MouseOver",J,I,G.makeEventObject(J,I))},mouseout:function(J,I){G.handleEvent("MouseOut",J,I,G.makeEventObject(J,I))},touchstart:function(J,I){G.handleEvent("TouchStart",J,I,G.makeEventObject(J,I))},touchmove:function(J,I){G.handleEvent("TouchMove",J,I,G.makeEventObject(J,I))},touchend:function(J,I){G.handleEvent("TouchEnd",J,I,G.makeEventObject(J,I))}});var F=function(L,K){var J=e.event.get(L,K);var I=e.event.getWheel(J);G.handleEvent("MouseWheel",L,K,I)};if(!document.getBoxObjectFor&&window.mozInnerScreenX==null){e.addEvent(H,"mousewheel",F)}else{H.addEventListener("DOMMouseScroll",F,false)}},register:function(F){this.registeredObjects.push(F)},handleEvent:function(){var G=Array.prototype.slice.call(arguments),J=G.shift();for(var I=0,H=this.registeredObjects,F=H.length;I<F;I++){H[I]["on"+J].apply(H[I],G)}},makeEventObject:function(L,K){var I=this,J=this.viz.graph,H=this.viz.fx,G=H.nodeTypes,F=H.edgeTypes;return{pos:false,node:false,edge:false,contains:false,getNodeCalled:false,getEdgeCalled:false,getPos:function(){var O=I.viz.canvas,P=O.getSize(),Q=O.getPos(),N=O.translateOffsetX,M=O.translateOffsetY,T=O.scaleOffsetX,R=O.scaleOffsetY,S=e.event.getPos(L,K);this.pos={x:(S.x-Q.x-P.width/2-N)*1/T,y:(S.y-Q.y-P.height/2-M)*1/R};return this.pos},getNode:function(){if(this.getNodeCalled){return this.node}this.getNodeCalled=true;for(var P in J.nodes){var O=J.nodes[P],N=O&&G[O.getData("type")],M=N&&N.contains&&N.contains.call(H,O,this.getPos());if(M){this.contains=M;return I.node=this.node=O}}return I.node=this.node=false},getEdge:function(){if(this.getEdgeCalled){return this.edge}this.getEdgeCalled=true;var O={};for(var S in J.edges){var Q=J.edges[S];O[S]=true;for(var R in Q){if(R in O){continue}var P=Q[R],N=P&&F[P.getData("type")],M=N&&N.contains&&N.contains.call(H,P,this.getPos());if(M){this.contains=M;return I.edge=this.edge=P}}}return I.edge=this.edge=false},getContains:function(){if(this.getNodeCalled){return this.contains}this.getNode();return this.contains}}}});var t={initializeExtras:function(){var G=new B(this),F=this;e.each(["NodeStyles","Tips","Navigation","Events"],function(H){var I=new t.Classes[H](H,F);if(I.isEnabled()){G.register(I)}if(I.setAsProperty()){F[H.toLowerCase()]=I}})}};t.Classes={};t.Classes.Events=new v({Implements:[C,j],initializePost:function(){this.fx=this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.hovered=false;this.pressed=false;this.touched=false;this.touchMoved=false;this.moved=false},setAsProperty:e.lambda(true),onMouseUp:function(J,I,G,H){var F=e.event.get(J,I);if(!this.moved){if(H){this.config.onRightClick(this.hovered,G,F)}else{this.config.onClick(this.pressed,G,F)}}if(this.pressed){if(this.moved){this.config.onDragEnd(this.pressed,G,F)}else{this.config.onDragCancel(this.pressed,G,F)}this.pressed=this.moved=false}},onMouseOut:function(K,J,I){var G=e.event.get(K,J),H;if(this.dom&&(H=this.isLabel(K,J,true))){this.config.onMouseLeave(this.viz.graph.getNode(H.id),I,G);this.hovered=false;return}var F=G.relatedTarget,L=this.canvas.getElement();while(F&&F.parentNode){if(L==F.parentNode){return}F=F.parentNode}if(this.hovered){this.config.onMouseLeave(this.hovered,I,G);this.hovered=false}},onMouseOver:function(J,I,H){var F=e.event.get(J,I),G;if(this.dom&&(G=this.isLabel(J,I,true))){this.hovered=this.viz.graph.getNode(G.id);this.config.onMouseEnter(this.hovered,H,F)}},onMouseMove:function(L,K,J){var G,F=e.event.get(L,K);if(this.pressed){this.moved=true;this.config.onDragMove(this.pressed,J,F);return}if(this.dom){this.config.onMouseMove(this.hovered,J,F)}else{if(this.hovered){var M=this.hovered;var I=M.nodeFrom?this.etypes[M.getData("type")]:this.ntypes[M.getData("type")];var H=I&&I.contains&&I.contains.call(this.fx,M,J.getPos());if(H){this.config.onMouseMove(M,J,F);return}else{this.config.onMouseLeave(M,J,F);this.hovered=false}}if(this.hovered=(J.getNode()||(this.config.enableForEdges&&J.getEdge()))){this.config.onMouseEnter(this.hovered,J,F)}else{this.config.onMouseMove(false,J,F)}}},onMouseWheel:function(G,F,H){this.config.onMouseWheel(H,e.event.get(G,F))},onMouseDown:function(J,I,H){var F=e.event.get(J,I),G;if(this.dom){if(G=this.isLabel(J,I)){this.pressed=this.viz.graph.getNode(G.id)}}else{this.pressed=H.getNode()||(this.config.enableForEdges&&H.getEdge())}this.pressed&&this.config.onDragStart(this.pressed,H,F)},onTouchStart:function(J,I,H){var F=e.event.get(J,I),G;if(this.dom&&(G=this.isLabel(J,I))){this.touched=this.viz.graph.getNode(G.id)}else{this.touched=H.getNode()||(this.config.enableForEdges&&H.getEdge())}this.touched&&this.config.onTouchStart(this.touched,H,F)},onTouchMove:function(I,H,G){var F=e.event.get(I,H);if(this.touched){this.touchMoved=true;this.config.onTouchMove(this.touched,G,F)}},onTouchEnd:function(I,H,G){var F=e.event.get(I,H);if(this.touched){if(this.touchMoved){this.config.onTouchEnd(this.touched,G,F)}else{this.config.onTouchCancel(this.touched,G,F)}this.touched=this.touchMoved=false}}});t.Classes.Tips=new v({Implements:[C,j],initializePost:function(){if(document.body){var F=e("_tooltip")||document.createElement("div");F.id="_tooltip";F.className="tip";e.extend(F.style,{position:"absolute",display:"none",zIndex:13000});document.body.appendChild(F);this.tip=F;this.node=false}},setAsProperty:e.lambda(true),onMouseOut:function(I,H){var G=e.event.get(I,H);if(this.dom&&this.isLabel(I,H,true)){this.hide(true);return}var F=I.relatedTarget,J=this.canvas.getElement();while(F&&F.parentNode){if(J==F.parentNode){return}F=F.parentNode}this.hide(false)},onMouseOver:function(H,G){var F;if(this.dom&&(F=this.isLabel(H,G,false))){this.node=this.viz.graph.getNode(F.id);this.config.onShow(this.tip,this.node,F)}},onMouseMove:function(I,H,F){if(this.dom&&this.isLabel(I,H)){this.setTooltipPosition(e.event.getPos(I,H))}if(!this.dom){var G=F.getNode();if(!G){this.hide(true);return}if(this.config.force||!this.node||this.node.id!=G.id){this.node=G;this.config.onShow(this.tip,G,F.getContains())}this.setTooltipPosition(e.event.getPos(I,H))}},setTooltipPosition:function(J){var M=this.tip,F=M.style,N=this.config;F.display="";var G=document.compatMode==="CSS1Compat"&&document.documentElement||document.body||document.documentElement;var K={width:G.clientWidth,height:G.clientHeight,x:window.pageXOffset||document.documentElement&&document.documentElement.scrollLeft||document.body&&document.body.scrollLeft||0,y:window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop||0};var H={width:M.offsetWidth,height:M.offsetHeight};var L=N.offsetX,I=N.offsetY;F.top=((J.y+H.height+I>K.height+K.y)?(J.y-H.height-I):J.y+I)+"px";F.left=((J.x+H.width+L>K.width+K.x)?(J.x-H.width-L):J.x+L)+"px"},hide:function(F){this.tip.style.display="none";F&&this.config.onHide()}});t.Classes.NodeStyles=new v({Implements:[C,j],initializePost:function(){this.fx=this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=false;this.fx.nodeFxAnimation=new D();this.down=false;this.move=false},onMouseOut:function(H,G){this.down=this.move=false;if(!this.hoveredNode){return}if(this.dom&&this.isLabel(H,G,true)){this.toggleStylesOnHover(this.hoveredNode,false)}var F=H.relatedTarget,I=this.canvas.getElement();while(F&&F.parentNode){if(I==F.parentNode){return}F=F.parentNode}this.toggleStylesOnHover(this.hoveredNode,false);this.hoveredNode=false},onMouseOver:function(I,H){var F;if(this.dom&&(F=this.isLabel(I,H,true))){var G=this.viz.graph.getNode(F.id);if(G.selected){return}this.hoveredNode=G;this.toggleStylesOnHover(this.hoveredNode,true)}},onMouseDown:function(J,I,G,H){if(H){return}var F;if(this.dom&&(F=this.isLabel(J,I))){this.down=this.viz.graph.getNode(F.id)}else{if(!this.dom){this.down=G.getNode()}}this.move=false},onMouseUp:function(I,H,F,G){if(G){return}if(!this.move){this.onClick(F.getNode())}this.down=this.move=false},getRestoredStyles:function(G,F){var I={},H=this["nodeStylesOn"+F];for(var J in H){I[J]=G.styles["$"+J]}return I},toggleStylesOnHover:function(F,G){if(this.nodeStylesOnHover){this.toggleStylesOn("Hover",F,G)}},toggleStylesOnClick:function(F,G){if(this.nodeStylesOnClick){this.toggleStylesOn("Click",F,G)}},toggleStylesOn:function(J,F,L){var M=this.viz;var K=this.nStyles;if(L){var I=this;if(!F.styles){F.styles=e.merge(F.data,{})}for(var N in this["nodeStylesOn"+J]){var G="$"+N;if(!(G in F.styles)){F.styles[G]=F.getData(N)}}M.fx.nodeFx(e.extend({elements:{id:F.id,properties:I["nodeStylesOn"+J]},transition:Trans.Quart.easeOut,duration:300,fps:40},this.config))}else{var H=this.getRestoredStyles(F,J);M.fx.nodeFx(e.extend({elements:{id:F.id,properties:H},transition:Trans.Quart.easeOut,duration:300,fps:40},this.config))}},onClick:function(F){if(!F){return}var G=this.nodeStylesOnClick;if(!G){return}if(F.selected){this.toggleStylesOnClick(F,false);delete F.selected}else{this.viz.graph.eachNode(function(I){if(I.selected){for(var H in G){I.setData(H,I.styles["$"+H],"end")}delete I.selected}});this.toggleStylesOnClick(F,true);F.selected=true;delete F.hovered;this.hoveredNode=false}},onMouseMove:function(L,K,I){if(this.down){this.move=true}if(this.dom&&this.isLabel(L,K)){return}var J=this.nodeStylesOnHover;if(!J){return}if(!this.dom){if(this.hoveredNode){var G=this.types[this.hoveredNode.getData("type")];var F=G&&G.contains&&G.contains.call(this.fx,this.hoveredNode,I.getPos());if(F){return}}var H=I.getNode();if(!this.hoveredNode&&!H){return}if(H.hovered){return}if(H&&!H.selected){this.fx.nodeFxAnimation.stopTimer();this.viz.graph.eachNode(function(N){if(N.hovered&&!N.selected){for(var M in J){N.setData(M,N.styles["$"+M],"end")}delete N.hovered}});H.hovered=true;this.hoveredNode=H;this.toggleStylesOnHover(H,true)}else{if(this.hoveredNode&&!this.hoveredNode.selected){this.fx.nodeFxAnimation.stopTimer();this.toggleStylesOnHover(this.hoveredNode,false);delete this.hoveredNode.hovered;this.hoveredNode=false}}}}});t.Classes.Navigation=new v({Implements:[C,j],initializePost:function(){this.pos=false;this.pressed=false},onMouseWheel:function(I,H,F){if(!this.config.enable||!this.config.zooming){return}e.event.stop(e.event.get(I,H));var J=this.config.zooming/1000,G=1+F*J;this.canvas.scale(G,G)},onMouseDown:function(K,J,I){if(!this.config.enable||!this.config.panning){return}K.preventDefault?K.preventDefault():K.returnValue=false;e.addClass(this.canvas.getElement(),"grabbing");if(this.config.panning=="avoid nodes"&&(this.dom?this.isLabel(K,J):(I.getNode()||I.getEdge()))){return}this.pressed=true;this.pos=I.getPos();var H=this.canvas,G=H.translateOffsetX,F=H.translateOffsetY,M=H.scaleOffsetX,L=H.scaleOffsetY;this.pos.x*=M;this.pos.x+=G;this.pos.y*=L;this.pos.y+=F},onMouseMove:function(K,J,M){if(!this.config.enable||!this.config.panning){return}if(!this.pressed){return}if(this.config.panning=="avoid nodes"&&(this.dom?this.isLabel(K,J):M.getNode())){return}var I=this.pos,L=M.getPos(),G=this.canvas,H=G.translateOffsetX,F=G.translateOffsetY,Q=G.scaleOffsetX,O=G.scaleOffsetY;L.x*=Q;L.y*=O;L.x+=H;L.y+=F;var P=L.x-I.x,N=L.y-I.y;this.pos=L;this.canvas.translate(P*1/Q,N*1/O)},onMouseUp:function(I,H,G,F){if(!this.config.panning){return}e.removeClass(this.canvas.getElement(),"grabbing");this.pressed=false}});var p;(function(){var F=typeof HTMLCanvasElement,H=(F=="object"||F=="function");function G(I,J){var K=document.createElement(I);for(var L in J){if(typeof J[L]=="object"){e.extend(K[L],J[L])}else{K[L]=J[L]}}if(I=="canvas"&&!H&&G_vmlCanvasManager){K=G_vmlCanvasManager.initElement(document.body.appendChild(K))}return K}$jit.Canvas=p=new v({canvases:[],pos:false,element:false,labelContainer:false,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(U,N){this.viz=U;this.opt=this.config=N;var K=e.type(N.injectInto)=="string"?N.injectInto:N.injectInto.id,T=N.type,L=K+"-label",I=e(K),M=N.width||I.offsetWidth,V=N.height||I.offsetHeight;this.id=K;var O={injectInto:K,width:M,height:V};this.element=G("div",{id:K+"-canvaswidget",style:{position:"relative",width:M+"px",height:V+"px"}});this.labelContainer=this.createLabelContainer(N.Label.type,L,O);this.canvases.push(new p.Base[T]({config:e.extend({idSuffix:"-canvas"},O),plot:function(W){U.fx.plot()},resize:function(){U.refresh()}}));var P=N.background;if(P){var S=new p.Background[P.type](U,e.extend(P,O));this.canvases.push(new p.Base[T](S))}var R=this.canvases.length;while(R--){this.element.appendChild(this.canvases[R].canvas);if(R>0){this.canvases[R].plot()}}this.element.appendChild(this.labelContainer);I.appendChild(this.element);var J=null,Q=this;e.addEvent(window,"scroll",function(){clearTimeout(J);J=setTimeout(function(){Q.getPos(true)},500)})},getCtx:function(I){return this.canvases[I||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(I){return this.canvases[I||0].getSize()},resize:function(M,I){this.getPos(true);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;for(var K=0,J=this.canvases.length;K<J;K++){this.canvases[K].resize(M,I)}var L=this.element.style;L.width=M+"px";L.height=I+"px";if(this.labelContainer){this.labelContainer.style.width=M+"px"}},translate:function(I,M,L){this.translateOffsetX+=I*this.scaleOffsetX;this.translateOffsetY+=M*this.scaleOffsetY;for(var K=0,J=this.canvases.length;K<J;K++){this.canvases[K].translate(I,M,L)}},scale:function(N,K,L){var O=this.scaleOffsetX*N,M=this.scaleOffsetY*K;var Q=this.translateOffsetX*(N-1)/O,P=this.translateOffsetY*(K-1)/M;this.scaleOffsetX=O;this.scaleOffsetY=M;for(var J=0,I=this.canvases.length;J<I;J++){this.canvases[J].scale(N,K,true)}this.translate(Q,P,false)},getZoom:function(){return new u(this.scaleOffsetX,this.scaleOffsetY)},setZoom:function(I,N,L){var M=this.getZoom(),K=I/M.x,J=N/M.y;this.scale(K,J,L)},getPos:function(I){if(I||!this.pos){return this.pos=e.getPos(this.getElement())}return this.pos},clear:function(I){this.canvases[I||0].clear()},path:function(J,K){var I=this.canvases[0].getCtx();I.beginPath();K(I);I[J]();I.closePath()},createLabelContainer:function(K,O,N){var M="http://www.w3.org/2000/svg";if(K=="HTML"||K=="Native"){return G("div",{id:O,style:{overflow:"visible",position:"absolute",top:0,left:0,width:N.width+"px",height:0}})}else{if(K=="SVG"){var L=document.createElementNS(M,"svg:svg");L.setAttribute("width",N.width);L.setAttribute("height",N.height);var J=L.style;J.position="absolute";J.left=J.top="0px";var I=document.createElementNS(M,"svg:g");I.setAttribute("width",N.width);I.setAttribute("height",N.height);I.setAttribute("x",0);I.setAttribute("y",0);I.setAttribute("id",O);L.appendChild(I);return L}}}});p.Base={};p.Base["2D"]=new v({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(I){this.viz=I;this.opt=I.config;this.size=false;this.createCanvas();this.translateToCenter()},createCanvas:function(){var J=this.opt,K=J.width,I=J.height;this.canvas=G("canvas",{id:J.injectInto+J.idSuffix,width:K,height:I,style:{position:"absolute",top:0,left:0,width:K+"px",height:I+"px"}})},getCtx:function(){if(!this.ctx){return this.ctx=this.canvas.getContext("2d")}return this.ctx},getSize:function(){if(this.size){return this.size}var I=this.canvas;return this.size={width:I.width,height:I.height}},translateToCenter:function(L){var J=this.getSize(),K=L?(J.width-L.width-this.translateOffsetX*2):J.width;height=L?(J.height-L.height-this.translateOffsetY*2):J.height;var I=this.getCtx();L&&I.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);I.translate(K/2,height/2)},resize:function(L,I){var K=this.getSize(),J=this.canvas,M=J.style;this.size=false;J.width=L;J.height=I;M.width=L+"px";M.height=I+"px";if(!H){this.translateToCenter(K)}else{this.translateToCenter()}this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();this.viz.resize(L,I,this)},translate:function(I,M,J){var L=this.scaleOffsetX,K=this.scaleOffsetY;this.translateOffsetX+=I*L;this.translateOffsetY+=M*K;this.getCtx().translate(I,M);!J&&this.plot()},scale:function(I,K,J){this.scaleOffsetX*=I;this.scaleOffsetY*=K;this.getCtx().scale(I,K);!J&&this.plot()},clear:function(){var K=this.getSize(),J=this.translateOffsetX,I=this.translateOffsetY,M=this.scaleOffsetX,L=this.scaleOffsetY;this.getCtx().clearRect((-K.width/2-J)*1/M,(-K.height/2-I)*1/L,K.width*1/M,K.height*1/L)},plot:function(){this.clear();this.viz.plot(this)}});p.Background={};p.Background.Circles=new v({initialize:function(I,J){this.viz=I;this.config=e.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},J)},resize:function(J,I,K){this.plot(K)},plot:function(I){var J=I.canvas,P=I.getCtx(),M=this.config,O=M.CanvasStyles;for(var Q in O){P[Q]=O[Q]}var K=M.numberOfCircles,N=M.levelDistance;for(var L=1;L<=K;L++){P.beginPath();P.arc(0,0,N*L,0,2*Math.PI,false);P.stroke();P.closePath()}}})})();var d=function(G,F){this.theta=G||0;this.rho=F||0};$jit.Polar=d;d.prototype={getc:function(F){return this.toComplex(F)},getp:function(){return this},set:function(F){F=F.getp();this.theta=F.theta;this.rho=F.rho},setc:function(F,G){this.rho=Math.sqrt(F*F+G*G);this.theta=Math.atan2(G,F);if(this.theta<0){this.theta+=Math.PI*2}},setp:function(G,F){this.theta=G;this.rho=F},clone:function(){return new d(this.theta,this.rho)},toComplex:function(H){var F=Math.cos(this.theta)*this.rho;var G=Math.sin(this.theta)*this.rho;if(H){return{x:F,y:G}}return new u(F,G)},add:function(F){return new d(this.theta+F.theta,this.rho+F.rho)},scale:function(F){return new d(this.theta,this.rho*F)},equals:function(F){return this.theta==F.theta&&this.rho==F.rho},$add:function(F){this.theta=this.theta+F.theta;this.rho+=F.rho;return this},$madd:function(F){this.theta=(this.theta+F.theta)%(Math.PI*2);this.rho+=F.rho;return this},$scale:function(F){this.rho*=F;return this},isZero:function(){var G=0.0001,F=Math.abs;return F(this.theta)<G&&F(this.rho)<G},interpolate:function(H,O){var I=Math.PI,L=I*2;var G=function(Q){var P=(Q<0)?(Q%L)+L:Q%L;return P};var K=this.theta,N=H.theta;var J,M=Math.abs(K-N);if(M==I){if(K>N){J=G((N+((K-L)-N)*O))}else{J=G((N-L+(K-(N))*O))}}else{if(M>=I){if(K>N){J=G((N+((K-L)-N)*O))}else{J=G((N-L+(K-(N-L))*O))}}else{J=G((N+(K-N)*O))}}var F=(this.rho-H.rho)*O+H.rho;return{theta:J,rho:F}}};var m=function(G,F){return new d(G,F)};d.KER=m(0,0);var u=function(F,G){this.x=F||0;this.y=G||0};$jit.Complex=u;u.prototype={getc:function(){return this},getp:function(F){return this.toPolar(F)},set:function(F){F=F.getc(true);this.x=F.x;this.y=F.y},setc:function(F,G){this.x=F;this.y=G},setp:function(G,F){this.x=Math.cos(G)*F;this.y=Math.sin(G)*F},clone:function(){return new u(this.x,this.y)},toPolar:function(H){var F=this.norm();var G=Math.atan2(this.y,this.x);if(G<0){G+=Math.PI*2}if(H){return{theta:G,rho:F}}return new d(G,F)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(F){return new u(this.x+F.x,this.y+F.y)},prod:function(F){return new u(this.x*F.x-this.y*F.y,this.y*F.x+this.x*F.y)},conjugate:function(){return new u(this.x,-this.y)},scale:function(F){return new u(this.x*F,this.y*F)},equals:function(F){return this.x==F.x&&this.y==F.y},$add:function(F){this.x+=F.x;this.y+=F.y;return this},$prod:function(H){var F=this.x,G=this.y;this.x=F*H.x-G*H.y;this.y=G*H.x+F*H.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(F){this.x*=F;this.y*=F;return this},$div:function(I){var F=this.x,H=this.y;var G=I.squaredNorm();this.x=F*I.x+H*I.y;this.y=H*I.x-F*I.y;return this.$scale(1/G)},isZero:function(){var G=0.0001,F=Math.abs;return F(this.x)<G&&F(this.y)<G}};var x=function(G,F){return new u(G,F)};u.KER=x(0,0);u.IM=x(0,1);$jit.Graph=new v({initialize:function(H,G,F,L){var J={klass:u,Node:{}};this.Node=G;this.Edge=F;this.Label=L;this.opt=e.merge(J,H||{});this.nodes={};this.edges={};var I=this;this.nodeList={};for(var K in l){I.nodeList[K]=(function(M){return function(){var N=Array.prototype.slice.call(arguments);I.eachNode(function(O){O[M].apply(O,N)})}})(K)}},getNode:function(F){if(this.hasNode(F)){return this.nodes[F]}return false},get:function(F){return this.getNode(F)},getByName:function(F){var G=[];for(var I in this.nodes){var H=this.nodes[I];if(H.name==F){G.push(H)}}if(G.length==1){return G[0]}if(G.length==0){return false}return G},getAdjacence:function(G,F){if(G in this.edges){return this.edges[G][F]}return false},addNode:function(G){if(!this.nodes[G.id]){var F=this.edges[G.id]={};this.nodes[G.id]=new g.Node(e.extend({id:G.id,name:G.name,data:e.merge(G.data||{},{}),adjacencies:F},this.opt.Node),this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[G.id]},addAdjacence:function(I,H,G){if(!this.hasNode(I.id)){this.addNode(I)}if(!this.hasNode(H.id)){this.addNode(H)}I=this.nodes[I.id];H=this.nodes[H.id];if(!I.adjacentTo(H)){var J=this.edges[I.id]=this.edges[I.id]||{};var F=this.edges[H.id]=this.edges[H.id]||{};J[H.id]=F[I.id]=new g.Adjacence(I,H,G,this.Edge,this.Label);return J[H.id]}return this.edges[I.id][H.id]},removeNode:function(H){if(this.hasNode(H)){delete this.nodes[H];var G=this.edges[H];for(var F in G){delete this.edges[F][H]}delete this.edges[H]}},removeAdjacence:function(G,F){delete this.edges[G][F];delete this.edges[F][G]},hasNode:function(F){return F in this.nodes},empty:function(){this.nodes={};this.edges={}}});var g=$jit.Graph;var l;(function(){var F=function(M,O,J,L,N){var K;J=J||"current";M="$"+(M?M+"-":"");if(J=="current"){K=this.data}else{if(J=="start"){K=this.startData}else{if(J=="end"){K=this.endData}}}var I=M+O;if(L){return K[I]}if(!this.Config.overridable){return N[O]||0}return(I in K)?K[I]:((I in this.data)?this.data[I]:(N[O]||0))};var H=function(L,M,K,I){I=I||"current";L="$"+(L?L+"-":"");var J;if(I=="current"){J=this.data}else{if(I=="start"){J=this.startData}else{if(I=="end"){J=this.endData}}}J[L+M]=K};var G=function(K,I){K="$"+(K?K+"-":"");var J=this;e.each(I,function(M){var L=K+M;delete J.data[L];delete J.endData[L];delete J.startData[L]})};l={getData:function(K,I,J){return F.call(this,"",K,I,J,this.Config)},setData:function(K,J,I){H.call(this,"",K,J,I)},setDataset:function(L,M){L=e.splat(L);for(var I in M){for(var K=0,N=e.splat(M[I]),J=L.length;K<J;K++){this.setData(I,N[K],L[K])}}},removeData:function(){G.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(K,I,J){return F.call(this,"canvas",K,I,J,this.Config.CanvasStyles)},setCanvasStyle:function(K,J,I){H.call(this,"canvas",K,J,I)},setCanvasStyles:function(L,M){L=e.splat(L);for(var I in M){for(var K=0,N=e.splat(M[I]),J=L.length;K<J;K++){this.setCanvasStyle(I,N[K],L[K])}}},removeCanvasStyle:function(){G.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(K,I,J){return F.call(this,"label",K,I,J,this.Label)},setLabelData:function(K,J,I){H.call(this,"label",K,J,I)},setLabelDataset:function(L,M){L=e.splat(L);for(var I in M){for(var K=0,N=e.splat(M[I]),J=L.length;K<J;K++){this.setLabelData(I,N[K],L[K])}}},removeLabelData:function(){G.call(this,"label",Array.prototype.slice.call(arguments))}}})();g.Node=new v({initialize:function(I,F,H,G,K){var J={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:false,drawn:false,exist:false,angleSpan:{begin:0,end:0},pos:new F,startPos:new F,endPos:new F};e.extend(this,e.extend(J,I));this.Config=this.Node=H;this.Edge=G;this.Label=K},adjacentTo:function(F){return F.id in this.adjacencies},adjacentWithDirectionTo:function(F){var G=F.id in this.adjacencies;if(!G){return false}var H=this.adjacencies[F.id].data.$direction;return H[0]===this.id},getAdjacency:function(F){return this.adjacencies[F]},getPos:function(F){F=F||"current";if(F=="current"){return this.pos}else{if(F=="end"){return this.endPos}else{if(F=="start"){return this.startPos}}}},setPos:function(G,F){F=F||"current";var H;if(F=="current"){H=this.pos}else{if(F=="end"){H=this.endPos}else{if(F=="start"){H=this.startPos}}}H.set(G)}});g.Node.implement(l);g.Adjacence=new v({initialize:function(G,J,H,F,I){this.nodeFrom=G;this.nodeTo=J;this.data=H||{};this.startData={};this.endData={};this.Config=this.Edge=F;this.Label=I}});g.Adjacence.implement(l);g.Util={filter:function(G){if(!G||!(e.type(G)=="string")){return function(){return true}}var F=G.split(" ");return function(I){for(var H=0;H<F.length;H++){if(I[F[H]]){return false}}return true}},getNode:function(F,G){return F.nodes[G]},eachNode:function(J,I,F){var H=this.filter(F);for(var G in J.nodes){if(H(J.nodes[G])){I(J.nodes[G])}}},each:function(H,G,F){this.eachNode(H,G,F)},eachAdjacency:function(K,L,G){var H=K.adjacencies,J=this.filter(G);for(var M in H){var F=H[M];if(J(F)){if(F.nodeFrom!=K){var I=F.nodeFrom;F.nodeFrom=F.nodeTo;F.nodeTo=I}L(F,M)}}},computeLevels:function(L,M,I,H){I=I||0;var J=this.filter(H);this.eachNode(L,function(N){N._flag=false;N._depth=-1},H);var G=L.getNode(M);G._depth=I;var F=[G];while(F.length!=0){var K=F.pop();K._flag=true;this.eachAdjacency(K,function(N){var O=N.nodeTo;if(O._flag==false&&J(O)&&!N._hiding){if(O._depth<0){O._depth=K._depth+1+I}F.unshift(O)}},H)}},eachBFS:function(K,L,J,G){var H=this.filter(G);this.clean(K);var F=[K.getNode(L)];while(F.length!=0){var I=F.pop();if(!I){return}I._flag=true;J(I,I._depth);this.eachAdjacency(I,function(M){var N=M.nodeTo;if(N._flag==false&&H(N)&&!M._hiding){N._flag=true;F.unshift(N)}},G)}},eachLevel:function(J,O,G,K,I){var N=J._depth,F=this.filter(I),L=this,M=true;G=G===false?Number.MAX_VALUE-N:G;(function H(S,P,Q){if(!M){return}var T=S._depth,R;if(T>=P&&T<=Q&&F(S)){R=K(S,T)}if(typeof R!=="undefined"){M=R}if(M&&T<Q){L.eachAdjacency(S,function(U){var V=U.nodeTo;if(V._depth>T){H(V,P,Q)}})}})(J,O+N,G+N)},eachSubgraph:function(G,H,F){this.eachLevel(G,0,false,H,F)},eachSubnode:function(G,H,F){this.eachLevel(G,1,1,H,F)},anySubnode:function(I,H,G){var F=false;H=H||e.lambda(true);var J=e.type(H)=="string"?function(K){return K[H]}:H;this.eachSubnode(I,function(K){if(J(K)){F=true}},G);return F},getSubnodes:function(K,L,F){var H=[],J=this;L=L||0;var I,G;if(e.type(L)=="array"){I=L[0];G=L[1]}else{I=L;G=Number.MAX_VALUE-K._depth}this.eachLevel(K,I,G,function(M){H.push(M)},F);return H},getParents:function(G){var F=[];this.eachAdjacency(G,function(H){var I=H.nodeTo;if(I._depth<G._depth){F.push(I)}});return F},isDescendantOf:function(I,J){if(I.id==J){return true}var H=this.getParents(I),F=false;for(var G=0;!F&&G<H.length;G++){F=F||this.isDescendantOf(H[G],J)}return F},clean:function(F){this.eachNode(F,function(G){G._flag=false})},getClosestNodeToOrigin:function(G,H,F){return this.getClosestNodeToPos(G,d.KER,H,F)},getClosestNodeToPos:function(H,K,J,F){var G=null;J=J||"current";K=K&&K.getc(true)||u.KER;var I=function(M,L){var O=M.x-L.x,N=M.y-L.y;return O*O+N*N};this.eachNode(H,function(L){G=(G==null||I(L.getPos(J).getc(true),K)<I(G.getPos(J).getc(true),K))?L:G},F);return G}};e.each(["get","getNode","each","eachNode","computeLevels","eachBFS","clean","getClosestNodeToPos","getClosestNodeToOrigin"],function(F){g.prototype[F]=function(){return g.Util[F].apply(g.Util,[this].concat(Array.prototype.slice.call(arguments)))}});e.each(["eachAdjacency","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"],function(F){g.Node.prototype[F]=function(){return g.Util[F].apply(g.Util,[this].concat(Array.prototype.slice.call(arguments)))}});g.Op={options:{type:"nothing",duration:2000,hideLabels:true,fps:30},initialize:function(F){this.viz=F},removeNode:function(K,I){var F=this.viz;var G=e.merge(this.options,F.controller,I);var M=e.splat(K);var H,J,L;switch(G.type){case"nothing":for(H=0;H<M.length;H++){G.onBeforeRemoveNode(F.graph.getNode(M[H]));F.graph.removeNode(M[H])}break;case"replot":this.removeNode(M,{type:"nothing"});F.labels.clearLabels();F.refresh(true);break;case"fade:seq":case"fade":J=this;for(H=0;H<M.length;H++){L=F.graph.getNode(M[H]);L.setData("alpha",0,"end")}F.fx.animate(e.merge(G,{modes:["node-property:alpha"],onComplete:function(){J.removeNode(M,{type:"nothing"});F.labels.clearLabels();F.reposition();F.fx.animate(e.merge(G,{modes:["linear"]}))}}));break;case"fade:con":J=this;for(H=0;H<M.length;H++){L=F.graph.getNode(M[H]);L.setData("alpha",0,"end");L.ignore=true}F.reposition();F.fx.animate(e.merge(G,{modes:["node-property:alpha","linear"],onComplete:function(){J.removeNode(M,{type:"nothing"});G.onComplete&&G.onComplete()}}));break;case"iter":J=this;F.fx.sequence({condition:function(){return M.length!=0},step:function(){J.removeNode(M.shift(),{type:"nothing"});F.labels.clearLabels()},onComplete:function(){G.onComplete&&G.onComplete()},duration:Math.ceil(G.duration/M.length)});break;default:this.doError()}},removeEdge:function(M,K){var F=this.viz;var I=e.merge(this.options,F.controller,K);var H=(e.type(M[0])=="string")?[M]:M;var J,L,G;switch(I.type){case"nothing":for(J=0;J<H.length;J++){F.graph.removeAdjacence(H[J][0],H[J][1])}break;case"replot":this.removeEdge(H,{type:"nothing"});F.refresh(true);break;case"fade:seq":case"fade":L=this;for(J=0;J<H.length;J++){G=F.graph.getAdjacence(H[J][0],H[J][1]);if(G){G.setData("alpha",0,"end")}}F.fx.animate(e.merge(I,{modes:["edge-property:alpha"],onComplete:function(){L.removeEdge(H,{type:"nothing"});F.reposition();F.fx.animate(e.merge(I,{modes:["linear"]}))}}));break;case"fade:con":L=this;for(J=0;J<H.length;J++){G=F.graph.getAdjacence(H[J][0],H[J][1]);if(G){G.setData("alpha",0,"end");G.ignore=true}}F.reposition();F.fx.animate(e.merge(I,{modes:["edge-property:alpha","linear"],onComplete:function(){L.removeEdge(H,{type:"nothing"});I.onComplete&&I.onComplete()}}));break;case"iter":L=this;F.fx.sequence({condition:function(){return H.length!=0},step:function(){L.removeEdge(H.shift(),{type:"nothing"});F.labels.clearLabels()},onComplete:function(){I.onComplete()},duration:Math.ceil(I.duration/H.length)});break;default:this.doError()}},sum:function(J,I){var F=this.viz;var H=e.merge(this.options,F.controller,I),G=F.root;var L;F.root=I.id||F.root;switch(H.type){case"nothing":L=F.construct(J);L.eachNode(function(N){N.eachAdjacency(function(O){F.graph.addAdjacence(O.nodeFrom,O.nodeTo,O.data)})});break;case"replot":F.refresh(true);this.sum(J,{type:"nothing"});F.refresh(true);break;case"fade:seq":case"fade":case"fade:con":that=this;L=F.construct(J);var M=this.preprocessSum(L);var K=!M?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];F.reposition();if(H.type!="fade:con"){F.fx.animate(e.merge(H,{modes:["linear"],onComplete:function(){F.fx.animate(e.merge(H,{modes:K,onComplete:function(){H.onComplete()}}))}}))}else{F.graph.eachNode(function(N){if(N.id!=G&&N.pos.isZero()){N.pos.set(N.endPos);N.startPos.set(N.endPos)}});F.fx.animate(e.merge(H,{modes:["linear"].concat(K)}))}break;default:this.doError()}},morph:function(N,G,I){I=I||{};var K=this.viz;var O=e.merge(this.options,K.controller,G),J=K.root;var L;K.root=G.id||K.root;switch(O.type){case"nothing":L=K.construct(N);L.eachNode(function(R){var Q=K.graph.hasNode(R.id);R.eachAdjacency(function(V){var U=!!K.graph.getAdjacence(V.nodeFrom.id,V.nodeTo.id);K.graph.addAdjacence(V.nodeFrom,V.nodeTo,V.data);if(U){var T=K.graph.getAdjacence(V.nodeFrom.id,V.nodeTo.id);for(var W in (V.data||{})){T.data[W]=V.data[W]}}});if(Q){var P=K.graph.getNode(R.id);for(var S in (R.data||{})){P.data[S]=R.data[S]}}});K.graph.eachNode(function(P){P.eachAdjacency(function(Q){if(!L.getAdjacence(Q.nodeFrom.id,Q.nodeTo.id)){K.graph.removeAdjacence(Q.nodeFrom.id,Q.nodeTo.id)}});if(!L.hasNode(P.id)){K.graph.removeNode(P.id)}});break;case"replot":K.labels.clearLabels(true);this.morph(N,{type:"nothing"});K.refresh(true);K.refresh(true);break;case"fade:seq":case"fade":case"fade:con":that=this;L=K.construct(N);var M=("node-property" in I)&&e.map(e.splat(I["node-property"]),function(P){return"$"+P});K.graph.eachNode(function(Q){var R=L.getNode(Q.id);if(!R){Q.setData("alpha",1);Q.setData("alpha",1,"start");Q.setData("alpha",0,"end");Q.ignore=true}else{var P=R.data;for(var S in P){if(M&&(e.indexOf(M,S)>-1)){Q.endData[S]=P[S]}else{Q.data[S]=P[S]}}}});K.graph.eachNode(function(P){if(P.ignore){return}P.eachAdjacency(function(Q){if(Q.nodeFrom.ignore||Q.nodeTo.ignore){return}var R=L.getNode(Q.nodeFrom.id);var S=L.getNode(Q.nodeTo.id);if(!R.adjacentTo(S)){var Q=K.graph.getAdjacence(R.id,S.id);F=true;Q.setData("alpha",1);Q.setData("alpha",1,"start");Q.setData("alpha",0,"end");Q._hiding=true}else{if(Q.data.$direction&&Q.data.$direction[0]===R.id){if(!R.adjacentWithDirectionTo(S)){Q._reversing=true}}}})});var F=this.preprocessSum(L);var H=!F?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];H[0]=H[0]+(("node-property" in I)?(":"+e.splat(I["node-property"]).join(":")):"");H[1]=(H[1]||"edge-property:alpha")+(("edge-property" in I)?(":"+e.splat(I["edge-property"]).join(":")):"");if("label-property" in I){H.push("label-property:"+e.splat(I["label-property"]).join(":"))}if(K.reposition){K.reposition()}else{K.compute("end")}this._updateDirectedEdges();K.graph.eachNode(function(P){if(P.id!=J&&P.pos.getp().equals(d.KER)){P.pos.set(P.endPos);P.startPos.set(P.endPos)}});K.fx.animate(e.merge(O,{modes:[I.position||"polar"].concat(H),onComplete:function(){K.graph.eachNode(function(P){if(P.ignore){K.graph.removeNode(P.id)}});K.graph.eachNode(function(P){P.eachAdjacency(function(Q){if(Q.ignore){K.graph.removeAdjacence(Q.nodeFrom.id,Q.nodeTo.id)}})});O.onComplete()}}));break;default:}},_updateDirectedEdges:function(){var F=this.viz.graph;F.eachNode(function(G){G.eachAdjacency(function(J){var K=J.data.$direction;if(K&&J.nodeFrom.id!==J.data.$direction[0]){return}if(J._hiding){F.removeAdjacence(J.nodeFrom.id,J.nodeTo.id)}if(J._reversing){var M=J.nodeFrom.id;var L=J.nodeTo.id;var I=F.edges[M][L];var H=F.edges[L][M];I.data.$direction=[L,M];H.data.$direction=[L,M];J._reversing=undefined}})})},contract:function(H,G){var F=this.viz;if(H.collapsed||!H.anySubnode(e.lambda(true))){return}G=e.merge(this.options,F.config,G||{},{modes:["node-property:alpha:span","linear"]});H.collapsed=true;(function I(J){J.eachSubnode(function(K){K.ignore=true;K.setData("alpha",0,G.type=="animate"?"end":"current");I(K)})})(H);if(G.type=="animate"){F.compute("end");if(F.rotated){F.rotate(F.rotated,"none",{property:"end"})}(function I(J){J.eachSubnode(function(K){K.setPos(H.getPos("end"),"end");I(K)})})(H);F.fx.animate(G)}else{if(G.type=="replot"){F.refresh()}}},expand:function(H,G){if(!("collapsed" in H)){return}var F=this.viz;G=e.merge(this.options,F.config,G||{},{modes:["node-property:alpha:span","linear"]});delete H.collapsed;(function I(J){J.eachSubnode(function(K){delete K.ignore;K.setData("alpha",1,G.type=="animate"?"end":"current");I(K)})})(H);if(G.type=="animate"){F.compute("end");if(F.rotated){F.rotate(F.rotated,"none",{property:"end"})}F.fx.animate(G)}else{if(G.type=="replot"){F.refresh()}}},preprocessSum:function(G){var F=this.viz;G.eachNode(function(I){if(!F.graph.hasNode(I.id)){F.graph.addNode(I);var J=F.graph.getNode(I.id);J.setData("alpha",0);J.setData("alpha",0,"start");J.setData("alpha",1,"end")}});var H=false;G.eachNode(function(I){I.eachAdjacency(function(J){var K=F.graph.getNode(J.nodeFrom.id);var L=F.graph.getNode(J.nodeTo.id);if(!K.adjacentTo(L)){var J=F.graph.addAdjacence(K,L,J.data);if(K.startAlpha==K.endAlpha&&L.startAlpha==L.endAlpha){H=true;J.setData("alpha",0);J.setData("alpha",0,"start");J.setData("alpha",1,"end")}}})});return H}};var b={none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(I,J,F,H){var G=H.getCtx();G.beginPath();G.arc(J.x,J.y,F,0,Math.PI*2,true);G.closePath();G[I]()},contains:function(K,J,F){var H=K.x-J.x,G=K.y-J.y,I=H*H+G*G;return I<=F*F}},ellipse:{render:function(L,N,F,O,G){var P=G.getCtx(),I=1,H=1,M=1,K=1,J=0;if(F>O){J=F/2;H=O/F;K=F/O}else{J=O/2;I=F/O;M=O/F}P.save();P.scale(I,H);P.beginPath();P.arc(N.x*M,N.y*K,J,0,Math.PI*2,true);P.closePath();P[L]();P.restore()},contains:function(F,M,G,O){var L=0,K=1,J=1,I=0,H=0,N=0;if(G>O){L=G/2;J=O/G}else{L=O/2;K=G/O}I=(F.x-M.x)*(1/K);H=(F.y-M.y)*(1/J);N=I*I+H*H;return N<=L*L}},square:{render:function(G,I,H,F){F.getCtx()[G+"Rect"](I.x-H,I.y-H,2*H,2*H)},contains:function(H,G,F){return Math.abs(G.x-H.x)<=F&&Math.abs(G.y-H.y)<=F}},rectangle:{render:function(I,J,H,F,G){G.getCtx()[I+"Rect"](J.x-H/2,J.y-F/2,H,F)},contains:function(I,H,G,F){return Math.abs(H.x-I.x)<=G/2&&Math.abs(H.y-I.y)<=F/2}},triangle:{render:function(L,M,I,F){var P=F.getCtx(),H=M.x,G=M.y-I,O=H-I,N=M.y+I,K=H+I,J=N;P.beginPath();P.moveTo(H,G);P.lineTo(O,N);P.lineTo(K,J);P.closePath();P[L]()},contains:function(H,G,F){return b.circle.contains(H,G,F)}},star:{render:function(J,L,K,G){var F=G.getCtx(),I=Math.PI/5;F.save();F.translate(L.x,L.y);F.beginPath();F.moveTo(K,0);for(var H=0;H<9;H++){F.rotate(I);if(H%2==0){F.lineTo((K/0.525731)*0.200811,0)}else{F.lineTo(K,0)}}F.closePath();F[J]();F.restore()},contains:function(H,G,F){return b.circle.contains(H,G,F)}},roundedRectangle:{render:function(I,K,M,H,F,G){var N=G.getCtx(),L=K.x,J=K.y;N.save();N.translate(-M/2,-H/2);if(M<2*F){F=M/2}if(H<2*F){F=H/2}N.beginPath();N.moveTo(L+F,J);N.arcTo(L+M,J,L+M,J+H,F);N.arcTo(L+M,J+H,L,J+H,F);N.arcTo(L,J+H,L,J,F);N.arcTo(L,J,L+M,J,F);N.closePath();N[I]();N.restore()},contains:function(J,I,H,G,F){return b.rectangle.contains(J,I,H,G)}}};var r={line:{render:function(I,H,G){var F=G.getCtx();F.beginPath();F.moveTo(I.x,I.y);F.lineTo(H.x,H.y);F.stroke()},contains:function(P,H,K,N){var I=Math.min,L=Math.max,G=I(P.x,H.x)-N,O=L(P.x,H.x)+N,F=I(P.y,H.y)-N,M=L(P.y,H.y)+N;if(K.x>=G&&K.x<=O&&K.y>=F&&K.y<=M){if(Math.abs(H.x-P.x)<=N){return true}var J=(H.y-P.y)/(H.x-P.x)*(K.x-P.x)+P.y;return Math.abs(J-K.y)<=N}return false}},arrow:{render:function(R,S,J,G,F,H){var T=F.getCtx();if(G){var I=R;R=S;S=I}var M=new u(S.x-R.x,S.y-R.y);M.$scale(J/M.norm());var P;switch(H){case"end":P=M;break;case"center":P=new u((S.x-R.x)/2,(S.y-R.y)/2);break}var K=new u(S.x-P.x,S.y-P.y),L=new u(-M.y/2,M.x/2),N=K.add(M),Q=K.add(L),O=K.$add(L.$scale(-1));T.beginPath();T.moveTo(R.x,R.y);T.lineTo(S.x,S.y);T.stroke();T.beginPath();T.moveTo(Q.x,Q.y);T.moveTo(Q.x,Q.y);T.lineTo(O.x,O.y);T.lineTo(N.x,N.y);T.closePath();T.fill()},contains:function(G,F,I,H){return r.line.contains(G,F,I,H)}},hyperline:{render:function(M,N,F,H){var O=H.getCtx();var I=J(M,N);if(I.a>1000||I.b>1000||I.ratio<0){O.beginPath();O.moveTo(M.x*F,M.y*F);O.lineTo(N.x*F,N.y*F);O.stroke()}else{var L=Math.atan2(N.y-I.y,N.x-I.x);var K=Math.atan2(M.y-I.y,M.x-I.x);var G=G(L,K);O.beginPath();O.arc(I.x*F,I.y*F,I.ratio*F,L,K,G);O.stroke()}function J(ab,aa){var T=(ab.x*aa.y-ab.y*aa.x),P=T;var S=ab.squaredNorm(),R=aa.squaredNorm();if(T==0){return{x:0,y:0,ratio:-1}}var Z=(ab.y*R-aa.y*S+ab.y-aa.y)/T;var X=(aa.x*S-ab.x*R+aa.x-ab.x)/P;var Y=-Z/2;var W=-X/2;var V=(Z*Z+X*X)/4-1;if(V<0){return{x:0,y:0,ratio:-1}}var U=Math.sqrt(V);var Q={x:Y,y:W,ratio:U>1000?-1:U,a:Z,b:X};return Q}function G(P,Q){return(P<Q)?((P+Math.PI>Q)?false:true):((Q+Math.PI>P)?true:false)}},contains:e.lambda(false)}};g.Plot={initialize:function(G,F){this.viz=G;this.config=G.config;this.node=G.config.Node;this.edge=G.config.Edge;this.animation=new D;this.nodeTypes=new F.Plot.NodeTypes;this.edgeTypes=new F.Plot.EdgeTypes;this.labels=G.labels},nodeHelper:b,edgeHelper:r,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number",vertices:"polygon"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(H,G,F){return H+(G-H)*F},moebius:function(K,J,M,G){var I=G.scale(-M);if(I.norm()<1){var F=I.x,L=I.y;var H=K.startPos.getc().moebiusTransformation(I);K.pos.setc(H.x,H.y);I.x=F;I.y=L}},linear:function(G,F,J){var I=G.startPos.getc(true);var H=G.endPos.getc(true);G.pos.setc(this.compute(I.x,H.x,J),this.compute(I.y,H.y,J))},polar:function(H,G,K){var J=H.startPos.getp(true);var I=H.endPos.getp();var F=I.interpolate(J,K);H.pos.setp(F.theta,F.rho)},number:function(G,L,K,F,J){var I=G[F](L,"start");var H=G[F](L,"end");G[J](L,this.compute(I,H,K))},color:function(H,F,N,K,I){var L=e.hexToRgb(H[K](F,"start"));var M=e.hexToRgb(H[K](F,"end"));var J=this.compute;var G=e.rgbToHex([parseInt(J(L[0],M[0],N)),parseInt(J(L[1],M[1],N)),parseInt(J(L[2],M[2],N))]);H[I](F,G)},"array-number":function(I,H,S,P,K){var Q=I[P](H,"start"),R=I[P](H,"end"),T=[];for(var N=0,J=Q.length;N<J;N++){var G=Q[N],F=R[N];if(G.length){for(var M=0,O=G.length,L=[];M<O;M++){L.push(this.compute(G[M],F[M],S))}T.push(L)}else{T.push(this.compute(G,F,S))}}I[K](H,T)},node:function(G,L,N,F,M,H){F=this[F];if(L){var K=L.length;for(var I=0;I<K;I++){var J=L[I];this[F[J]](G,J,N,M,H)}}else{for(var J in F){this[F[J]](G,J,N,M,H)}}},edge:function(H,G,M,I,F,L){var K=H.adjacencies;for(var J in K){this["node"](K[J],G,M,I,F,L)}},"node-property":function(G,F,H){this["node"](G,F,H,"map","getData","setData")},"edge-property":function(G,F,H){this["edge"](G,F,H,"map","getData","setData")},"label-property":function(G,F,H){this["node"](G,F,H,"label","getLabelData","setLabelData")},"node-style":function(G,F,H){this["node"](G,F,H,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(G,F,H){this["edge"](G,F,H,"canvas","getCanvasStyle","setCanvasStyle")},polygon:function(I,H,S,O,K){var Q=I[O](H,"start"),R=I[O](H,"end"),T=[];if(typeof Q.offset=="undefined"){if(Q===0){Q=e.map(R,function(){return new $jit.Complex(0,0)});Q.offset=0}else{if(Q.length==0){Q.push(new $jit.Complex(0,0))}while(Q.length<R.length){Q.push(Q[0])}while(Q.length>R.length){R.push(R[0]||new $jit.Complex(0,0))}if(Q.length==0){return}var J=Q.length;var P=1e+300;for(var L=0;L<J;L++){var N=0;for(var M=0;M<J;M++){N+=Geometry.dist2(Q[(L+M)%J],R[M])}if(N<P){Q.offset=L;P=N}}}}for(var M=0,J=Q.length;M<J;M++){var G=Q[(M+Q.offset)%J],F=R[M];T.push(new $jit.Complex(this.compute(G.x,F.x,S),this.compute(G.y,F.y,S)))}I[K](H,T)}},sequence:function(G){var H=this;G=e.merge({condition:e.lambda(false),step:e.empty,onComplete:e.empty,duration:200},G||{});var F=setInterval(function(){if(G.condition()){G.step()}else{clearInterval(F);G.onComplete()}H.viz.refresh(true)},G.duration)},prepare:function(L){var K=this.viz.graph,I={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}};var G={};if(e.type(L)=="array"){for(var J=0,F=L.length;J<F;J++){var H=L[J].split(":");G[H.shift()]=H}}else{for(var M in L){if(M=="position"){G[L.position]=[]}else{G[M]=e.splat(L[M])}}}K.eachNode(function(N){N.startPos.set(N.pos);e.each(["node-property","node-style"],function(Q){if(Q in G){var R=G[Q];for(var P=0,O=R.length;P<O;P++){N[I[Q].setter](R[P],N[I[Q].getter](R[P]),"start")}}});e.each(["edge-property","edge-style"],function(O){if(O in G){var P=G[O];N.eachAdjacency(function(R){for(var S=0,Q=P.length;S<Q;S++){R[I[O].setter](P[S],R[I[O].getter](P[S]),"start")}})}})});return G},animate:function(I,H){I=e.merge(this.viz.config,I||{});var J=this,G=this.viz,L=G.graph,M=this.Interpolator,K=I.type==="nodefx"?this.nodeFxAnimation:this.animation;var F=this.prepare(I.modes);if(I.hideLabels){this.labels.hideLabels(true)}K.setOptions(e.extend(I,{$animating:false,compute:function(N){L.eachNode(function(O){for(var P in F){M[P](O,F[P],N,H)}});J.plot(I,this.$animating,N);this.$animating=true},complete:function(){if(I.hideLabels){J.labels.hideLabels(false)}J.plot(I);I.onComplete()}})).start()},nodeFx:function(H){if(this.nodeFxAnimation==undefined){this.nodeFxAnimation=new D()}var M=this.viz,N=M.graph,K=this.nodeFxAnimation,O=e.merge(this.viz.config,{elements:{id:false,properties:{}},reposition:false});H=e.merge(O,H||{},{onBeforeCompute:e.empty,onAfterCompute:e.empty});K.stopTimer();var L=H.elements.properties;if(!H.elements.id){N.eachNode(function(Q){for(var P in L){Q.setData(P,L[P],"end")}})}else{var F=e.splat(H.elements.id);e.each(F,function(R){var Q=N.getNode(R);if(Q){for(var P in L){Q.setData(P,L[P],"end")}}})}var J=[];for(var G in L){J.push(G)}var I=["node-property:"+J.join(":")];if(H.reposition){I.push("linear");M.compute("end")}this.animate(e.merge(H,{modes:I,type:"nodefx"}))},plot:function(G,P){var N=this.viz,K=N.graph,H=N.canvas,F=N.root,L=this,O=H.getCtx(),J=Math.min,G=G||this.viz.controller;G.clearCanvas&&H.clear();var M=K.getNode(F);if(!M){return}var I=!!M.visited;K.eachNode(function(R){var Q=R.getData("alpha");R.eachAdjacency(function(S){var T=S.nodeTo;if(!!T.visited===I&&R.drawn&&T.drawn){G.onBeforePlotLine(S,P);L.plotLine(S,H,P);G.onAfterPlotLine(S,P)}});if(R.drawn){G.onBeforePlotNode(R,P);L.plotNode(R,H,P);G.onAfterPlotNode(R,P)}if(!L.labelsHidden&&G.withLabels){if(R.drawn&&Q>=0.95){L.labels.plotLabel(H,R,G)}else{L.labels.hideLabel(R,false)}}R.visited=!I})},plotTree:function(J,G,N){var K=this,L=this.viz,H=L.canvas,I=this.config,M=H.getCtx();var F=J.getData("alpha");J.eachSubnode(function(P){if(G.plotSubtree(J,P)&&P.exist&&P.drawn){var O=J.getAdjacency(P.id);G.onBeforePlotLine(O,N);K.plotLine(O,H,N);G.onAfterPlotLine(O,N);K.plotTree(P,G,N)}});if(J.drawn){G.onBeforePlotNode(J,N);this.plotNode(J,H,N);G.onAfterPlotNode(J,N);if(!G.hideLabels&&G.withLabels&&F>=0.95){this.labels.plotLabel(H,J,G)}else{this.labels.hideLabel(J,false)}}else{this.labels.hideLabel(J,true)}},plotNode:function(H,G,O){var L=H.getData("type"),K=this.node.CanvasStyles;if(L!="none"){var F=H.getData("lineWidth"),J=H.getData("color"),I=H.getData("alpha"),M=G.getCtx();M.save();M.lineWidth=F;M.fillStyle=M.strokeStyle=J;M.globalAlpha=I;for(var N in K){M[N]=H.getCanvasStyle(N)}this.nodeTypes[L].render.call(this,H,G,O);M.restore()}},plotLine:function(L,G,P){var K=L.getData("type"),I=this.edge.CanvasStyles;if(K!="none"){var F=L.getData("lineWidth"),H=L.getData("color"),N=G.getCtx(),J=L.nodeFrom,M=L.nodeTo;N.save();N.lineWidth=F;N.fillStyle=N.strokeStyle=H;N.globalAlpha=Math.min(J.getData("alpha"),M.getData("alpha"),L.getData("alpha"));for(var O in I){N[O]=L.getCanvasStyle(O)}this.edgeTypes[K].render.call(this,L,G,P);N.restore()}}};g.Plot3D=e.merge(g.Plot,{Interpolator:{linear:function(G,F,J){var I=G.startPos.getc(true);var H=G.endPos.getc(true);G.pos.setc(this.compute(I.x,H.x,J),this.compute(I.y,H.y,J),this.compute(I.z,H.z,J))}},plotNode:function(G,F){if(G.getData("type")=="none"){return}this.plotElement(G,F,{getAlpha:function(){return G.getData("alpha")}})},plotLine:function(F,G){if(F.getData("type")=="none"){return}this.plotElement(F,G,{getAlpha:function(){return Math.min(F.nodeFrom.getData("alpha"),F.nodeTo.getData("alpha"),F.getData("alpha"))}})},plotElement:function(ah,N,I){var ae=N.getCtx(),O=new Matrix4,G=N.config.Scene.Lighting,ai=N.canvases[0],T=ai.program,ag=ai.camera;if(!ah.geometry){ah.geometry=new O3D[ah.getData("type")]}ah.geometry.update(ah);if(!ah.webGLVertexBuffer){var S=[],K=[],Y=[],W=0,ab=ah.geometry;for(var af=0,ad=ab.vertices,Q=ab.faces,P=Q.length;af<P;af++){var V=Q[af],M=ad[V.a],L=ad[V.b],J=ad[V.c],H=V.d?ad[V.d]:false,aa=V.normal;S.push(M.x,M.y,M.z);S.push(L.x,L.y,L.z);S.push(J.x,J.y,J.z);if(H){S.push(H.x,H.y,H.z)}Y.push(aa.x,aa.y,aa.z);Y.push(aa.x,aa.y,aa.z);Y.push(aa.x,aa.y,aa.z);if(H){Y.push(aa.x,aa.y,aa.z)}K.push(W,W+1,W+2);if(H){K.push(W,W+2,W+3);W+=4}else{W+=3}}ah.webGLVertexBuffer=ae.createBuffer();ae.bindBuffer(ae.ARRAY_BUFFER,ah.webGLVertexBuffer);ae.bufferData(ae.ARRAY_BUFFER,new Float32Array(S),ae.STATIC_DRAW);ah.webGLFaceBuffer=ae.createBuffer();ae.bindBuffer(ae.ELEMENT_ARRAY_BUFFER,ah.webGLFaceBuffer);ae.bufferData(ae.ELEMENT_ARRAY_BUFFER,new Uint16Array(K),ae.STATIC_DRAW);ah.webGLFaceCount=K.length;ah.webGLNormalBuffer=ae.createBuffer();ae.bindBuffer(ae.ARRAY_BUFFER,ah.webGLNormalBuffer);ae.bufferData(ae.ARRAY_BUFFER,new Float32Array(Y),ae.STATIC_DRAW)}O.multiply(ag.matrix,ah.geometry.matrix);ae.uniformMatrix4fv(T.viewMatrix,false,O.flatten());ae.uniformMatrix4fv(T.projectionMatrix,false,ag.projectionMatrix.flatten());var U=Matrix4.makeInvert(O);U.$transpose();ae.uniformMatrix4fv(T.normalMatrix,false,U.flatten());var ac=e.hexToRgb(ah.getData("color"));ac.push(I.getAlpha());ae.uniform4f(T.color,ac[0]/255,ac[1]/255,ac[2]/255,ac[3]);ae.uniform1i(T.enableLighting,G.enable);if(G.enable){if(G.ambient){var X=G.ambient;ae.uniform3f(T.ambientColor,X[0],X[1],X[2])}if(G.directional){var Z=G.directional,ac=Z.color,R=Z.direction,F=new Vector3(R.x,R.y,R.z).normalize().$scale(-1);ae.uniform3f(T.lightingDirection,F.x,F.y,F.z);ae.uniform3f(T.directionalColor,ac[0],ac[1],ac[2])}}ae.bindBuffer(ae.ARRAY_BUFFER,ah.webGLVertexBuffer);ae.vertexAttribPointer(T.position,3,ae.FLOAT,false,0,0);ae.bindBuffer(ae.ARRAY_BUFFER,ah.webGLNormalBuffer);ae.vertexAttribPointer(T.normal,3,ae.FLOAT,false,0,0);ae.bindBuffer(ae.ELEMENT_ARRAY_BUFFER,ah.webGLFaceBuffer);ae.drawElements(ae.TRIANGLES,ah.webGLFaceCount,ae.UNSIGNED_SHORT,0)}});g.Label={};g.Label.Native=new v({initialize:function(F){this.viz=F},plotLabel:function(H,I,G){var F=H.getCtx();var J=I.pos.getc(true);F.font=I.getLabelData("style")+" "+I.getLabelData("size")+"px "+I.getLabelData("family");F.textAlign=I.getLabelData("textAlign");F.fillStyle=F.strokeStyle=I.getLabelData("color");F.textBaseline=I.getLabelData("textBaseline");this.renderLabel(H,I,G)},renderLabel:function(H,I,G){var F=H.getCtx();var J=I.pos.getc(true);F.fillText(I.name,J.x,J.y+I.getData("height")/2)},hideLabel:function(G,F){G=e.splat(G);var H=F?false:true;e.each(G,function(I){I._hideLabel=H})},hideLabels:e.empty});g.Label.DOM=new v({labelsHidden:false,labelContainer:false,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(F){return(F in this.labels&&this.labels[F]!=null)?this.labels[F]:this.labels[F]=document.getElementById(F)},hideLabels:function(G){var F=this.getLabelContainer();if(G){F.style.display="none"}else{F.style.display=""}this.labelsHidden=G},clearLabels:function(F){for(var G in this.labels){if(F||!this.viz.graph.hasNode(G)){this.disposeLabel(G);delete this.labels[G]}}},disposeLabel:function(G){var F=this.getLabel(G);if(F&&F.parentNode){F.parentNode.removeChild(F)}},hideLabel:function(J,F){J=e.splat(J);var G=F?"":"none",H,I=this;e.each(J,function(K){H=I.getLabel(K.id);if(H){H.style.display=G}})},fitsInCanvas:function(H,F){var G=F.getSize();if(H.w&&H.h){if(H.x>=G.width||H.x<-H.w||H.y>=G.height||H.y<-H.h){return false}}else{if(H.x>=G.width||H.x<0||H.y>=G.height||H.y<0){return false}}return true}});g.Label.HTML=new v({Implements:g.Label.DOM,plotLabel:function(I,J,H){var K=J.id,F=this.getLabel(K);if(!F&&!(F=document.getElementById(K))){F=document.createElement("div");var G=this.getLabelContainer();F.id=K;F.className="node";F.style.position="absolute";H.onCreateLabel(F,J);G.appendChild(F);this.labels[J.id]=F}this.placeLabel(F,J,H)}});g.Label.SVG=new v({Implements:g.Label.DOM,plotLabel:function(I,K,H){var M=K.id,F=this.getLabel(M);if(!F&&!(F=document.getElementById(M))){var J="http://www.w3.org/2000/svg";F=document.createElementNS(J,"svg:text");var L=document.createElementNS(J,"svg:tspan");F.appendChild(L);var G=this.getLabelContainer();F.setAttribute("id",M);F.setAttribute("class","node");G.appendChild(F);H.onCreateLabel(F,K);this.labels[K.id]=F}this.placeLabel(F,K,H)}});g.Geom=new v({initialize:function(F){this.viz=F;this.config=F.config;this.node=F.config.Node;this.edge=F.config.Edge},translate:function(G,F){F=e.splat(F);this.viz.graph.eachNode(function(H){e.each(F,function(I){H.getPos(I).$add(G)})})},setRightLevelToShow:function(I,F,K){var J=this.getRightLevelToShow(I,F),H=this.viz.labels,G=e.merge({execShow:true,execHide:true,onHide:e.empty,onShow:e.empty},K||{});I.eachLevel(0,this.config.levelsToShow,function(M){var L=M._depth-I._depth;if(L>J){G.onHide(M);if(G.execHide){M.drawn=false;M.exist=false;H.hideLabel(M,false)}}else{G.onShow(M);if(G.execShow){M.exist=true}}});I.drawn=true},getRightLevelToShow:function(I,G){var F=this.config;var J=F.levelsToShow;var H=F.constrained;if(!H){return J}while(!this.treeFitsInCanvas(I,G,J)&&J>1){J--}return J}});var f={construct:function(G){var H=(e.type(G)=="array");var F=new g(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);if(!H){(function(I,K){I.addNode(K);if(K.children){for(var J=0,L=K.children;J<L.length;J++){I.addAdjacence(K,L[J]);arguments.callee(I,L[J])}}})(F,G)}else{(function(Q,R){var J=function(V){for(var U=0,S=R.length;U<S;U++){if(R[U].id==V){return R[U]}}var T={id:V,name:V};return Q.addNode(T)};for(var N=0,K=R.length;N<K;N++){Q.addNode(R[N]);var O=R[N].adjacencies;if(O){for(var L=0,P=O.length;L<P;L++){var I=O[L],M={};if(typeof O[L]!="string"){M=e.merge(I.data,{});I=I.nodeTo}Q.addAdjacence(R[N],J(I),M)}}}})(F,G)}return F},loadJSON:function(G,F){this.json=G;if(this.labels&&this.labels.clearLabels){this.labels.clearLabels(true)}this.graph=this.construct(G);if(e.type(G)!="array"){this.root=G.id}else{this.root=G[F?F:0].id}},toJSON:function(J){J=J||"tree";if(J=="tree"){var H={};var G=this.graph.getNode(this.root);var H=(function F(M){var K={};K.id=M.id;K.name=M.name;K.data=M.data;var L=[];M.eachSubnode(function(N){L.push(F(N))});K.children=L;return K})(G);return H}else{var H=[];var I=!!this.graph.getNode(this.root).visited;this.graph.eachNode(function(L){var K={};K.id=L.id;K.name=L.name;K.data=L.data;var M=[];L.eachAdjacency(function(N){var P=N.nodeTo;if(!!P.visited===I){var O={};O.nodeTo=P.id;O.data=N.data;M.push(O)}});K.adjacencies=M;H.push(K);L.visited=!I});return H}}};var i=$jit.Layouts={};var h={label:null,compute:function(I,J,G){this.initializeLabel(G);var F=this.label,H=F.style;I.eachNode(function(M){var Q=M.getData("autoWidth"),R=M.getData("autoHeight");if(Q||R){delete M.data.$width;delete M.data.$height;delete M.data.$dim;var K=M.getData("width"),S=M.getData("height");H.width=Q?"auto":K+"px";H.height=R?"auto":S+"px";if(M.getData("label-size")){H.fontSize=M.getData("label-size")+"px"}else{H.fontSize=""}F.innerHTML=M.name;var O=F.offsetWidth,L=F.offsetHeight;var P=M.getData("type");if(e.indexOf(["circle","square","triangle","star"],P)===-1){M.setData("width",O);M.setData("height",L)}else{var N=O>L?O:L;M.setData("width",N);M.setData("height",N);M.setData("dim",N)}}})},initializeLabel:function(F){if(!this.label){this.label=document.createElement("div");document.body.appendChild(this.label)}this.setLabelStyles(F)},setLabelStyles:function(F){e.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}};i.Tree=(function(){var O=Array.prototype.slice;function M(Y,T,Q,W,R){var V=T.Node;var S=T.multitree;if(V.overridable){var X=-1,U=-1;Y.eachNode(function(ab){if(ab._depth==Q&&(!S||("$orn" in ab.data)&&ab.data.$orn==W)){var Z=ab.getData("width",R);var aa=ab.getData("height",R);X=(X<Z)?Z:X;U=(U<aa)?aa:U}});return{width:X<0?V.width:X,height:U<0?V.height:U}}else{return V}}function P(R,U,T,Q){var S=(Q=="left"||Q=="right")?"y":"x";R.getPos(U)[S]+=T}function K(R,S){var Q=[];e.each(R,function(T){T=O.call(T);T[0]+=S;T[1]+=S;Q.push(T)});return Q}function N(T,Q){if(T.length==0){return Q}if(Q.length==0){return T}var S=T.shift(),R=Q.shift();return[[S[0],R[1]]].concat(N(T,Q))}function I(Q,R){R=R||[];if(Q.length==0){return R}var S=Q.pop();return I(Q,N(S,R))}function L(T,R,U,Q,S){if(T.length<=S||R.length<=S){return 0}var W=T[S][1],V=R[S][0];return Math.max(L(T,R,U,Q,++S)+U,W-V+Q)}function J(T,R,Q){function S(W,Y,V){if(Y.length<=V){return[]}var X=Y[V],U=L(W,X,R,Q,0);return[U].concat(S(N(W,K(X,U)),Y,++V))}return S([],T,0)}function G(U,T,S){function Q(X,Z,W){if(Z.length<=W){return[]}var Y=Z[W],V=-L(Y,X,T,S,0);return[V].concat(Q(N(K(Y,V),X),Z,++W))}U=O.call(U);var R=Q([],U.reverse(),0);return R.reverse()}function F(W,U,R,X){var S=J(W,U,R),V=G(W,U,R);if(X=="left"){V=S}else{if(X=="right"){S=V}}for(var T=0,Q=[];T<S.length;T++){Q[T]=(S[T]+V[T])/2}return Q}function H(Q,aa,R,ah,af){var T=ah.multitree;var Z=["x","y"],W=["width","height"];var S=+(af=="left"||af=="right");var X=Z[S],ag=Z[1-S];var ac=ah.Node;var V=W[S],ae=W[1-S];var U=ah.siblingOffset;var ad=ah.subtreeOffset;var ab=ah.align;function Y(ak,ao,at){var aj=ak.getData(V,R);var ar=ao||(ak.getData(ae,R));var aw=[],au=[],ap=false;var ai=ar+ah.levelDistance;ak.eachSubnode(function(ay){if(ay.exist&&(!T||("$orn" in ay.data)&&ay.data.$orn==af)){if(ah.levelSpacing=="even"){if(!ap){ap=M(Q,ah,ay._depth,af,R)}}else{ap={width:ay.getData("width"),height:ay.getData("height")}}var ax=Y(ay,ap[ae],at+ai);aw.push(ax.tree);au.push(ax.extent)}});var an=F(au,ad,U,ab);for(var am=0,al=[],aq=[];am<aw.length;am++){P(aw[am],R,an[am],af);aq.push(K(au[am],an[am]))}var av=[[-aj/2,aj/2]].concat(I(aq));ak.getPos(R)[X]=0;if(af=="top"||af=="left"){ak.getPos(R)[ag]=at}else{ak.getPos(R)[ag]=-at}return{tree:ak,extent:av}}Y(aa,false,0)}return new v({compute:function(S,R){var T=S||"start";var Q=this.graph.getNode(this.root);e.extend(Q,{drawn:true,exist:true,selected:true});h.compute(this.graph,T,this.config);if(!!R||!("_depth" in Q)){this.graph.computeLevels(this.root,0,"ignore")}this.computePositions(Q,T)},computePositions:function(U,Q){var S=this.config;var R=S.multitree;var X=U.getData("align")||S.align;var T=X!=="center"&&S.indent;var Y=S.orientation;var W=R?["top","right","bottom","left"]:[Y];var V=this;e.each(W,function(Z){H(V.graph,U,Q,V.config,Z,Q);var aa=["x","y"][+(Z=="left"||Z=="right")];(function ab(ac){ac.eachSubnode(function(ad){if(ad.exist&&(!R||("$orn" in ad.data)&&ad.data.$orn==Z)){ad.getPos(Q)[aa]+=ac.getPos(Q)[aa];if(T){ad.getPos(Q)[aa]+=X=="left"?T:-T}ab(ad)}})})(U)})}})})();$jit.ST=(function(){var G=[];function H(M){M=M||this.clickedNode;if(!this.config.constrained){return[]}var J=this.geom;var Q=this.graph;var K=this.canvas;var I=M._depth,N=[];Q.eachNode(function(R){if(R.exist&&!R.selected){if(R.isDescendantOf(M.id)){if(R._depth<=I){N.push(R)}}else{N.push(R)}}});var O=J.getRightLevelToShow(M,K);M.eachLevel(O,O,function(R){if(R.exist&&!R.selected){N.push(R)}});for(var P=0;P<G.length;P++){var L=this.graph.getNode(G[P]);if(!L.isDescendantOf(M.id)){N.push(L)}}return N}function F(K){var J=[],I=this.config;K=K||this.clickedNode;this.clickedNode.eachLevel(0,I.levelsToShow,function(L){if(I.multitree&&!("$orn" in L.data)&&L.anySubnode(function(M){return M.exist&&!M.drawn})){J.push(L)}else{if(L.drawn&&!L.anySubnode("drawn")){J.push(L)}}});return J}return new v({Implements:[f,t,i.Tree],initialize:function(I){var K=$jit.ST;var J={levelsToShow:2,levelDistance:30,constrained:true,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0};this.controller=this.config=e.merge(q("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),J,I);var L=this.config;if(L.useCanvas){this.canvas=L.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(L.background){L.background=e.merge({type:"Circles"},L.background)}this.canvas=new p(this,L);this.config.labelContainer=(typeof L.injectInto=="string"?L.injectInto:L.injectInto.id)+"-label"}this.graphOptions={klass:u};this.graph=new g(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new K.Label[L.Label.type](this);this.fx=new K.Plot(this,K);this.op=new K.Op(this);this.group=new K.Group(this);this.geom=new K.Geom(this);this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(N,M,L){var I=this.geom,J=this.fx,K=this;if(!J.busy){J.busy=true;this.contract({onComplete:function(){I.switchOrientation(N);K.compute("end",false);J.busy=false;if(M=="animate"){K.onClick(K.clickedNode.id,L)}else{if(M=="replot"){K.select(K.clickedNode.id,L)}}}},N)}},switchAlignment:function(K,J,I){this.config.align=K;if(J=="animate"){this.select(this.clickedNode.id,I)}else{if(J=="replot"){this.onClick(this.clickedNode.id,I)}}},addNodeInPath:function(I){G.push(I);this.select((this.clickedNode&&this.clickedNode.id)||this.root)},clearNodesInPath:function(I){G.length=0;this.select((this.clickedNode&&this.clickedNode.id)||this.root)},refresh:function(){this.reposition();this.select((this.clickedNode&&this.clickedNode.id)||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(J){if(J.exist){J.drawn=true}});this.compute("end");if(this.clickedNode){var I={x:this.canvas.translateOffsetX+this.config.offsetX||0,y:this.canvas.translateOffsetY+this.config.offsetY||0};this.geom.translate(this.clickedNode.endPos.add(I).$scale(-1),"end")}},requestNodes:function(K,L){var J=e.merge(this.controller,L),I=this.config.levelsToShow;if(J.request){var N=[],M=K._depth;K.eachLevel(0,I,function(O){if(O.drawn&&!O.anySubnode()){N.push(O);O._level=I-(O._depth-M)}});this.group.requestNodes(N,J)}else{J.onComplete()}},contract:function(M,N){var L=this.config.orientation;var I=this.geom,K=this.group;if(N){I.switchOrientation(N)}var J=H.call(this);if(N){I.switchOrientation(L)}K.contract(J,e.merge(this.controller,M))},move:function(J,K){this.compute("end",false);var I=K.Move,L={x:I.offsetX,y:I.offsetY};if(I.enable){this.geom.translate(J.endPos.add(L).$scale(-1),"end")}else{this.geom.translate(x(L.x,L.y).$scale(-1),"end")}this.fx.animate(e.merge(this.controller,{modes:["linear"]},K))},expand:function(J,K){var I=F.call(this,J);this.group.expand(I,e.merge(this.controller,K))},selectPath:function(L){var K=this;this.graph.eachNode(function(N){N.selected=false});function M(O){if(O==null||O.selected){return}O.selected=true;e.each(K.group.getSiblings([O])[O.id],function(P){P.exist=true;P.drawn=true});var N=O.getParents();N=(N.length>0)?N[0]:null;M(N)}for(var I=0,J=[L.id].concat(G);I<J.length;I++){M(this.graph.getNode(J[I]))}},setRoot:function(P,O,N){if(this.busy){return}this.busy=true;var M=this,K=this.canvas;var I=this.graph.getNode(this.root);var J=this.graph.getNode(P);function L(){if(this.config.multitree&&J.data.$orn){var R=J.data.$orn;var S={left:"right",right:"left",top:"bottom",bottom:"top"}[R];I.data.$orn=S;(function Q(T){T.eachSubnode(function(U){if(U.id!=P){U.data.$orn=S;Q(U)}})})(I);delete J.data.$orn}this.root=P;this.clickedNode=J;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(J,K,{execHide:false,onShow:function(T){if(!T.drawn){T.drawn=true;T.setData("alpha",1,"end");T.setData("alpha",0);T.pos.setc(J.pos.x,J.pos.y)}}});this.compute("end");this.busy=true;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){M.busy=false;M.onClick(P,{onComplete:function(){N&&N.onComplete()}})}})}delete I.data.$orns;if(O=="animate"){L.call(this);M.selectPath(J)}else{if(O=="replot"){L.call(this);this.select(this.root)}}},addSubtree:function(I,K,J){if(K=="replot"){this.op.sum(I,e.extend({type:"replot"},J||{}))}else{if(K=="animate"){this.op.sum(I,e.extend({type:"fade:seq"},J||{}))}}},removeSubtree:function(N,J,M,L){var K=this.graph.getNode(N),I=[];K.eachLevel(+!J,false,function(O){I.push(O.id)});if(M=="replot"){this.op.removeNode(I,e.extend({type:"replot"},L||{}))}else{if(M=="animate"){this.op.removeNode(I,e.extend({type:"fade:seq"},L||{}))}}},select:function(I,L){var Q=this.group,O=this.geom;var M=this.graph.getNode(I),K=this.canvas;var P=this.graph.getNode(this.root);var J=e.merge(this.controller,L);var N=this;J.onBeforeCompute(M);this.selectPath(M);this.clickedNode=M;this.requestNodes(M,{onComplete:function(){Q.hide(Q.prepare(H.call(N)),J);O.setRightLevelToShow(M,K);N.compute("current");N.graph.eachNode(function(T){var S=T.pos.getc(true);T.startPos.setc(S.x,S.y);T.endPos.setc(S.x,S.y);T.visited=false});var R={x:J.offsetX,y:J.offsetY};N.geom.translate(M.endPos.add(R).$scale(-1),["start","current","end"]);Q.show(F.call(N));N.plot();J.onAfterCompute(N.clickedNode);J.onComplete()}})},onClick:function(J,Q){var L=this.canvas,P=this,I=this.geom,M=this.config;var O={Move:{enable:true,offsetX:L.translateOffsetX+M.offsetX||0,offsetY:L.translateOffsetY+M.offsetY||0},setRightLevelToShowConfig:false,onBeforeRequest:e.empty,onBeforeContract:e.empty,onBeforeMove:e.empty,onBeforeExpand:e.empty};var K=e.merge(this.controller,O,Q);if(!this.busy){this.busy=true;var N=this.graph.getNode(J);this.selectPath(N,this.clickedNode);this.clickedNode=N;K.onBeforeCompute(N);K.onBeforeRequest(N);this.requestNodes(N,{onComplete:function(){K.onBeforeContract(N);P.contract({onComplete:function(){I.setRightLevelToShow(N,L,K.setRightLevelToShowConfig);K.onBeforeMove(N);P.move(N,{Move:K.Move,onComplete:function(){K.onBeforeExpand(N);P.expand(N,{onComplete:function(){P.busy=false;K.onAfterCompute(J);K.onComplete()}})}})}})}})}}})})();$jit.ST.$extend=true;$jit.ST.Op=new v({Implements:g.Op});$jit.ST.Group=new v({initialize:function(F){this.viz=F;this.canvas=F.canvas;this.config=F.config;this.animation=new D;this.nodes=null},requestNodes:function(K,J){var I=0,G=K.length,M={};var H=function(){J.onComplete()};var F=this.viz;if(G==0){H()}for(var L=0;L<G;L++){M[K[L].id]=K[L];J.request(K[L].id,K[L]._level,{onComplete:function(O,N){if(N&&N.children){N.id=O;F.op.sum(N,{type:"nothing"})}if(++I==G){F.graph.computeLevels(F.root,0);H()}}})}},contract:function(H,G){var F=this.viz;var I=this;H=this.prepare(H);this.animation.setOptions(e.merge(G,{$animating:false,compute:function(J){if(J==1){J=0.99}I.plotStep(1-J,G,this.$animating);this.$animating="contract"},complete:function(){I.hide(H,G)}})).start()},hide:function(H,G){var F=this.viz;for(var I=0;I<H.length;I++){if(true||!G||!G.request){H[I].eachLevel(1,false,function(K){if(K.exist){e.extend(K,{drawn:false,exist:false})}})}else{var J=[];H[I].eachLevel(1,false,function(K){J.push(K.id)});F.op.removeNode(J,{type:"nothing"});F.labels.clearLabels()}}G.onComplete()},expand:function(G,F){var H=this;this.show(G);this.animation.setOptions(e.merge(F,{$animating:false,compute:function(I){H.plotStep(I,F,this.$animating);this.$animating="expand"},complete:function(){H.plotStep(undefined,F,false);F.onComplete()}})).start()},show:function(F){var G=this.config;this.prepare(F);e.each(F,function(I){if(G.multitree&&!("$orn" in I.data)){delete I.data.$orns;var H=" ";I.eachSubnode(function(J){if(("$orn" in J.data)&&H.indexOf(J.data.$orn)<0&&J.exist&&!J.drawn){H+=J.data.$orn+" "}});I.data.$orns=H}I.eachLevel(0,G.levelsToShow,function(J){if(J.exist){J.drawn=true}})})},prepare:function(F){this.nodes=this.getNodesWithChildren(F);return this.nodes},getNodesWithChildren:function(H){var G=[],J=this.config,F=this.viz.root;H.sort(function(N,M){return(N._depth<=M._depth)-(N._depth>=M._depth)});for(var K=0;K<H.length;K++){if(H[K].anySubnode("exist")){for(var I=K+1,L=false;!L&&I<H.length;I++){if(!J.multitree||"$orn" in H[I].data){L=L||H[K].isDescendantOf(H[I].id)}}if(!L){G.push(H[K])}}}return G},plotStep:function(P,L,R){var O=this.viz,I=this.config,H=O.canvas,Q=H.getCtx(),F=this.nodes;var K,J;var G={};for(K=0;K<F.length;K++){J=F[K];G[J.id]=[];var N=I.multitree&&!("$orn" in J.data);var M=N&&J.data.$orns;J.eachSubgraph(function(S){if(N&&M&&M.indexOf(S.data.$orn)>0&&S.drawn){S.drawn=false;G[J.id].push(S)}else{if((!N||!M)&&S.drawn){S.drawn=false;G[J.id].push(S)}}});J.drawn=true}if(F.length>0){O.fx.plot()}for(K in G){e.each(G[K],function(S){S.drawn=true})}for(K=0;K<F.length;K++){J=F[K];Q.save();O.fx.plotSubtree(J,L,P,R);Q.restore()}},getSiblings:function(F){var G={};e.each(F,function(J){var I=J.getParents();if(I.length==0){G[J.id]=[J]}else{var H=[];I[0].eachSubnode(function(K){H.push(K)});G[J.id]=H}});return G}});$jit.ST.Geom=new v({Implements:g.Geom,switchOrientation:function(F){this.config.orientation=F},dispatch:function(){var G=Array.prototype.slice.call(arguments);var H=G.shift(),F=G.length;var I=function(J){return typeof J=="function"?J():J};if(F==2){return(H=="top"||H=="bottom")?I(G[0]):I(G[1])}else{if(F==4){switch(H){case"top":return I(G[0]);case"right":return I(G[1]);case"bottom":return I(G[2]);case"left":return I(G[3])}}}return undefined},getSize:function(M,L){var K=M.data,H=this.config;var G=H.siblingOffset;var J=(H.multitree&&("$orn" in K)&&K.$orn)||H.orientation;var F=M.getData("width")+G;var I=M.getData("height")+G;if(!L){return this.dispatch(J,I,F)}else{return this.dispatch(J,F,I)}},getTreeBaseSize:function(J,K,G){var H=this.getSize(J,true),F=0,I=this;if(G(K,J)){return H}if(K===0){return 0}J.eachSubnode(function(L){F+=I.getTreeBaseSize(L,K-1,G)});return(H>F?H:F)+this.config.subtreeOffset},getEdge:function(K,J,I){var G=function(O,N){return function(){return K.pos.add(new u(O,N))}};var L=this.node;var M=K.getData("align")||L.align;var F=K.getData("width");var H=K.getData("height");if(J=="begin"){if(M=="center"){return this.dispatch(I,G(0,H/2),G(-F/2,0),G(0,-H/2),G(F/2,0))}else{if(M=="left"){return this.dispatch(I,G(0,H),G(0,0),G(0,0),G(F,0))}else{if(M=="right"){return this.dispatch(I,G(0,0),G(-F,0),G(0,-H),G(0,0))}else{throw"align: not implemented"}}}}else{if(J=="end"){if(M=="center"){return this.dispatch(I,G(0,-H/2),G(F/2,0),G(0,H/2),G(-F/2,0))}else{if(M=="left"){return this.dispatch(I,G(0,0),G(F,0),G(0,H),G(0,0))}else{if(M=="right"){return this.dispatch(I,G(0,-H),G(0,0),G(0,0),G(-F,0))}else{throw"align: not implemented"}}}}}},getScaledTreePosition:function(J,L){var K=this.node;var M=J.getData("align")||K.align;var F=J.getData("width");var I=J.getData("height");var H=(this.config.multitree&&("$orn" in J.data)&&J.data.$orn)||this.config.orientation;var G=function(O,N){return function(){return J.pos.add(new u(O,N)).$scale(1-L)}};if(M=="left"){return this.dispatch(H,G(0,I),G(0,0),G(0,0),G(F,0))}else{if(M=="center"){return this.dispatch(H,G(0,I/2),G(-F/2,0),G(0,-I/2),G(F/2,0))}else{if(M=="right"){return this.dispatch(H,G(0,0),G(-F,0),G(0,-I),G(0,0))}else{throw"align: not implemented"}}}},treeFitsInCanvas:function(K,F,L){var H=F.getSize();var I=(this.config.multitree&&("$orn" in K.data)&&K.data.$orn)||this.config.orientation;var G=this.dispatch(I,H.width,H.height);var J=this.getTreeBaseSize(K,L,function(N,M){return N===0||!M.anySubnode()});return(J<G)}});$jit.ST.Plot=new v({Implements:g.Plot,plotSubtree:function(I,F,J,N){var L=this.viz,G=L.canvas,H=L.config;J=Math.min(Math.max(0.001,J),1);if(J>=0){I.drawn=false;var M=G.getCtx();var K=L.geom.getScaledTreePosition(I,J);M.translate(K.x,K.y);M.scale(J,J)}this.plotTree(I,e.merge(F,{withLabels:true,hideLabels:!!J,plotSubtree:function(R,P){var O=H.multitree&&!("$orn" in I.data);var Q=O&&I.getData("orns");return !O||Q.indexOf(I.getData("orn"))>-1}}),N);if(J>=0){I.drawn=true}},getAlignedPos:function(K,I,F){var H=this.node;var J,G;if(H.align=="center"){J={x:K.x-I/2,y:K.y-F/2}}else{if(H.align=="left"){G=this.config.orientation;if(G=="bottom"||G=="top"){J={x:K.x-I/2,y:K.y}}else{J={x:K.x,y:K.y-F/2}}}else{if(H.align=="right"){G=this.config.orientation;if(G=="bottom"||G=="top"){J={x:K.x-I/2,y:K.y-F}}else{J={x:K.x-I,y:K.y-F/2}}}else{throw"align: not implemented"}}}return J},getOrientation:function(F){var H=this.config;var G=H.orientation;if(H.multitree){var I=F.nodeFrom;var J=F.nodeTo;G=(("$orn" in I.data)&&I.data.$orn)||(("$orn" in J.data)&&J.data.$orn)}return G}});$jit.ST.Label={};$jit.ST.Label.Native=new v({Implements:g.Label.Native,renderLabel:function(I,K,H){var G=I.getCtx(),M=K.pos.getc(true),J=K.getData("width"),F=K.getData("height"),L=this.viz.fx.getAlignedPos(M,J,F);G.fillText(K.name,L.x+J/2,L.y+F/2)}});$jit.ST.Label.DOM=new v({Implements:g.Label.DOM,placeLabel:function(Y,R,N){var J=R.pos.getc(true),X=this.viz.config,T=X.Node,S=R.getData("align")||T.align,F=this.viz.canvas,K=R.getData("width"),V=R.getData("height"),G=F.getSize(),O,W;var I=F.translateOffsetX,H=F.translateOffsetY,M=F.scaleOffsetX,L=F.scaleOffsetY,Q=J.x*M+I,P=J.y*L+H;if(S=="center"){O={x:Math.round(Q-K/2+G.width/2),y:Math.round(P-V/2+G.height/2)}}else{if(S=="left"){W=X.orientation;if(W=="bottom"||W=="top"){O={x:Math.round(Q-K/2+G.width/2),y:Math.round(P+G.height/2)}}else{O={x:Math.round(Q+G.width/2),y:Math.round(P-V/2+G.height/2)}}}else{if(S=="right"){W=X.orientation;if(W=="bottom"||W=="top"){O={x:Math.round(Q-K/2+G.width/2),y:Math.round(P-V+G.height/2)}}else{O={x:Math.round(Q-K+G.width/2),y:Math.round(P-V/2+G.height/2)}}}else{throw"align: not implemented"}}}O.w=K;O.h=V;var U=Y.style;U.left=O.x+"px";U.top=O.y+"px";U.display=this.fitsInCanvas(O,F)?"":"none";N.onPlaceLabel(Y,R)}});$jit.ST.Label.SVG=new v({Implements:[$jit.ST.Label.DOM,g.Label.SVG],initialize:function(F){this.viz=F}});$jit.ST.Label.HTML=new v({Implements:[$jit.ST.Label.DOM,g.Label.HTML],initialize:function(F){this.viz=F}});$jit.ST.Plot.NodeTypes=new v({none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(G,F){var I=G.getData("dim"),J=this.getAlignedPos(G.pos.getc(true),I,I),H=I/2;this.nodeHelper.circle.render("fill",{x:J.x+H,y:J.y+H},H,F)},contains:function(F,J){var H=F.getData("dim"),I=this.getAlignedPos(F.pos.getc(true),H,H),G=H/2;return this.nodeHelper.circle.contains({x:I.x+G,y:I.y+G},J,G)}},square:{render:function(G,F){var I=G.getData("dim"),H=I/2,J=this.getAlignedPos(G.pos.getc(true),I,I);this.nodeHelper.square.render("fill",{x:J.x+H,y:J.y+H},H,F)},contains:function(F,J){var H=F.getData("dim"),I=this.getAlignedPos(F.pos.getc(true),H,H),G=H/2;return this.nodeHelper.square.contains({x:I.x+G,y:I.y+G},J,G)}},ellipse:{render:function(I,G){var H=I.getData("width"),F=I.getData("height"),J=this.getAlignedPos(I.pos.getc(true),H,F);this.nodeHelper.ellipse.render("fill",{x:J.x+H/2,y:J.y+F/2},H,F,G)},contains:function(H,J){var G=H.getData("width"),F=H.getData("height"),I=this.getAlignedPos(H.pos.getc(true),G,F);return this.nodeHelper.ellipse.contains({x:I.x+G/2,y:I.y+F/2},J,G,F)}},rectangle:{render:function(I,G){var H=I.getData("width"),F=I.getData("height"),J=this.getAlignedPos(I.pos.getc(true),H,F);this.nodeHelper.rectangle.render("fill",{x:J.x+H/2,y:J.y+F/2},H,F,G)},contains:function(H,J){var G=H.getData("width"),F=H.getData("height"),I=this.getAlignedPos(H.pos.getc(true),G,F);return this.nodeHelper.rectangle.contains({x:I.x+G/2,y:I.y+F/2},J,G,F)}},roundedRectangle:{render:function(J,H){var I=J.getData("width"),G=J.getData("height"),F=J.getData("radius"),K=this.getAlignedPos(J.pos.getc(true),I,G);this.nodeHelper.roundedRectangle.render("fill",{x:K.x+I/2,y:K.y+G/2},I,G,F,H)},contains:function(I,K){var H=I.getData("width"),G=I.getData("height"),F=I.getData("radius"),J=this.getAlignedPos(I.pos.getc(true),H,G);this.nodeHelper.rectangle.contains({x:J.x+H/2,y:J.y+G/2},K,H,G,F)}}});$jit.ST.Plot.EdgeTypes=new v({none:e.empty,line:{render:function(G,I){var H=this.getOrientation(G),J=G.nodeFrom,K=G.nodeTo,F=J._depth<K._depth,M=this.viz.geom.getEdge(F?J:K,"begin",H),L=this.viz.geom.getEdge(F?K:J,"end",H);this.edgeHelper.line.render(M,L,I)},contains:function(G,M){var H=this.getOrientation(G),I=G.nodeFrom,J=G.nodeTo,F=I._depth<J._depth,L=this.viz.geom.getEdge(F?I:J,"begin",H),K=this.viz.geom.getEdge(F?J:I,"end",H);return this.edgeHelper.line.contains(L,K,M,this.edge.epsilon)}},arrow:{render:function(L,G){var K=this.getOrientation(L),H=L.nodeFrom,F=L.nodeTo,P=(H._depth<F._depth),J=L.getData("dim"),O=this.viz.geom.getEdge((P?H:F),"begin",K),N=this.viz.geom.getEdge((P?F:H),"end",K),M=L.data.$direction,I=(M&&M.length>1&&M[0]!=H.id);this.edgeHelper.arrow.render(O,N,J,I,G)},contains:function(G,M){var H=this.getOrientation(G),I=G.nodeFrom,J=G.nodeTo,F=I._depth<J._depth,L=this.viz.geom.getEdge(F?I:J,"begin",H),K=this.viz.geom.getEdge(F?J:I,"end",H);return this.edgeHelper.arrow.contains(L,K,M,this.edge.epsilon)}},"quadratic:begin":{render:function(L,F){var K=this.getOrientation(L);var J=L.nodeFrom,M=L.nodeTo,O=J._depth<M._depth,G=this.viz.geom.getEdge(O?J:M,"begin",K),H=this.viz.geom.getEdge(O?M:J,"end",K),I=L.getData("dim"),N=F.getCtx();N.beginPath();N.moveTo(G.x,G.y);switch(K){case"left":N.quadraticCurveTo(G.x+I,G.y,H.x,H.y);break;case"right":N.quadraticCurveTo(G.x-I,G.y,H.x,H.y);break;case"top":N.quadraticCurveTo(G.x,G.y+I,H.x,H.y);break;case"bottom":N.quadraticCurveTo(G.x,G.y-I,H.x,H.y);break}N.stroke()}},"quadratic:end":{render:function(L,F){var K=this.getOrientation(L);var J=L.nodeFrom,M=L.nodeTo,O=J._depth<M._depth,G=this.viz.geom.getEdge(O?J:M,"begin",K),H=this.viz.geom.getEdge(O?M:J,"end",K),I=L.getData("dim"),N=F.getCtx();N.beginPath();N.moveTo(G.x,G.y);switch(K){case"left":N.quadraticCurveTo(H.x-I,H.y,H.x,H.y);break;case"right":N.quadraticCurveTo(H.x+I,H.y,H.x,H.y);break;case"top":N.quadraticCurveTo(H.x,H.y-I,H.x,H.y);break;case"bottom":N.quadraticCurveTo(H.x,H.y+I,H.x,H.y);break}N.stroke()}},bezier:{render:function(L,F){var K=this.getOrientation(L),J=L.nodeFrom,M=L.nodeTo,O=J._depth<M._depth,G=this.viz.geom.getEdge(O?J:M,"begin",K),H=this.viz.geom.getEdge(O?M:J,"end",K),I=L.getData("dim"),N=F.getCtx();N.beginPath();N.moveTo(G.x,G.y);switch(K){case"left":N.bezierCurveTo(G.x+I,G.y,H.x-I,H.y,H.x,H.y);break;case"right":N.bezierCurveTo(G.x-I,G.y,H.x+I,H.y,H.x,H.y);break;case"top":N.bezierCurveTo(G.x,G.y+I,H.x,H.y-I,H.x,H.y);break;case"bottom":N.bezierCurveTo(G.x,G.y-I,H.x,H.y+I,H.x,H.y);break}N.stroke()}}});$jit.ST.Plot.NodeTypes.implement({"areachart-stacked":{render:function(ad,K){var ab=ad.pos.getc(true),F=ad.getData("width"),H=ad.getData("height"),N=this.getAlignedPos(ab,F,H),ai=N.x,ah=N.y,S=ad.getData("stringArray"),M=ad.getData("dimArray"),I=ad.getData("valueArray"),ak=e.reduce(I,function(ar,at){return ar+at[0]},0),aj=e.reduce(I,function(ar,at){return ar+at[1]},0),P=ad.getData("colorArray"),J=P.length,af=ad.getData("config"),Q=ad.getData("gradient"),aq=af.showLabels,U=af.showAggregates,am=af.Label,aa=ad.getData("prev");var T=K.getCtx(),O=ad.getData("border");if(P&&M&&S){for(var ap=0,an=M.length,R=0,L=0,ae=0;ap<an;ap++){T.fillStyle=T.strokeStyle=P[ap%J];T.save();if(Q&&(M[ap][0]>0||M[ap][1]>0)){var Y=R+M[ap][0],W=L+M[ap][1],ao=Math.atan((W-Y)/F),ag=55;var ac=T.createLinearGradient(ai+F/2,ah-(Y+W)/2,ai+F/2+ag*Math.sin(ao),ah-(Y+W)/2+ag*Math.cos(ao));var X=e.rgbToHex(e.map(e.hexToRgb(P[ap%J].slice(1)),function(ar){return(ar*0.85)>>0}));ac.addColorStop(0,P[ap%J]);ac.addColorStop(1,X);T.fillStyle=ac}T.beginPath();T.moveTo(ai,ah-R);T.lineTo(ai+F,ah-L);T.lineTo(ai+F,ah-L-M[ap][1]);T.lineTo(ai,ah-R-M[ap][0]);T.lineTo(ai,ah-R);T.fill();T.restore();if(O){var Z=O.name==S[ap];var G=Z?0.7:0.8;var X=e.rgbToHex(e.map(e.hexToRgb(P[ap%J].slice(1)),function(ar){return(ar*G)>>0}));T.strokeStyle=X;T.lineWidth=Z?4:1;T.save();T.beginPath();if(O.index===0){T.moveTo(ai,ah-R);T.lineTo(ai,ah-R-M[ap][0])}else{T.moveTo(ai+F,ah-L);T.lineTo(ai+F,ah-L-M[ap][1])}T.stroke();T.restore()}R+=(M[ap][0]||0);L+=(M[ap][1]||0);if(M[ap][0]>0){ae+=(I[ap][0]||0)}}if(aa&&am.type=="Native"){T.save();T.beginPath();T.fillStyle=T.strokeStyle=am.color;T.font=am.style+" "+am.size+"px "+am.family;T.textAlign="center";T.textBaseline="middle";var V=U(ad.name,ak,aj,ad,ae);if(V!==false){T.fillText(V!==true?V:ae,ai,ah-R-af.labelOffset-am.size/2,F)}var al=aq(ad.name,ak,aj,ad);if(al!==false){T.fillText(al!==true?al:ad.name,ai,ah+am.size/2+af.labelOffset)}T.restore()}}},contains:function(J,L){var Q=J.pos.getc(true),G=J.getData("width"),U=J.getData("height"),T=this.getAlignedPos(Q,G,U),S=T.x,R=T.y,V=J.getData("dimArray"),F=L.x-S;if(L.x<S||L.x>S+G||L.y>R||L.y<R-U){return false}for(var M=0,K=V.length,P=R,H=R;M<K;M++){var I=V[M];P-=I[0];H-=I[1];var N=P+(H-P)*F/G;if(L.y>=N){var O=+(F>G/2);return{name:J.getData("stringArray")[M],color:J.getData("colorArray")[M],value:J.getData("valueArray")[M][O],index:O}}}return false}}});$jit.AreaChart=new v({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(H){this.controller=this.config=e.merge(q("Canvas","Margin","Label","AreaChart"),{Label:{type:"Native"}},H);var I=this.config.showLabels,G=e.type(I),J=this.config.showAggregates,F=e.type(J);this.config.showLabels=G=="function"?I:e.lambda(I);this.config.showAggregates=F=="function"?J:e.lambda(J);this.initializeViz()},initializeViz:function(){var G=this.config,K=this,F=G.type.split(":")[0],J={};var I=new $jit.ST({injectInto:G.injectInto,width:G.width,height:G.height,orientation:"bottom",levelDistance:0,siblingOffset:0,subtreeOffset:0,withLabels:G.Label.type!="Native",useCanvas:G.useCanvas,Label:{type:G.Label.type},Node:{overridable:true,type:"areachart-"+F,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:G.Tips.enable,type:"Native",force:true,onShow:function(P,O,M){var N=M;G.Tips.onShow(P,N,O)}},Events:{enable:true,type:"Native",onClick:function(O,P,M){if(!G.filterOnClick&&!G.Events.enable){return}var N=P.getContains();if(N){G.filterOnClick&&K.filter(N.name)}G.Events.enable&&G.Events.onClick(N,P,M)},onRightClick:function(N,O,M){if(!G.restoreOnRightClick){return}K.restore()},onMouseMove:function(O,P,M){if(!G.selectOnHover){return}if(O){var N=P.getContains();K.select(O.id,N.name,N.index)}else{K.select(false,false,false)}}},onCreateLabel:function(S,P){var Y=G.Label,X=P.getData("valueArray"),Q=e.reduce(X,function(Z,aa){return Z+aa[0]},0),V=e.reduce(X,function(Z,aa){return Z+aa[1]},0);if(P.getData("prev")){var U={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")};var M=U.wrapper,W=U.label,N=U.aggregate,O=M.style,T=W.style,R=N.style;J[P.id]=U;M.appendChild(W);M.appendChild(N);if(!G.showLabels(P.name,Q,V,P)){W.style.display="none"}if(!G.showAggregates(P.name,Q,V,P)){N.style.display="none"}O.position="relative";O.overflow="visible";O.fontSize=Y.size+"px";O.fontFamily=Y.family;O.color=Y.color;O.textAlign="center";R.position=T.position="absolute";S.style.width=P.getData("width")+"px";S.style.height=P.getData("height")+"px";W.innerHTML=P.name;S.appendChild(M)}},onPlaceLabel:function(ae,Y){if(!Y.getData("prev")){return}var ac=J[Y.id],N=ac.wrapper.style,M=ac.label.style,X=ac.aggregate.style,V=Y.getData("width"),T=Y.getData("height"),S=Y.getData("dimArray"),P=Y.getData("valueArray"),U=e.reduce(P,function(af,ag){return af+ag[0]},0),Q=e.reduce(P,function(af,ag){return af+ag[1]},0),R=parseInt(N.fontSize,10),W=ae.style;if(S&&P){if(G.showLabels(Y.name,U,Q,Y)){M.display=""}else{M.display="none"}var O=G.showAggregates(Y.name,U,Q,Y);if(O!==false){X.display=""}else{X.display="none"}N.width=X.width=M.width=ae.style.width=V+"px";X.left=M.left=-V/2+"px";for(var ab=0,Z=P.length,aa=0,ad=0;ab<Z;ab++){if(S[ab][0]>0){aa+=P[ab][0];ad+=S[ab][0]}}X.top=(-R-G.labelOffset)+"px";M.top=(G.labelOffset+ad)+"px";ae.style.top=parseInt(ae.style.top,10)-ad+"px";ae.style.height=N.height=ad+"px";ac.aggregate.innerHTML=O!==true?O:aa}}});var H=I.canvas.getSize(),L=G.Margin;I.config.offsetY=-H.height/2+L.bottom+(G.showLabels&&(G.labelOffset+G.Label.size));I.config.offsetX=(L.right-L.left)/2;this.delegate=I;this.canvas=this.delegate.canvas},loadJSON:function(W){var S=e.time(),K=[],V=this.delegate,Z=e.splat(W.label),R=e.splat(W.color||this.colors),X=this.config,G=!!X.type.split(":")[1],I=X.animate;for(var T=0,H=W.values,Q=H.length;T<Q-1;T++){var Y=H[T],N=H[T-1],O=H[T+1];var U=e.splat(H[T].values),F=e.splat(H[T+1].values);var J=e.zip(U,F);var M=0,L=0;K.push({id:S+Y.label,name:Y.label,data:{value:J,"$valueArray":J,"$colorArray":R,"$stringArray":Z,"$next":O.label,"$prev":N?N.label:false,"$config":X,"$gradient":G},children:[]})}var P={id:S+"$root",name:"",data:{"$type":"none","$width":1,"$height":1},children:K};V.loadJSON(P);this.normalizeDims();V.compute();V.select(V.root);if(I){V.fx.animate({modes:["node-property:height:dimArray"],duration:1500})}},updateJSON:function(P,G){if(this.busy){return}this.busy=true;var M=this.delegate,O=M.graph,J=P.label&&e.splat(P.label),N=P.values,F=this.config.animate,L=this,K={};for(var I=0,H=N.length;I<H;I++){K[N[I].label]=N[I]}O.eachNode(function(U){var Q=K[U.name],R=U.getData("stringArray"),T=U.getData("valueArray"),S=U.getData("next");if(Q){Q.values=e.splat(Q.values);e.each(T,function(V,W){V[0]=Q.values[W];if(J){R[W]=J[W]}});U.setData("valueArray",T)}if(S){Q=K[S];if(Q){e.each(T,function(V,W){V[1]=Q.values[W]})}}});this.normalizeDims();M.compute();M.select(M.root);if(F){M.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){L.busy=false;G&&G.onComplete()}})}},filter:function(I,J){if(this.busy){return}this.busy=true;if(this.config.Tips.enable){this.delegate.tips.hide()}this.select(false,false,false);var G=e.splat(I);var F=this.delegate.graph.getNode(this.delegate.root);var H=this;this.normalizeDims();F.eachAdjacency(function(K){var N=K.nodeTo,M=N.getData("dimArray","end"),L=N.getData("stringArray");N.setData("dimArray",e.map(M,function(P,O){return(e.indexOf(G,L[O])>-1)?P:[0,0]}),"end")});this.delegate.fx.animate({modes:["node-property:dimArray"],duration:1500,onComplete:function(){H.busy=false;J&&J.onComplete()}})},restore:function(G){if(this.busy){return}this.busy=true;if(this.config.Tips.enable){this.delegate.tips.hide()}this.select(false,false,false);this.normalizeDims();var F=this;this.delegate.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){F.busy=false;G&&G.onComplete()}})},select:function(K,G,F){if(!this.config.selectOnHover){return}var H=this.selected;if(H.id!=K||H.name!=G||H.index!=F){H.id=K;H.name=G;H.index=F;this.delegate.graph.eachNode(function(L){L.setData("border",false)});if(K){var J=this.delegate.graph.getNode(K);J.setData("border",H);var I=F===0?"prev":"next";I=J.getData(I);if(I){J=this.delegate.graph.getByName(I);if(J){J.setData("border",{name:G,index:1-F})}}}this.delegate.plot()}},getLegend:function(){var H={};var I;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(J){I=J.nodeTo});var G=I.getData("colorArray"),F=G.length;e.each(I.getData("stringArray"),function(K,J){H[K]=G[J%F]});return H},getMaxValue:function(){var F=0;this.delegate.graph.eachNode(function(K){var H=K.getData("valueArray"),G=0,J=0;e.each(H,function(L){G+=+L[0];J+=+L[1]});var I=J>G?J:G;F=F>I?F:I});return F},normalizeDims:function(){var L=this.delegate.graph.getNode(this.delegate.root),I=0;L.eachAdjacency(function(){I++});var K=this.getMaxValue()||1,O=this.delegate.canvas.getSize(),H=this.config,J=H.Margin,M=H.labelOffset+H.Label.size,F=(O.width-(J.left+J.right))/I,G=H.animate,N=O.height-(J.top+J.bottom)-(H.showAggregates&&M)-(H.showLabels&&M);this.delegate.graph.eachNode(function(U){var R=0,T=0,P=[];e.each(U.getData("valueArray"),function(V){R+=+V[0];T+=+V[1];P.push([0,0])});var S=T>R?T:R;U.setData("width",F);if(G){U.setData("height",S*N/K,"end");U.setData("dimArray",e.map(U.getData("valueArray"),function(V){return[V[0]*N/K,V[1]*N/K]}),"end");var Q=U.getData("dimArray");if(!Q){U.setData("dimArray",P)}}else{U.setData("height",S*N/K);U.setData("dimArray",e.map(U.getData("valueArray"),function(V){return[V[0]*N/K,V[1]*N/K]}))}})}});q.BarChart={$extend:true,animate:true,type:"stacked",labelOffset:3,barsOffset:0,hoveredColor:"#9fd4ff",orientation:"horizontal",showAggregates:true,showLabels:true,Tips:{enable:false,onShow:e.empty,onHide:e.empty},Events:{enable:false,onClick:e.empty}};$jit.ST.Plot.NodeTypes.implement({"barchart-stacked":{render:function(Y,J){var O=Y.pos.getc(true),X=Y.getData("width"),V=Y.getData("height"),T=this.getAlignedPos(O,X,V),S=T.x,R=T.y,U=Y.getData("dimArray"),M=Y.getData("valueArray"),L=Y.getData("colorArray"),I=L.length,af=Y.getData("stringArray");var aa=J.getCtx(),F={},ab=Y.getData("border"),G=Y.getData("gradient"),ah=Y.getData("config"),H=ah.orientation=="horizontal",K=ah.showAggregates,W=ah.showLabels,Q=ah.Label;if(L&&U&&af){for(var ae=0,Z=U.length,ad=0,N=0;ae<Z;ae++){aa.fillStyle=aa.strokeStyle=L[ae%I];if(G){var ag;if(H){ag=aa.createLinearGradient(S+ad+U[ae]/2,R,S+ad+U[ae]/2,R+V)}else{ag=aa.createLinearGradient(S,R-ad-U[ae]/2,S+X,R-ad-U[ae]/2)}var ac=e.rgbToHex(e.map(e.hexToRgb(L[ae%I].slice(1)),function(ai){return(ai*0.5)>>0}));ag.addColorStop(0,ac);ag.addColorStop(0.5,L[ae%I]);ag.addColorStop(1,ac);aa.fillStyle=ag}if(H){aa.fillRect(S+ad,R,U[ae],V)}else{aa.fillRect(S,R-ad-U[ae],X,U[ae])}if(ab&&ab.name==af[ae]){F.acum=ad;F.dimValue=U[ae]}ad+=(U[ae]||0);N+=(M[ae]||0)}if(ab){aa.save();aa.lineWidth=2;aa.strokeStyle=ab.color;if(H){aa.strokeRect(S+F.acum+1,R+1,F.dimValue-2,V-2)}else{aa.strokeRect(S+1,R-F.acum-F.dimValue+1,X-2,F.dimValue-2)}aa.restore()}if(Q.type=="Native"){aa.save();aa.fillStyle=aa.strokeStyle=Q.color;aa.font=Q.style+" "+Q.size+"px "+Q.family;aa.textBaseline="middle";var P=K(Y.name,N,Y);if(P!==false){P=P!==true?P:N;if(H){aa.textAlign="right";aa.fillText(P,S+ad-ah.labelOffset,R+V/2)}else{aa.textAlign="center";aa.fillText(P,S+X/2,R-V-Q.size/2-ah.labelOffset)}}if(W(Y.name,N,Y)){if(H){aa.textAlign="center";aa.translate(S-ah.labelOffset-Q.size/2,R+V/2);aa.rotate(Math.PI/2);aa.fillText(Y.name,0,0)}else{aa.textAlign="center";aa.fillText(Y.name,S+X/2,R+Q.size/2+ah.labelOffset)}}aa.restore()}}},contains:function(K,M){var P=K.pos.getc(true),H=K.getData("width"),U=K.getData("height"),T=this.getAlignedPos(P,H,U),S=T.x,Q=T.y,V=K.getData("dimArray"),I=K.getData("config"),G=M.x-S,F=I.orientation=="horizontal";if(F){if(M.x<S||M.x>S+H||M.y>Q+U||M.y<Q){return false}}else{if(M.x<S||M.x>S+H||M.y>Q||M.y<Q-U){return false}}for(var N=0,L=V.length,R=(F?S:Q);N<L;N++){var J=V[N];if(F){R+=J;var O=R;if(M.x<=O){return{name:K.getData("stringArray")[N],color:K.getData("colorArray")[N],value:K.getData("valueArray")[N],label:K.name}}}else{R-=J;var O=R;if(M.y>=O){return{name:K.getData("stringArray")[N],color:K.getData("colorArray")[N],value:K.getData("valueArray")[N],label:K.name}}}}return false}},"barchart-grouped":{render:function(aa,J){var P=aa.pos.getc(true),Z=aa.getData("width"),X=aa.getData("height"),U=this.getAlignedPos(P,Z,X),T=U.x,S=U.y,W=aa.getData("dimArray"),N=aa.getData("valueArray"),ag=N.length,M=aa.getData("colorArray"),I=M.length,ai=aa.getData("stringArray");var ac=J.getCtx(),F={},ad=aa.getData("border"),G=aa.getData("gradient"),ak=aa.getData("config"),H=ak.orientation=="horizontal",L=ak.showAggregates,Y=ak.showLabels,R=ak.Label,K=(H?X:Z)/ag;if(M&&W&&ai){for(var ah=0,ab=ag,af=0,O=0;ah<ab;ah++){ac.fillStyle=ac.strokeStyle=M[ah%I];if(G){var aj;if(H){aj=ac.createLinearGradient(T+W[ah]/2,S+K*ah,T+W[ah]/2,S+K*(ah+1))}else{aj=ac.createLinearGradient(T+K*ah,S-W[ah]/2,T+K*(ah+1),S-W[ah]/2)}var ae=e.rgbToHex(e.map(e.hexToRgb(M[ah%I].slice(1)),function(al){return(al*0.5)>>0}));aj.addColorStop(0,ae);aj.addColorStop(0.5,M[ah%I]);aj.addColorStop(1,ae);ac.fillStyle=aj}if(H){ac.fillRect(T,S+K*ah,W[ah],K)}else{ac.fillRect(T+K*ah,S-W[ah],K,W[ah])}if(ad&&ad.name==ai[ah]){F.acum=K*ah;F.dimValue=W[ah]}af+=(W[ah]||0);O+=(N[ah]||0)}if(ad){ac.save();ac.lineWidth=2;ac.strokeStyle=ad.color;if(H){ac.strokeRect(T+1,S+F.acum+1,F.dimValue-2,K-2)}else{ac.strokeRect(T+F.acum+1,S-F.dimValue+1,K-2,F.dimValue-2)}ac.restore()}if(R.type=="Native"){ac.save();ac.fillStyle=ac.strokeStyle=R.color;ac.font=R.style+" "+R.size+"px "+R.family;ac.textBaseline="middle";var Q=L(aa.name,O,aa);if(Q!==false){Q=Q!==true?Q:O;if(H){ac.textAlign="right";ac.fillText(Q,T+Math.max.apply(null,W)-ak.labelOffset,S+X/2)}else{ac.textAlign="center";ac.fillText(Q,T+Z/2,S-Math.max.apply(null,W)-R.size/2-ak.labelOffset)}}var V=Y(aa.name,O,aa);if(V!==false){V=V!==true?V:aa.name;if(H){ac.textAlign="center";ac.translate(T-ak.labelOffset-R.size/2,S+X/2);ac.rotate(Math.PI/2);ac.fillText(V,0,0)}else{ac.textAlign="center";ac.fillText(V,T+Z/2,S+R.size/2+ak.labelOffset)}}ac.restore()}}},contains:function(Q,M){var I=Q.pos.getc(true),P=Q.getData("width"),O=Q.getData("height"),L=this.getAlignedPos(I,P,O),K=L.x,J=L.y,N=Q.getData("dimArray"),T=N.length,W=Q.getData("config"),H=M.x-K,F=W.orientation=="horizontal",G=(F?O:P)/T;if(F){if(M.x<K||M.x>K+P||M.y>J+O||M.y<J){return false}}else{if(M.x<K||M.x>K+P||M.y>J||M.y<J-O){return false}}for(var S=0,R=N.length;S<R;S++){var V=N[S];if(F){var U=J+G*S;if(M.x<=K+V&&M.y>=U&&M.y<=U+G){return{name:Q.getData("stringArray")[S],color:Q.getData("colorArray")[S],value:Q.getData("valueArray")[S],label:Q.name}}}else{var U=K+G*S;if(M.x>=U&&M.x<=U+G&&M.y>=J-V){return{name:Q.getData("stringArray")[S],color:Q.getData("colorArray")[S],value:Q.getData("valueArray")[S],label:Q.name}}}}return false}}});$jit.BarChart=new v({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(H){this.controller=this.config=e.merge(q("Canvas","Margin","Label","BarChart"),{Label:{type:"Native"}},H);var I=this.config.showLabels,G=e.type(I),J=this.config.showAggregates,F=e.type(J);this.config.showLabels=G=="function"?I:e.lambda(I);this.config.showAggregates=F=="function"?J:e.lambda(J);this.initializeViz()},initializeViz:function(){var G=this.config,K=this;var F=G.type.split(":")[0],M=G.orientation=="horizontal",J={};var I=new $jit.ST({injectInto:G.injectInto,width:G.width,height:G.height,orientation:M?"left":"bottom",levelDistance:0,siblingOffset:G.barsOffset,subtreeOffset:0,withLabels:G.Label.type!="Native",useCanvas:G.useCanvas,Label:{type:G.Label.type},Node:{overridable:true,type:"barchart-"+F,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:G.Tips.enable,type:"Native",force:true,onShow:function(Q,P,N){var O=N;G.Tips.onShow(Q,O,P)}},Events:{enable:true,type:"Native",onClick:function(P,Q,N){if(!G.Events.enable){return}var O=Q.getContains();G.Events.onClick(O,Q,N)},onMouseMove:function(P,Q,N){if(!G.hoveredColor){return}if(P){var O=Q.getContains();K.select(P.id,O.name,O.index)}else{K.select(false,false,false)}}},onCreateLabel:function(S,Q){var Y=G.Label,W=Q.getData("valueArray"),V=e.reduce(W,function(Z,aa){return Z+aa},0);var U={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")};var N=U.wrapper,X=U.label,O=U.aggregate,P=N.style,T=X.style,R=O.style;J[Q.id]=U;N.appendChild(X);N.appendChild(O);if(!G.showLabels(Q.name,V,Q)){T.display="none"}if(!G.showAggregates(Q.name,V,Q)){R.display="none"}P.position="relative";P.overflow="visible";P.fontSize=Y.size+"px";P.fontFamily=Y.family;P.color=Y.color;P.textAlign="center";R.position=T.position="absolute";S.style.width=Q.getData("width")+"px";S.style.height=Q.getData("height")+"px";R.left=T.left="0px";X.innerHTML=Q.name;S.appendChild(N)},onPlaceLabel:function(ad,Y){if(!J[Y.id]){return}var ac=J[Y.id],P=ac.wrapper.style,N=ac.label.style,X=ac.aggregate.style,ae=G.type.split(":")[0]=="grouped",O=G.orientation=="horizontal",T=Y.getData("dimArray"),R=Y.getData("valueArray"),V=(ae&&O)?Math.max.apply(null,T):Y.getData("width"),U=(ae&&!O)?Math.max.apply(null,T):Y.getData("height"),S=parseInt(P.fontSize,10),W=ad.style;if(T&&R){P.width=X.width=N.width=ad.style.width=V+"px";for(var ab=0,Z=R.length,aa=0;ab<Z;ab++){if(T[ab]>0){aa+=R[ab]}}if(G.showLabels(Y.name,aa,Y)){N.display=""}else{N.display="none"}var Q=G.showAggregates(Y.name,aa,Y);if(Q!==false){X.display=""}else{X.display="none"}if(G.orientation=="horizontal"){X.textAlign="right";N.textAlign="left";N.textIndex=X.textIndent=G.labelOffset+"px";X.top=N.top=(U-S)/2+"px";ad.style.height=P.height=U+"px"}else{X.top=(-S-G.labelOffset)+"px";N.top=(G.labelOffset+U)+"px";ad.style.top=parseInt(ad.style.top,10)-U+"px";ad.style.height=P.height=U+"px"}ac.aggregate.innerHTML=Q!==true?Q:aa}}});var H=I.canvas.getSize(),L=G.Margin;if(M){I.config.offsetX=H.width/2-L.left-(G.showLabels&&(G.labelOffset+G.Label.size));I.config.offsetY=(L.bottom-L.top)/2}else{I.config.offsetY=-H.height/2+L.bottom+(G.showLabels&&(G.labelOffset+G.Label.size));I.config.offsetX=(L.right-L.left)/2}this.delegate=I;this.canvas=this.delegate.canvas},loadJSON:function(T){if(this.busy){return}this.busy=true;var Q=e.time(),L=[],S=this.delegate,W=e.splat(T.label),P=e.splat(T.color||this.colors),U=this.config,F=!!U.type.split(":")[1],I=U.animate,H=U.orientation=="horizontal",J=this;for(var R=0,G=T.values,N=G.length;R<N;R++){var V=G[R];var K=e.splat(G[R].values);var O=0;if(typeof V.id=="undefined"){V.id=V.label}L.push({id:Q+V.id,name:V.label,data:{value:K,"$valueArray":K,"$colorArray":P,"$stringArray":W,"$gradient":F,"$config":U},children:[]})}var M={id:Q+"$root",name:"",data:{"$type":"none","$width":1,"$height":1},children:L};S.loadJSON(M);this.normalizeDims();S.compute();S.select(S.root);if(I){if(H){S.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){J.busy=false}})}else{S.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){J.busy=false}})}}else{this.busy=false}},updateJSON:function(H,L){if(this.busy){return}this.busy=true;this.select(false,false,false);var I=this.delegate;var K=I.graph;var G=H.values;var F=this.config.animate;var J=this;var M=this.config.orientation=="horizontal";e.each(G,function(N){var O=K.getByName(N.label);if(O){O.setData("valueArray",e.splat(N.values));if(H.label){O.setData("stringArray",e.splat(H.label))}}});this.normalizeDims();I.compute();I.select(I.root);if(F){if(M){I.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){J.busy=false;L&&L.onComplete()}})}else{I.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){J.busy=false;L&&L.onComplete()}})}}},select:function(H,F){if(!this.config.hoveredColor){return}var G=this.selected;if(G.id!=H||G.name!=F){G.id=H;G.name=F;G.color=this.config.hoveredColor;this.delegate.graph.eachNode(function(I){if(H==I.id){I.setData("border",G)}else{I.setData("border",false)}});this.delegate.plot()}},getLegend:function(){var H={};var I;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(J){I=J.nodeTo});var G=I.getData("colorArray"),F=G.length;e.each(I.getData("stringArray"),function(K,J){H[K]=G[J%F]});return H},getMaxValue:function(){var G=0,F=this.config.type.split(":")[0]=="stacked";this.delegate.graph.eachNode(function(J){var H=J.getData("valueArray"),I=0;if(!H){return}if(F){e.each(H,function(K){I+=+K})}else{I=Math.max.apply(null,H)}G=G>I?G:I});return G},setBarType:function(F){this.config.type=F;this.delegate.config.Node.type="barchart-"+F.split(":")[0]},normalizeDims:function(){var P=this.delegate.graph.getNode(this.delegate.root),K=0;P.eachAdjacency(function(){K++});var M=this.getMaxValue()||1,S=this.delegate.canvas.getSize(),I=this.config,L=I.Margin,Q=L.left+L.right,J=L.top+L.bottom,G=I.orientation=="horizontal",F=(S[G?"height":"width"]-(G?J:Q)-(K-1)*I.barsOffset)/K,H=I.animate,R=S[G?"width":"height"]-(G?Q:J)-(!G&&I.showAggregates&&(I.Label.size+I.labelOffset))-(I.showLabels&&(I.Label.size+I.labelOffset)),O=G?"height":"width",N=G?"width":"height";this.delegate.graph.eachNode(function(W){var V=0,T=[];e.each(W.getData("valueArray"),function(X){V+=+X;T.push(0)});W.setData(O,F);if(H){W.setData(N,V*R/M,"end");W.setData("dimArray",e.map(W.getData("valueArray"),function(X){return X*R/M}),"end");var U=W.getData("dimArray");if(!U){W.setData("dimArray",T)}}else{W.setData(N,V*R/M);W.setData("dimArray",e.map(W.getData("valueArray"),function(X){return X*R/M}))}})}});q.PieChart={$extend:true,animate:true,offset:25,sliceOffset:0,labelOffset:3,type:"stacked",hoveredColor:"#9fd4ff",Events:{enable:false,onClick:e.empty},Tips:{enable:false,onShow:e.empty,onHide:e.empty},showLabels:true,resizeLabels:false,updateHeights:false};i.Radial=new v({compute:function(G){var H=e.splat(G||["current","start","end"]);h.compute(this.graph,H,this.config);this.graph.computeLevels(this.root,0,"ignore");var F=this.createLevelDistanceFunc();this.computeAngularWidths(H);this.computePositions(H,F)},computePositions:function(M,J){var O=M;var N=this.graph;var K=N.getNode(this.root);var L=this.parent;var F=this.config;for(var H=0,G=O.length;H<G;H++){var I=O[H];K.setPos(m(0,0),I);K.setData("span",Math.PI*2,I)}K.angleSpan={begin:0,end:2*Math.PI};N.eachBFS(this.root,function(T){var Z=T.angleSpan.end-T.angleSpan.begin;var ab=T.angleSpan.begin;var aa=J(T);var ac=0,P=[],S={};T.eachSubnode(function(af){ac+=af._treeAngularWidth;for(var ag=0,ae=O.length;ag<ae;ag++){var ai=O[ag],ah=af.getData("dim",ai);S[ai]=(ai in S)?(ah>S[ai]?ah:S[ai]):ah}P.push(af)},"ignore");if(L&&L.id==T.id&&P.length>0&&P[0].dist){P.sort(function(af,ae){return(af.dist>=ae.dist)-(af.dist<=ae.dist)})}for(var V=0,X=P.length;V<X;V++){var R=P[V];if(!R._flag){var ad=R._treeAngularWidth/ac*Z;var Q=ab+ad/2;for(var W=0,U=O.length;W<U;W++){var Y=O[W];R.setPos(m(Q,aa),Y);R.setData("span",ad,Y);R.setData("dim-quotient",R.getData("dim",Y)/S[Y],Y)}R.angleSpan={begin:ab,end:ab+ad};ab+=ad}}},"ignore")},setAngularWidthForNodes:function(F){this.graph.eachBFS(this.root,function(I,G){var H=I.getData("angularWidth",F[0])||5;I._angularWidth=H/G},"ignore")},setSubtreesAngularWidth:function(){var F=this;this.graph.eachNode(function(G){F.setSubtreeAngularWidth(G)},"ignore")},setSubtreeAngularWidth:function(I){var H=this,G=I._angularWidth,F=0;I.eachSubnode(function(J){H.setSubtreeAngularWidth(J);F+=J._treeAngularWidth},"ignore");I._treeAngularWidth=Math.max(G,F)},computeAngularWidths:function(F){this.setAngularWidthForNodes(F);this.setSubtreesAngularWidth()}});$jit.Sunburst=new v({Implements:[f,t,i.Radial],initialize:function(F){var H=$jit.Sunburst;var G={interpolation:"linear",levelDistance:100,Node:{type:"multipie",height:0},Edge:{type:"none"},Label:{textAlign:"start",textBaseline:"middle"}};this.controller=this.config=e.merge(q("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),G,F);var I=this.config;if(I.useCanvas){this.canvas=I.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(I.background){I.background=e.merge({type:"Circles"},I.background)}this.canvas=new p(this,I);this.config.labelContainer=(typeof I.injectInto=="string"?I.injectInto:I.injectInto.id)+"-label"}this.graphOptions={klass:d,Node:{selected:false,exist:true,drawn:true}};this.graph=new g(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new H.Label[I.Label.type](this);this.fx=new H.Plot(this,H);this.op=new H.Op(this);this.json=null;this.root=null;this.rotated=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var F=this.config.levelDistance;return function(G){return(G._depth+1)*F}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},rotate:function(H,I,G){var F=H.getPos(G.property||"current").getp(true).theta;this.rotated=H;this.rotateAngle(-F,I,G)},rotateAngle:function(H,K,G){var I=this;var F=e.merge(this.config,G||{},{modes:["polar"]});var J=G.property||(K==="animate"?"end":"current");if(K==="animate"){this.fx.animation.pause()}this.graph.eachNode(function(M){var L=M.getPos(J);L.theta+=H;if(L.theta<0){L.theta+=Math.PI*2}});if(K=="animate"){this.fx.animate(F)}else{if(K=="replot"){this.fx.plot();this.busy=false}}},plot:function(){this.fx.plot()}});$jit.Sunburst.$extend=true;(function(F){F.Op=new v({Implements:g.Op});F.Plot=new v({Implements:g.Plot});F.Label={};F.Label.Native=new v({Implements:g.Label.Native,initialize:function(G){this.viz=G;this.label=G.config.Label;this.config=G.config},renderLabel:function(J,L,N){var U=L.getData("span");if(U<Math.PI/2&&Math.tan(U)*this.config.levelDistance*L._depth<10){return}var V=J.getCtx();var H=V.measureText(L.name);if(L.id==this.viz.root){var T=-H.width/2,R=0,S=0;var G=0}else{var K=5;var G=N.levelDistance-K;var Q=L.pos.clone();Q.rho+=K;var I=Q.getp(true);var O=Q.getc(true);var T=O.x,R=O.y;var M=Math.PI;var P=(I.theta>M/2&&I.theta<3*M/2);var S=P?I.theta+M:I.theta;if(P){T-=Math.abs(Math.cos(I.theta)*H.width);R+=Math.sin(I.theta)*H.width}else{if(L.id==this.viz.root){T-=H.width/2}}}V.save();V.translate(T,R);V.rotate(S);V.fillText(L.name,0,0);V.restore()}});F.Label.SVG=new v({Implements:g.Label.SVG,initialize:function(G){this.viz=G},placeLabel:function(U,J,L){var Q=J.pos.getc(true),T=this.viz,H=this.viz.canvas;var M=H.getSize();var I={x:Math.round(Q.x+M.width/2),y:Math.round(Q.y+M.height/2)};U.setAttribute("x",I.x);U.setAttribute("y",I.y);var N=U.getBBox();if(N){var S=U.getAttribute("x");var P=U.getAttribute("y");var G=J.pos.getp(true);var K=Math.PI;var O=(G.theta>K/2&&G.theta<3*K/2);if(O){U.setAttribute("x",S-N.width);U.setAttribute("y",P-N.height)}else{if(J.id==T.root){U.setAttribute("x",S-N.width/2)}}var R=O?G.theta+K:G.theta;if(J._depth){U.setAttribute("transform","rotate("+R*360/(2*K)+" "+S+" "+P+")")}}L.onPlaceLabel(U,J)}});F.Label.HTML=new v({Implements:g.Label.HTML,initialize:function(G){this.viz=G},placeLabel:function(P,J,L){var N=J.pos.clone(),H=this.viz.canvas,O=J.getData("height"),K=((O||J._depth==0)?O:this.viz.config.levelDistance)/2,M=H.getSize();N.rho+=K;N=N.getc(true);var I={x:Math.round(N.x+M.width/2),y:Math.round(N.y+M.height/2)};var G=P.style;G.left=I.x+"px";G.top=I.y+"px";G.display=this.fitsInCanvas(I,H)?"":"none";L.onPlaceLabel(P,J)}});F.Plot.NodeTypes=new v({none:{render:e.empty,contains:e.lambda(false),anglecontains:function(K,M){var J=K.getData("span")/2,H=K.pos.theta;var I=H-J,G=H+J;if(I<0){I+=Math.PI*2}var L=Math.atan2(M.y,M.x);if(L<0){L+=Math.PI*2}if(I>G){return(L>I&&L<=Math.PI*2)||L<G}else{return L>I&&L<G}}},pie:{render:function(L,J){var P=L.getData("span")/2,I=L.pos.theta;var K=I-P,M=I+P;var O=L.pos.getp(true);var G=new d(O.rho,K);var H=G.getc(true);G.theta=M;var N=G.getc(true);var Q=J.getCtx();Q.beginPath();Q.moveTo(0,0);Q.lineTo(H.x,H.y);Q.moveTo(0,0);Q.lineTo(N.x,N.y);Q.moveTo(0,0);Q.arc(0,0,O.rho*L.getData("dim-quotient"),K,M,false);Q.fill()},contains:function(I,K){if(this.nodeTypes.none.anglecontains.call(this,I,K)){var G=Math.sqrt(K.x*K.x+K.y*K.y);var H=this.config.levelDistance,J=I._depth;return(G<=H*J)}return false}},multipie:{render:function(M,K){var T=M.getData("height");var N=T?T:this.config.levelDistance;var S=M.getData("span")/2,J=M.pos.theta;var L=J-S,P=J+S;var R=M.pos.getp(true);var H=new d(R.rho,L);var I=H.getc(true);H.theta=P;var Q=H.getc(true);H.rho+=N;var G=H.getc(true);H.theta=L;var O=H.getc(true);var U=K.getCtx();U.moveTo(0,0);U.beginPath();U.arc(0,0,R.rho,L,P,false);U.arc(0,0,R.rho+N,P,L,true);U.moveTo(I.x,I.y);U.lineTo(O.x,O.y);U.moveTo(Q.x,Q.y);U.lineTo(G.x,G.y);U.fill();if(M.collapsed){U.save();U.lineWidth=2;U.moveTo(0,0);U.beginPath();U.arc(0,0,R.rho+N+5,P-0.01,L+0.01,true);U.stroke();U.restore()}},contains:function(J,M){if(this.nodeTypes.none.anglecontains.call(this,J,M)){var H=Math.sqrt(M.x*M.x+M.y*M.y);var G=J.getData("height");var K=G?G:this.config.levelDistance;var I=this.config.levelDistance,L=J._depth;return(H>=I*L)&&(H<=(I*L+K))}return false}},"gradient-multipie":{render:function(J,G){var O=G.getCtx();var N=J.getData("height");var K=N?N:this.config.levelDistance;var H=O.createRadialGradient(0,0,J.getPos().rho,0,0,J.getPos().rho+K);var M=e.hexToRgb(J.getData("color")),L=[];e.each(M,function(P){L.push(parseInt(P*0.5,10))});var I=e.rgbToHex(L);H.addColorStop(0,I);H.addColorStop(1,J.getData("color"));O.fillStyle=H;this.nodeTypes.multipie.render.call(this,J,G)},contains:function(G,H){return this.nodeTypes.multipie.contains.call(this,G,H)}},"gradient-pie":{render:function(L,I){var G=I.getCtx();var M=G.createRadialGradient(0,0,0,0,0,L.getPos().rho);var K=e.hexToRgb(L.getData("color")),H=[];e.each(K,function(N){H.push(parseInt(N*0.5,10))});var J=e.rgbToHex(H);M.addColorStop(1,J);M.addColorStop(0,L.getData("color"));G.fillStyle=M;this.nodeTypes.pie.render.call(this,L,I)},contains:function(G,H){return this.nodeTypes.pie.contains.call(this,G,H)}}});F.Plot.EdgeTypes=new v({none:e.empty,line:{render:function(G,H){var J=G.nodeFrom.pos.getc(true),I=G.nodeTo.pos.getc(true);this.edgeHelper.line.render(J,I,H)},contains:function(G,J){var I=G.nodeFrom.pos.getc(true),H=G.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(I,H,J,this.edge.epsilon)}},arrow:{render:function(H,I){var M=H.nodeFrom.pos.getc(true),L=H.nodeTo.pos.getc(true),K=H.getData("dim"),J=H.data.$direction,G=(J&&J.length>1&&J[0]!=H.nodeFrom.id);this.edgeHelper.arrow.render(M,L,K,G,I)},contains:function(G,J){var I=G.nodeFrom.pos.getc(true),H=G.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(I,H,J,this.edge.epsilon)}},hyperline:{render:function(G,H){var K=G.nodeFrom.pos.getc(),J=G.nodeTo.pos.getc(),I=Math.max(K.norm(),J.norm());this.edgeHelper.hyperline.render(K.$scale(1/I),J.$scale(1/I),I,H)},contains:e.lambda(false)}})})($jit.Sunburst);$jit.Sunburst.Plot.NodeTypes.implement({"piechart-stacked":{render:function(ad,J){var ac=ad.pos.getp(true),L=ad.getData("dimArray"),ab=ad.getData("valueArray"),P=ad.getData("colorArray"),I=P.length,V=ad.getData("stringArray"),Y=ad.getData("span")/2,T=ad.pos.theta,O=T-Y,S=T+Y,aa=new d;var W=J.getCtx(),U={},R=ad.getData("gradient"),M=ad.getData("border"),ai=ad.getData("config"),ar=ai.showLabels,ah=ai.resizeLabels,ak=ai.Label;var an=ai.sliceOffset*Math.cos((O+S)/2);var N=ai.sliceOffset*Math.sin((O+S)/2);if(P&&L&&V){for(var ao=0,al=L.length,F=0,ag=0;ao<al;ao++){var K=L[ao],ap=P[ao%I];if(K<=0){continue}W.fillStyle=W.strokeStyle=ap;if(R&&K){var am=W.createRadialGradient(an,N,F+ai.sliceOffset,an,N,F+K+ai.sliceOffset);var G=e.hexToRgb(ap),af=e.map(G,function(av){return(av*0.8)>>0}),H=e.rgbToHex(af);am.addColorStop(0,ap);am.addColorStop(0.5,ap);am.addColorStop(1,H);W.fillStyle=am}aa.rho=F+ai.sliceOffset;aa.theta=O;var aq=aa.getc(true);aa.theta=S;var X=aa.getc(true);aa.rho+=K;var at=aa.getc(true);aa.theta=O;var Z=aa.getc(true);W.beginPath();W.arc(an,N,F+0.01,O,S,false);W.arc(an,N,F+K+0.01,S,O,true);W.fill();if(M&&M.name==V[ao]){U.acum=F;U.dimValue=L[ao];U.begin=O;U.end=S}F+=(K||0);ag+=(ab[ao]||0)}if(M){W.save();W.globalCompositeOperation="source-over";W.lineWidth=2;W.strokeStyle=M.color;var aj=O<S?1:-1;W.beginPath();W.arc(an,N,U.acum+0.01+1,U.begin,U.end,false);W.arc(an,N,U.acum+U.dimValue+0.01-1,U.end,U.begin,true);W.closePath();W.stroke();W.restore()}if(ar&&ak.type=="Native"){W.save();W.fillStyle=W.strokeStyle=ak.color;var ae=ah?ad.getData("normalizedDim"):1,Q=(ak.size*ae)>>0;Q=Q<+ah?+ah:Q;W.font=ak.style+" "+Q+"px "+ak.family;W.textBaseline="middle";W.textAlign="center";aa.rho=F+ai.labelOffset+ai.sliceOffset;aa.theta=ad.pos.theta;var au=aa.getc(true);W.fillText(ad.name,au.x,au.y);W.restore()}}},contains:function(I,M){if(this.nodeTypes.none.anglecontains.call(this,I,M)){var O=Math.sqrt(M.x*M.x+M.y*M.y);var F=this.config.levelDistance,L=I._depth;var G=I.getData("config");if(O<=F*L+G.sliceOffset){var P=I.getData("dimArray");for(var K=0,J=P.length,N=G.sliceOffset;K<J;K++){var H=P[K];if(O>=N&&O<=N+H){return{name:I.getData("stringArray")[K],color:I.getData("colorArray")[K],value:I.getData("valueArray")[K],label:I.name}}N+=H}}return false}return false}}});$jit.PieChart=new v({sb:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(F){this.controller=this.config=e.merge(q("Canvas","PieChart","Label"),{Label:{type:"Native"}},F);this.initializeViz()},initializeViz:function(){var G=this.config,K=this;var F=G.type.split(":")[0];var J=new $jit.Sunburst({injectInto:G.injectInto,width:G.width,height:G.height,useCanvas:G.useCanvas,withLabels:G.Label.type!="Native",Label:{type:G.Label.type},Node:{overridable:true,type:"piechart-"+F,width:1,height:1},Edge:{type:"none"},Tips:{enable:G.Tips.enable,type:"Native",force:true,onShow:function(O,N,L){var M=L;G.Tips.onShow(O,M,N)}},Events:{enable:true,type:"Native",onClick:function(N,O,L){if(!G.Events.enable){return}var M=O.getContains();G.Events.onClick(M,O,L)},onMouseMove:function(N,O,L){if(!G.hoveredColor){return}if(N){var M=O.getContains();K.select(N.id,M.name,M.index)}else{K.select(false,false,false)}}},onCreateLabel:function(O,N){var L=G.Label;if(G.showLabels){var M=O.style;M.fontSize=L.size+"px";M.fontFamily=L.family;M.color=L.color;M.textAlign="center";O.innerHTML=N.name}},onPlaceLabel:function(ab,V){if(!G.showLabels){return}var P=V.pos.getp(true),S=V.getData("dimArray"),Y=V.getData("span")/2,Q=V.pos.theta,aa=Q-Y,M=Q+Y,ad=new d;var U=G.showLabels,O=G.resizeLabels,R=G.Label;if(S){for(var Z=0,W=S.length,X=0;Z<W;Z++){X+=S[Z]}var ac=O?V.getData("normalizedDim"):1,L=(R.size*ac)>>0;L=L<+O?+O:L;ab.style.fontSize=L+"px";ad.rho=X+G.labelOffset+G.sliceOffset;ad.theta=(aa+M)/2;var P=ad.getc(true);var N=K.canvas.getSize();var T={x:Math.round(P.x+N.width/2),y:Math.round(P.y+N.height/2)};ab.style.left=T.x+"px";ab.style.top=T.y+"px"}}});var I=J.canvas.getSize(),H=Math.min;J.config.levelDistance=H(I.width,I.height)/2-G.offset-G.sliceOffset;this.delegate=J;this.canvas=this.delegate.canvas;this.canvas.getCtx().globalCompositeOperation="lighter"},loadJSON:function(T){var Q=e.time(),K=[],S=this.delegate,W=e.splat(T.label),M=W.length,P=e.splat(T.color||this.colors),H=P.length,U=this.config,F=!!U.type.split(":")[1],I=U.animate,O=M==1;for(var R=0,G=T.values,N=G.length;R<N;R++){var V=G[R];var J=e.splat(V.values);K.push({id:Q+V.label,name:V.label,data:{value:J,"$valueArray":J,"$colorArray":O?e.splat(P[R%H]):P,"$stringArray":W,"$gradient":F,"$config":U,"$angularWidth":e.reduce(J,function(X,Y){return X+Y})},children:[]})}var L={id:Q+"$root",name:"",data:{"$type":"none","$width":1,"$height":1},children:K};S.loadJSON(L);this.normalizeDims();S.refresh();if(I){S.fx.animate({modes:["node-property:dimArray"],duration:1500})}},updateJSON:function(H,L){if(this.busy){return}this.busy=true;var I=this.delegate;var K=I.graph;var G=H.values;var F=this.config.animate;var J=this;e.each(G,function(M){var O=K.getByName(M.label),N=e.splat(M.values);if(O){O.setData("valueArray",N);O.setData("angularWidth",e.reduce(N,function(P,Q){return P+Q}));if(H.label){O.setData("stringArray",e.splat(H.label))}}});this.normalizeDims();if(F){I.compute("end");I.fx.animate({modes:["node-property:dimArray:span","linear"],duration:1500,onComplete:function(){J.busy=false;L&&L.onComplete()}})}else{I.refresh()}},select:function(H,F){if(!this.config.hoveredColor){return}var G=this.selected;if(G.id!=H||G.name!=F){G.id=H;G.name=F;G.color=this.config.hoveredColor;this.delegate.graph.eachNode(function(I){if(H==I.id){I.setData("border",G)}else{I.setData("border",false)}});this.delegate.plot()}},getLegend:function(){var H={};var I;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(J){I=J.nodeTo});var G=I.getData("colorArray"),F=G.length;e.each(I.getData("stringArray"),function(K,J){H[K]=G[J%F]});return H},getMaxValue:function(){var F=0;this.delegate.graph.eachNode(function(I){var G=I.getData("valueArray"),H=0;e.each(G,function(J){H+=+J});F=F>H?F:H});return F},normalizeDims:function(){var G=this.delegate.graph.getNode(this.delegate.root),F=0;G.eachAdjacency(function(){F++});var K=this.getMaxValue()||1,J=this.config,H=J.animate,I=this.delegate.config.levelDistance;this.delegate.graph.eachNode(function(P){var O=0,L=[];e.each(P.getData("valueArray"),function(Q){O+=+Q;L.push(1)});var N=(L.length==1)&&!J.updateHeights;if(H){P.setData("dimArray",e.map(P.getData("valueArray"),function(Q){return N?I:(Q*I/K)}),"end");var M=P.getData("dimArray");if(!M){P.setData("dimArray",L)}}else{P.setData("dimArray",e.map(P.getData("valueArray"),function(Q){return N?I:(Q*I/K)}))}P.setData("normalizedDim",O/K)})}});i.TM={};i.TM.SliceAndDice=new v({compute:function(K){var G=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(G);var I=this.canvas.getSize(),H=this.config,J=I.width,F=I.height;this.graph.computeLevels(this.root,0,"ignore");G.getPos(K).setc(-J/2,-F/2);G.setData("width",J,K);G.setData("height",F+H.titleHeight,K);this.computePositions(G,G,this.layout.orientation,K);this.controller.onAfterCompute(G)},computePositions:function(P,N,Y,H){var W=0;P.eachSubnode(function(aa){W+=aa.getData("area",H)},"ignore");var Z=this.config,K=Z.offset,T=P.getData("width",H),R=Math.max(P.getData("height",H)-Z.titleHeight,0),G=P==N?1:(N.getData("area",H)/W);var S,Q,V,L,J,O,M;var X=(Y=="h");if(X){Y="v";S=R;Q=T*G;V="height";L="y";J="x";O=Z.titleHeight;M=0}else{Y="h";S=R*G;Q=T;V="width";L="x";J="y";O=0;M=Z.titleHeight}var F=N.getPos(H);N.setData("width",Q,H);N.setData("height",S,H);var U=0,I=this;N.eachSubnode(function(ab){var aa=ab.getPos(H);aa[L]=U+F[L]+O;aa[J]=F[J]+M;I.computePositions(N,ab,Y,H);U+=ab.getData(V,H)},"ignore")}});i.TM.Area={compute:function(F){F=F||"current";var L=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(L);var H=this.config,O=this.canvas.getSize(),G=O.width,N=O.height,M=H.offset,I=G-M,K=N-M;this.graph.computeLevels(this.root,0,"ignore");L.getPos(F).setc(-G/2,-N/2);L.setData("width",G,F);L.setData("height",N,F);var J={top:-N/2+H.titleHeight+M/2,left:-G/2+M/2,width:I,height:K-H.titleHeight};this.computePositions(L,J,F);this.controller.onAfterCompute(L)},computeDim:function(J,K,M,I,H,F){if(J.length+K.length==1){var G=(J.length==1)?J:K;this.layoutLast(G,M,I,F);return}if(J.length>=2&&K.length==0){K=[J.shift()]}if(J.length==0){if(K.length>0){this.layoutRow(K,M,I,F)}return}var L=J[0];if(H(K,M)>=H([L].concat(K),M)){this.computeDim(J.slice(1),K.concat([L]),M,I,H,F)}else{var N=this.layoutRow(K,M,I,F);this.computeDim(J,[],N.dim,N,H,F)}},worstAspectRatio:function(F,N){if(!F||F.length==0){return Number.MAX_VALUE}var G=0,O=0,J=Number.MAX_VALUE;for(var L=0,K=F.length;L<K;L++){var H=F[L]._area;G+=H;J=J<H?J:H;O=O>H?O:H}var M=N*N,I=G*G;return Math.max(M*O/I,I/(M*J))},avgAspectRatio:function(J,G){if(!J||J.length==0){return Number.MAX_VALUE}var L=0;for(var H=0,F=J.length;H<F;H++){var K=J[H]._area;var I=K/G;L+=G>I?G/I:I/G}return L/F},layoutLast:function(G,F,J,I){var H=G[0];H.getPos(I).setc(J.left,J.top);H.setData("width",J.width,I);H.setData("height",J.height,I)}};i.TM.Squarified=new v({Implements:i.TM.Area,computePositions:function(J,M,G){var I=this.config,O=Math.max;if(M.width>=M.height){this.layout.orientation="h"}else{this.layout.orientation="v"}var F=J.getSubnodes([1,1],"ignore");if(F.length>0){this.processChildrenLayout(J,F,M,G);for(var L=0,K=F.length;L<K;L++){var P=F[L],Q=I.offset,R=O(P.getData("height",G)-Q-I.titleHeight,0),H=O(P.getData("width",G)-Q,0),N=P.getPos(G);M={width:H,height:R,top:N.y+I.titleHeight+Q/2,left:N.x+Q/2};this.computePositions(P,M,G)}}},processChildrenLayout:function(P,F,L,G){var J=L.width*L.height;var K,H=F.length,M=0,Q=[];for(K=0;K<H;K++){Q[K]=parseFloat(F[K].getData("area",G));M+=Q[K]}for(K=0;K<H;K++){F[K]._area=J*Q[K]/M}var I=this.layout.horizontal()?L.height:L.width;F.sort(function(S,R){var T=R._area-S._area;return T?T:(R.id==S.id?0:(R.id<S.id?1:-1))});var O=[F[0]];var N=F.slice(1);this.squarify(N,O,I,L,G)},squarify:function(G,J,F,I,H){this.computeDim(G,J,F,I,this.worstAspectRatio,H)},layoutRow:function(G,F,I,H){if(this.layout.horizontal()){return this.layoutV(G,F,I,H)}else{return this.layoutH(G,F,I,H)}},layoutV:function(F,R,M,G){var S=0,I=function(T){return T};e.each(F,function(T){S+=T._area});var H=I(S/R)||0,O=0;for(var K=0,J=F.length;K<J;K++){var L=I(F[K]._area/H)||0;var P=F[K];var N=e.getDir()==="rtl"?(-1*M.left)-H:M.left;P.getPos(G).setc(N,M.top+O);P.setData("width",H,G);P.setData("height",L,G);O+=L}var Q={height:M.height,width:M.width-H,top:M.top,left:M.left+H};Q.dim=Math.min(Q.width,Q.height);if(Q.dim!=Q.height){this.layout.change()}return Q},layoutH:function(F,P,K,G){var R=0;e.each(F,function(S){R+=S._area});var Q=R/P||0,M=K.top,H=0;for(var J=0,I=F.length;J<I;J++){var N=F[J];var P=N._area/Q||0;var L=e.getDir()==="rtl"?(-1*(K.left+H))-P:K.left+H;N.getPos(G).setc(L,M);N.setData("width",P,G);N.setData("height",Q,G);H+=P}var O={height:K.height-Q,width:K.width,top:K.top+Q,left:K.left};O.dim=Math.min(O.width,O.height);if(O.dim!=O.width){this.layout.change()}return O},layoutLast:function(H,G,K,J){var I=H[0];var F=e.getDir()==="rtl"?-1*K.left-K.width:K.left;I.getPos(J).setc(F,K.top);I.setData("width",K.width,J);I.setData("height",K.height,J)}});i.TM.Strip=new v({Implements:i.TM.Area,computePositions:function(J,M,G){var F=J.getSubnodes([1,1],"ignore"),I=this.config,O=Math.max;if(F.length>0){this.processChildrenLayout(J,F,M,G);for(var L=0,K=F.length;L<K;L++){var P=F[L];var Q=I.offset,R=O(P.getData("height",G)-Q-I.titleHeight,0),H=O(P.getData("width",G)-Q,0);var N=P.getPos(G);M={width:H,height:R,top:N.y+I.titleHeight+Q/2,left:N.x+Q/2};this.computePositions(P,M,G)}}},processChildrenLayout:function(P,F,K,G){var I=K.width*K.height;var J,H=F.length,L=0,Q=[];for(J=0;J<H;J++){Q[J]=+F[J].getData("area",G);L+=Q[J]}for(J=0;J<H;J++){F[J]._area=I*Q[J]/L}var O=this.layout.horizontal()?K.width:K.height;var N=[F[0]];var M=F.slice(1);this.stripify(M,N,O,K,G)},stripify:function(G,J,F,I,H){this.computeDim(G,J,F,I,this.avgAspectRatio,H)},layoutRow:function(G,F,I,H){if(this.layout.horizontal()){return this.layoutH(G,F,I,H)}else{return this.layoutV(G,F,I,H)}},layoutV:function(F,O,L,G){var P=0;e.each(F,function(Q){P+=Q._area});var H=P/O||0,M=0;for(var J=0,I=F.length;J<I;J++){var N=F[J];var K=N._area/H||0;N.getPos(G).setc(L.left,L.top+(O-K-M));N.setData("width",H,G);N.setData("height",K,G);M+=K}return{height:L.height,width:L.width-H,top:L.top,left:L.left+H,dim:O}},layoutH:function(F,N,K,G){var P=0;e.each(F,function(R){P+=R._area});var O=P/N||0,L=K.height-O,H=0;for(var J=0,I=F.length;J<I;J++){var M=F[J];var Q=M._area/O||0;M.getPos(G).setc(K.left+H,K.top+L);M.setData("width",Q,G);M.setData("height",O,G);H+=Q}return{height:K.height-O,width:K.width,top:K.top,left:K.left,dim:N}}});i.TM.Voronoi=new v({Implements:i.TM.Area,compute:function(M){this.controller.onBeforeCompute(G);var G=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root),I=this.canvas.getSize(),H=this.config,L=H.offset,K=I.width,F=I.height;this.graph.computeLevels(this.root,0,0);G.getPos(M).setc(-5,-5);if(!G.histoPos){G.histoPos=[]}G.histoPos[0]=x(0,0);var J=[x(-K*0.5,-F*0.5),x(K*0.5,-F*0.5),x(K*0.5,F*0.5),x(-K*0.5,F*0.5)];J=Geometry.offsetConvex(J,-L*0.5);G.setData("vertices",J,M);G.setData("width",0,M);G.setData("height",0,M);J=Geometry.offsetConvex(J,-L*1.5);this.computePositions(G,J,M,0);this.controller.onAfterCompute(G)},computePositions:function(I,J,F,G){var O=this,K=I.getSubnodes([1,1],"ignore"),H=this.config,L=H.offset,N=I.histoPos[G]||c(0,0),M,P;I.setData("width",0,F);I.setData("height",0,F);I.getPos(F).setc(N.x,N.y);if(K.length>0){if(!K[0].histoPos||!K[0].histoPos[G+1]){M=$jit.util.map(K,function(Q){var R=Geometry.randPointInPolygon(J);if(Q.data&&Q.data.$area){R.area=Q.data.$area}return R});M=O[O.config.centroidType](M,J);$jit.util.each(M,function(R,Q){if(!K[Q].histoPos){K[Q].histoPos=[]}K[Q].histoPos[G+1]=R})}M=$jit.util.map(K,function(Q){return Q.histoPos[G+1]});P=Geometry.voronoi(M,J);$jit.util.each(K,function(T,S){var R=P[S];var Q=R.slice(0);if(Geometry.area(R)<0){R.reverse()}if(L){Q=Geometry.offsetConvex(R,-L*2);R=Geometry.offsetConvex(R,-L*0.5);T.offset=L}T.setData("vertices",R,F);O.computePositions(T,Q,F,G+1)})}},centroid:function(I,H){var G=2,F;while(G>0.001){F=Geometry.voronoi(I,H);G=0;I=F.map(function(K,J){var L=Geometry.centroid(K);G+=Geometry.dist2(L,I[J]);return L})}return I},doLayoutPressure:function(){var G=this,F=G.graph.getNode(G.clickedNode&&G.clickedNode.id||G.root);F.eachNode(function(){})},weightedCentroid:function(I,G){var O=[];var H=2,J,M=Geometry.area(G),F=0,L;e.each(I,function(P,Q){F+=P.area});L=M/F;J=Geometry.voronoi(I,G);e.each(J,function(Q,P){O[P]=I[P].area*L/Geometry.area(Q)});var N=0,K=0;e.each(O,function(Q,P){N+=Q;K+=Q*Q});console.log("from "+(K-N*N/O.length)/O.length);while(H>0.001){J=Geometry.voronoi(I,G);e.each(J,function(Q,P){O[P]=I[P].area*L/Geometry.area(Q)});H=0;I=J.map(function(Q,P){var S=x(0,0),R=0;e.each(Q,function(U,W){var X=[I[P],U,Q[W+1]||Q[0]],V=(U.attached)?O[U.attached[0]]:1,T=Geometry.area(X)*Math.exp((O[P]-V)*2);R+=T;S.$add(U.add(X[2]).scale(0.5*T))});S.$scale(1/R);S.area=I[P].area;H+=Geometry.dist(S,I[P]);return S})}var N=0,K=0;e.each(O,function(Q,P){N+=Q;K+=Q*Q});console.log("to "+(K-N*N/O.length)/O.length);return I},byArea:function(L,J){L=this.centroid(L,J);var H=0,G=0,F,K,F;$jit.util.each(L,function(M){H+=M.area});H=Geometry.area(J)/H;for(;G<100;G++){F=Geometry.voronoi(L,J);for(var I=0;I<L.length;I++){if(F[I].length==0){L=F.map(function(N,M){return Geometry.centroid(N)});break}}K=F.map(function(N,M){return N.area*H/(Geometry.area(N)+1e-10)});F=Geometry.voronoi(L,J);L=F.map(function(P,O){var M=x(L[O].x,L[O].y),Q,N;M.area=L[O].area;Q=x(0,0);$jit.util.each(P,function(X,U){var V=(X.attached)?X.attached:-1,R=(X.attached)?K[X.attached[0]]:1,T=X,W=P[U+1]||P[0],S=(K[O]-R),Z=W.x-T.x,Y=W.y-T.y;Q.x+=Y*S;Q.y-=Z*S});M.x+=Q.x/10;M.y+=Q.y/10;M.tp=Q;return M})}return L}});i.Icicle=new v({compute:function(N){N=N||"current";var M=this.graph.getNode(this.root),I=this.config,Q=this.canvas.getSize(),F=Q.width,P=Q.height,J=I.offset,L=I.constrained?I.levelsToShow:Number.MAX_VALUE;this.controller.onBeforeCompute(M);g.Util.computeLevels(this.graph,M.id,0,"ignore");var O=0;g.Util.eachLevel(M,0,false,function(S,R){if(R>O){O=R}});var H=this.graph.getNode(this.clickedNode&&this.clickedNode.id||M.id);var G=Math.min(O,L-1);var K=H._depth;if(this.layout.horizontal()){this.computeSubtree(H,-F/2,-P/2,F/(G+1),P,K,G,N)}else{this.computeSubtree(H,-F/2,-P/2,F,P/(G+1),K,G,N)}},computeSubtree:function(N,P,M,F,S,L,H,O){N.getPos(O).setc(P,M);N.setData("width",F,O);N.setData("height",S,O);var J,R=0,Q=0;var G=g.Util.getSubnodes(N,[1,1],"ignore");if(!G.length){return}e.each(G,function(T){Q+=T.getData("dim")});for(var K=0,I=G.length;K<I;K++){if(this.layout.horizontal()){J=S*G[K].getData("dim")/Q;this.computeSubtree(G[K],P+F,M,F,J,L,H,O);M+=J}else{J=F*G[K].getData("dim")/Q;this.computeSubtree(G[K],P,M+S,J,S,L,H,O);P+=J}}}});$jit.Icicle=new v({Implements:[f,t,i.Icicle],layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(F){var G={animate:false,orientation:"h",offset:2,levelsToShow:Number.MAX_VALUE,constrained:false,Node:{type:"rectangle",overridable:true},Edge:{type:"none"},Label:{type:"Native"},duration:700,fps:45};var I=q("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label");this.controller=this.config=e.merge(I,G,F);this.layout.orientation=this.config.orientation;var H=this.config;if(H.useCanvas){this.canvas=H.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{this.canvas=new p(this,H);this.config.labelContainer=(typeof H.injectInto=="string"?H.injectInto:H.injectInto.id)+"-label"}this.graphOptions={klass:u,Node:{selected:false,exist:true,drawn:true}};this.graph=new g(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);this.labels=new $jit.Icicle.Label[this.config.Label.type](this);this.fx=new $jit.Icicle.Plot(this,$jit.Icicle);this.op=new $jit.Icicle.Op(this);this.group=new $jit.Icicle.Group(this);this.clickedNode=null;this.initializeExtras()},refresh:function(){var F=this.config.Label.type;if(F!="Native"){var G=this;this.graph.eachNode(function(H){G.labels.hideLabel(H,false)})}this.compute();this.plot()},plot:function(){this.fx.plot(this.config)},enter:function(I){if(this.busy){return}this.busy=true;var H=this,G=this.config,F=I;var J={onComplete:function(){if(G.request){H.compute()}if(G.animate){H.graph.nodeList.setDataset(["current","end"],{alpha:[1,0]});g.Util.eachSubgraph(I,function(K){K.setData("alpha",1,"end")},"ignore");H.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){H.clickedNode=I;H.compute("end");H.fx.animate({modes:["linear","node-property:width:height"],duration:1000,onComplete:function(){H.busy=false;H.clickedNode=I}})}})}else{H.clickedNode=I;H.busy=false;H.refresh()}}};if(G.request){this.requestNodes(I,J)}else{J.onComplete()}},out:function(){if(this.busy){return}var G=this,H=g.Util,F=this.config,M=this.graph,J=H.getParents(M.getNode(this.clickedNode&&this.clickedNode.id||this.root)),K=J[0],N=K,I=this.clickedNode,L;this.busy=true;this.events.hoveredNode=false;if(!K){this.busy=false;return}L={onComplete:function(){G.clickedNode=K;if(F.request){G.requestNodes(K,{onComplete:function(){G.compute();G.plot();G.busy=false}})}else{G.compute();G.plot();G.busy=false}}};if(F.animate){this.clickedNode=N;this.compute("end");this.clickedNode=I;this.fx.animate({modes:["linear","node-property:width:height"],duration:1000,onComplete:function(){G.clickedNode=N;M.nodeList.setDataset(["current","end"],{alpha:[0,1]});H.eachSubgraph(I,function(O){O.setData("alpha",1)},"ignore");G.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){L.onComplete()}})}})}else{L.onComplete()}},requestNodes:function(H,I){var G=e.merge(this.controller,I),F=this.config.constrained?this.config.levelsToShow:Number.MAX_VALUE;if(G.request){var K=[],J=H._depth;g.Util.eachLevel(H,0,F,function(L){if(L.drawn&&!g.Util.anySubnode(L)){K.push(L);L._level=L._depth-J}});this.group.requestNodes(K,G)}else{G.onComplete()}}});$jit.Icicle.Op=new v({Implements:g.Op});$jit.Icicle.Group=new v({initialize:function(F){this.viz=F;this.canvas=F.canvas;this.config=F.config},requestNodes:function(K,J){var I=0,G=K.length,M={};var H=function(){J.onComplete()};var F=this.viz;if(G==0){H()}for(var L=0;L<G;L++){M[K[L].id]=K[L];J.request(K[L].id,K[L]._level,{onComplete:function(O,N){if(N&&N.children){N.id=O;F.op.sum(N,{type:"nothing"})}if(++I==G){g.Util.computeLevels(F.graph,F.root,0);H()}}})}}});$jit.Icicle.Plot=new v({Implements:g.Plot,plot:function(J,H){J=J||this.viz.controller;var F=this.viz,K=F.graph,G=K.getNode(F.clickedNode&&F.clickedNode.id||F.root),I=G._depth;F.canvas.clear();this.plotTree(G,e.merge(J,{withLabels:true,hideLabels:false,plotSubtree:function(L,M){return !F.config.constrained||(M._depth-I<F.config.levelsToShow)}}),H)}});$jit.Icicle.Label={};$jit.Icicle.Label.Native=new v({Implements:g.Label.Native,renderLabel:function(G,H,J){var M=G.getCtx(),F=H.getData("width"),L=H.getData("height"),N=H.getLabelData("size"),I=M.measureText(H.name);if(L<(N*1.5)||F<I.width){return}var K=H.pos.getc(true);M.fillText(H.name,K.x+F/2,K.y+L/2)}});$jit.Icicle.Label.SVG=new v({Implements:g.Label.SVG,initialize:function(F){this.viz=F},placeLabel:function(G,J,H){var L=J.pos.getc(true),I=this.viz.canvas;var F=I.getSize();var K={x:Math.round(L.x+F.width/2),y:Math.round(L.y+F.height/2)};G.setAttribute("x",K.x);G.setAttribute("y",K.y);H.onPlaceLabel(G,J)}});$jit.Icicle.Label.HTML=new v({Implements:g.Label.HTML,initialize:function(F){this.viz=F},placeLabel:function(G,K,H){var M=K.pos.getc(true),I=this.viz.canvas;var F=I.getSize();var L={x:Math.round(M.x+F.width/2),y:Math.round(M.y+F.height/2)};var J=G.style;J.left=L.x+"px";J.top=L.y+"px";J.display="";H.onPlaceLabel(G,K)}});$jit.Icicle.Plot.NodeTypes=new v({none:{render:e.empty},rectangle:{render:function(I,G,T){var H=this.viz.config;var L=H.offset;var F=I.getData("width");var Q=I.getData("height");var K=I.getData("border");var P=I.pos.getc(true);var O=P.x+L/2,M=P.y+L/2;var S=G.getCtx();if(F-L<2||Q-L<2){return}if(H.cushion){var J=I.getData("color");var R=S.createRadialGradient(O+(F-L)/2,M+(Q-L)/2,1,O+(F-L)/2,M+(Q-L)/2,F<Q?Q:F);var N=e.rgbToHex(e.map(e.hexToRgb(J),function(U){return U*0.3>>0}));R.addColorStop(0,J);R.addColorStop(1,N);S.fillStyle=R}if(K){S.strokeStyle=K;S.lineWidth=3}S.fillRect(O,M,Math.max(0,F-L),Math.max(0,Q-L));K&&S.strokeRect(P.x,P.y,F,Q)},contains:function(H,J){if(this.viz.clickedNode&&!$jit.Graph.Util.isDescendantOf(H,this.viz.clickedNode.id)){return false}var I=H.pos.getc(true),G=H.getData("width"),F=H.getData("height");return this.nodeHelper.rectangle.contains({x:I.x+G/2,y:I.y+F/2},J,G,F)}}});$jit.Icicle.Plot.EdgeTypes=new v({none:e.empty});var A=new v({com:[0,0],children:[null,null,null,null],hasChildren:false,mass:null,fItem:null});var n=new v({maxNodes:50000,nodes:null,setup:function(){this.nodes=new Array()},getQuadTreeNode:function(){if(this.nodes.length>0){return this.nodes.pop()}else{return new A()}},reclaim:function(F){F.mass=0;F.com[0]=0;F.com[1]=0;F.fItem=null;F.hasChildren=false;F.children=[null,null,null,null];if(this.nodes.length<this.maxNodes){this.nodes.push(F)}}});var z=new v({pnames:["GravitationalConstant","Distance","BarnesHutTheta"],DEFAULT_GRAV_CONSTANT:-1,DEFAULT_MIN_GRAV_CONSTANT:-10,DEFAULT_MAX_GRAV_CONSTANT:10,DEFAULT_DISTANCE:-1,DEFAULT_MIN_DISTANCE:-1,DEFAULT_MAX_DISTANCE:500,DEFAULT_THETA:0.9,DEFAULT_MIN_THETA:0,DEFAULT_MAX_THETA:1,GRAVITATIONAL_CONST:0,MIN_DISTANCE:1,BARNES_HUT_THETA:2,xMin:null,xMax:null,yMin:null,yMax:null,params:null,minValues:null,maxValues:null,factory:null,root:null,setup:function(){this.params=[this.DEFAULT_GRAV_CONSTANT,this.DEFAULT_DISTANCE,this.DEFAULT_THETA];this.minValues=[this.DEFAULT_MIN_GRAV_CONSTANT,this.DEFAULT_MIN_DISTANCE,this.DEFAULT_MIN_THETA];this.maxValues=[this.DEFAULT_MAX_GRAV_CONSTANT,this.DEFAULT_MAX_DISTANCE,this.DEFAULT_MAX_THETA];this.factory=new n();this.factory.setup();this.root=this.factory.getQuadTreeNode()},setBounds:function(G,F,I,H){this.xMin=G;this.yMin=F;this.xMax=I;this.yMax=H},insertHelper:function(G,I,H,O,F,N){var P=G.location[0];var M=G.location[1];var L=(H+F)/2;var K=(O+N)/2;var J=(P>=L?1:0)+(M>=K?2:0);if(I.children[J]==null){I.children[J]=this.factory.getQuadTreeNode();I.hasChildren=true}if(J==1||J==3){H=L}else{F=L}if(J>1){O=K}else{N=K}this.insert(G,I.children[J],H,O,F,N)},isSameLocation:function(I,H){var G=Math.abs(I.location[0]-H.location[0]);var F=Math.abs(I.location[1]-H.location[1]);return(G<0.01&&F<0.01)},insert:function(K,L,H,J,G,I){if(L.hasChildren){this.insertHelper(K,L,H,J,G,I)}else{if(L.fItem!=null){if(this.isSameLocation(L.fItem,K)){this.insertHelper(K,L,H,J,G,I)}else{var F=L.fItem;L.fItem=null;this.insertHelper(F,L,H,J,G,I);this.insertHelper(K,L,H,J,G,I)}}else{L.fItem=K}}},calcMass:function(I){var H=0;var F=0;I.mass=0;if(I.hasChildren){for(var G=0;G<I.children.length;G++){if(I.children[G]!=null){this.calcMass(I.children[G]);I.mass+=I.children[G].mass;H+=I.children[G].mass*I.children[G].com[0];F+=I.children[G].mass*I.children[G].com[1]}}}if(I.fItem!=null){I.mass+=I.fItem.mass;H+=I.fItem.mass*I.fItem.location[0];F+=I.fItem.mass*I.fItem.location[1]}I.com[0]=H/I.mass;I.com[1]=F/I.mass},insertRoot:function(F){this.insert(F,this.root,this.xMin,this.yMin,this.xMax,this.yMax)},clearHelper:function(G){for(var F=0;F<G.children.length;F++){if(G.children[F]!=null){this.clearHelper(G.children[F])}}this.factory.reclaim(G)},clear:function(){this.clearHelper(this.root);this.root=this.factory.getQuadTreeNode()},init:function(H){this.clear();var G=Number.MAX_VALUE;var L=Number.MAX_VALUE;var F=Number.MIN_VALUE;var K=Number.MIN_VALUE;for(var I=0;I<H.items.length;I++){var M=H.items[I].location[0];var J=H.items[I].location[1];if(M<G){G=M}if(J<L){L=J}if(M>F){F=M}if(J>K){K=J}}var O=F-G;var N=K-L;if(O>N){K=L+O}else{F=G+N}this.setBounds(G,L,F,K);for(var I=0;I<H.items.length;I++){this.insertRoot(H.items[I])}this.calcMass(this.root)},getForce:function(F){this.forceHelper(F,this.root,this.xMin,this.yMin,this.xMax,this.yMax)},forceHelper:function(R,I,H,O,G,M){var T=I.com[0]-R.location[0];var S=I.com[1]-R.location[1];var F=Math.sqrt(T*T+S*S);var N=false;if(F==0){T=(Math.random()-0.5)/50;S=(Math.random()-0.5)/50;F=Math.sqrt(T*T+S*S);N=true}var P=this.params[this.MIN_DISTANCE]>0&&F>this.params[this.MIN_DISTANCE];if((!I.hasChildren&&I.fItem!=R)||(!N&&(G-H)/F<this.params[this.BARNES_HUT_THETA])){if(P){return}var Q=this.params[this.GRAVITATIONAL_CONST]*R.mass*I.mass/(F*F*F);R.force[0]+=Q*T;R.force[1]+=Q*S}else{if(I.hasChildren){var L=(H+G)/2;var K=(O+M)/2;for(var J=0;J<I.children.length;J++){if(I.children[J]!=null){this.forceHelper(R,I.children[J],(J==1||J==3?L:H),(J>1?K:O),(J==1||J==3?G:L),(J>1?M:K))}}if(P){return}if(I.fItem!=null&&I.fItem!=R){var Q=this.params[this.GRAVITATIONAL_CONST]*R.mass*I.fItem.mass/(F*F*F);R.force[0]+=Q*T;R.force[1]+=Q*S}}}}});var o=new v({pnames:["SpringCoefficient","DefaultSpringLength"],DEFAULT_SPRING_COEFF:0.0001,DEFAULT_MAX_SPRING_COEFF:0.001,DEFAULT_MIN_SPRING_COEFF:0.00001,DEFAULT_SPRING_LENGTH:50,DEFAULT_MIN_SPRING_LENGTH:0,DEFAULT_MAX_SPRING_LENGTH:200,SPRING_COEFF:0,SPRING_LENGTH:1,params:null,minValues:null,maxValues:null,setup:function(){this.params=[this.DEFAULT_SPRING_COEFF,this.DEFAULT_SPRING_LENGTH];this.minValues=[this.DEFAULT_MIN_SPRING_COEFF,this.DEFAULT_MIN_SPRING_LENGTH];this.maxValues=[this.DEFAULT_MAX_SPRING_COEFF,this.DEFAULT_MAX_SPRING_LENGTH]},getForce:function(R){var L=R.item1;var K=R.item2;var I=(R.length<0?this.params[this.SPRING_LENGTH]:R.length);var H=L.location[0];var O=L.location[1];var G=K.location[0];var N=K.location[1];var Q=G-H;var P=N-O;var F=Math.sqrt(Q*Q+P*P);if(F==0){Q=(Math.random()-0.5)/50;P=(Math.random()-0.5)/50;F=Math.sqrt(Q*Q+P*P)}var M=F-I;var J=(R.coeff<0?this.params[this.SPRING_COEFF]:R.coeff)*M/F;L.force[0]+=J*Q;L.force[1]+=J*P;K.force[0]+=-J*Q;K.force[1]+=-J*P},init:function(){}});var w=new v({pnames:["DragCoefficient"],DEFAULT_DRAG_COEFF:0.01,DEFAULT_MIN_DRAG_COEFF:0,DEFAULT_MAX_DRAG_COEFF:0.1,DRAG_COEFF:0,params:null,minValues:null,maxValues:null,setup:function(){this.params=[this.DEFAULT_DRAG_COEFF];this.minValues=[this.DEFAULT_MIN_DRAG_COEFF];this.maxValues=[this.DEFAULT_MAX_DRAG_COEFF]},getForce:function(F){F.force[0]-=this.params[this.DRAG_COEFF]*F.velocity[0];F.force[1]-=this.params[this.DRAG_COEFF]*F.velocity[1]},init:function(){}});var y=new v({integrate:function(O,G){var H=O.speedLimit;var N,M,P,L;var J,I;for(var K=0;K<O.items.length;K++){var Q=O.items[K];L=G/Q.mass;J=Q.k;I=Q.l;Q.plocation[0]=Q.location[0];Q.plocation[1]=Q.location[1];J[0][0]=G*Q.velocity[0];J[0][1]=G*Q.velocity[1];I[0][0]=L*Q.force[0];I[0][1]=L*Q.force[1];Q.location[0]+=0.5*J[0][0];Q.location[1]+=0.5*J[0][1]}O.accumulate();for(var K=0;K<O.items.length;K++){var Q=O.items[K];L=G/Q.mass;J=Q.k;I=Q.l;N=Q.velocity[0]+0.5*I[0][0];M=Q.velocity[1]+0.5*I[0][1];P=Math.sqrt(N*N+M*M);if(P>H){N=H*N/P;M=H*M/P}J[1][0]=G*N;J[1][1]=G*M;I[1][0]=L*Q.force[0];I[1][1]=L*Q.force[1];Q.location[0]=Q.plocation[0]+0.5*J[1][0];Q.location[1]=Q.plocation[1]+0.5*J[1][1]}O.accumulate();for(var K=0;K<O.items.length;K++){var Q=O.items[K];L=G/Q.mass;J=Q.k;I=Q.l;N=Q.velocity[0]+0.5*I[1][0];M=Q.velocity[1]+0.5*I[1][1];P=Math.sqrt(N*N+M*M);if(P>H){N=H*N/P;M=H*M/P}J[2][0]=G*N;J[2][1]=G*M;I[2][0]=L*Q.force[0];I[2][1]=L*Q.force[1];Q.location[0]=Q.plocation[0]+0.5*J[2][0];Q.location[1]=Q.plocation[1]+0.5*J[2][1]}O.accumulate();for(var K=0;K<O.items.length;K++){var Q=O.items[K];L=G/Q.mass;J=Q.k;I=Q.l;var F=Q.plocation;N=Q.velocity[0]+I[2][0];M=Q.velocity[1]+I[2][1];P=Math.sqrt(N*N+M*M);if(P>H){N=H*N/P;M=H*M/P}J[3][0]=G*N;J[3][1]=G*M;I[3][0]=L*Q.force[0];I[3][1]=L*Q.force[1];Q.location[0]=F[0]+(J[0][0]+J[3][0])/6+(J[1][0]+J[2][0])/3;Q.location[1]=F[1]+(J[0][1]+J[3][1])/6+(J[1][1]+J[2][1])/3;N=(I[0][0]+I[3][0])/6+(I[1][0]+I[2][0])/3;M=(I[0][1]+I[3][1])/6+(I[1][1]+I[2][1])/3;P=Math.sqrt(N*N+M*M);if(P>H){N=H*N/P;M=H*M/P}Q.velocity[0]+=N;Q.velocity[1]+=M}}});var a=new v({speedLimit:1,iflen:0,sflen:0,integrator:null,items:null,springs:null,iforces:null,sforces:null,setup:function(){this.items=new Array();this.springs=new Array();this.iforces=new Array();this.sforces=new Array();this.integrator=new y()},accumulate:function(){for(var G=0;G<this.iforces.length;G++){this.iforces[G].init(this)}for(var G=0;G<this.sforces.length;G++){this.sforces[G].init(this)}for(var G=0;G<this.items.length;G++){this.items[G].force[0]=0;this.items[G].force[1]=0;for(var F=0;F<this.iforces.length;F++){this.iforces[F].getForce(this.items[G])}}for(var G=0;G<this.springs.length;G++){for(var F=0;F<this.sforces.length;F++){this.sforces[F].getForce(this.springs[G])}}},runSimulator:function(F){this.accumulate();this.integrator.integrate(this,F)},addForce:function(F,G){if(G){this.iforces.push(F);this.iflen++}else{this.sforces.push(F);this.sflen++}},addItem:function(F){this.items.push(F)},addSpring:function(F){this.springs.push(F)}});var k=new v({item1:null,item2:null,coeff:null,length:null,setup:function(I,H,G,F){this.item1=I;this.item2=H;this.coeff=G;this.length=F}});var s=new v({mass:1,force:null,velocity:null,location:null,plocation:null,k:[[0,0],[0,0],[0,0],[0,0]],l:[[0,0],[0,0],[0,0],[0,0]],setup:function(){this.force=new Array();this.velocity=new Array();this.location=new Array();this.plocation=new Array()},init:function(G,F){this.force[0]=0;this.force[1]=0;this.velocity[0]=0;this.velocity[1]=0;this.location[0]=G;this.location[1]=F;this.plocation[0]=0;this.plocation[1]=0}});i.ForceDirected=new v({getOptions:function(L){var J=this.canvas.getSize();var G=J.width,I=J.height;var K=0;this.graph.eachNode(function(N){K++});var M=G*I/K,H=Math.sqrt(M);var F=this.config.levelDistance;return{width:G-F,height:I-F,tstart:G*0.1,nodef:function(N){return M/(N||1)},edgef:function(N){return H*(N-F)}}},compute:function(F,G){this.computeFast(F,G)},computeFast:function(S,M){var O=new a();O.setup();var V=new z();V.setup();var T=new o();T.setup();var L=new w();L.setup();O.addForce(V,true);O.addForce(T,false);O.addForce(L,true);var J=1000;var G=e.splat(S||["current","start","end"]);var I=this.getOptions();var Q=[];h.compute(this.graph,G,this.config);this.graph.computeLevels(this.root,0,"ignore");this.graph.eachNode(function(W){e.each(G,function(X){var Y=W.getPos(X);Y.x=I.width/2;Y.y=I.height/2;W.forceItem=new s();W.forceItem.setup();W.forceItem.init(Y.x,Y.y);O.addItem(W.forceItem);W.disp={};e.each(G,function(Z){W.disp[Z]=x(0,0)})})});this.graph.eachNode(function(W){W.eachAdjacency(function(X){if(Q[X.nodeTo.id]===undefined){var Y=new k();Y.setup(X.nodeFrom.forceItem,X.nodeTo.forceItem,-1,-1);O.addSpring(Y);Q[X.nodeFrom.id]=[];Q[X.nodeFrom.id][X.nodeTo.id]=true}})});var H=Math.ceil(this.config.iterations/M.iter);var P=0;var R=0;var F=this.config.iterations;var K=0;var U=this.graph;(function N(){for(var af=M.iter,ae=0;ae<af;ae++){I.t=I.tstart;if(F){I.t*=(1-K++/(F-1))}J*=(1-K/F);var aa=J+50;O.runSimulator(aa);if(F&&K>=F){var Z=0;var ah=0;var Y=I.width/2;var ag=I.height/2;U.eachNode(function(aj){e.each(G,function(ap){var al=aj.forceItem.location[0];var ar=aj.forceItem.location[1];var ak=aj.getData("dim")*2;var ao=aj.getData("dim")*2;var am=aj.disp[ap];var an=am.norm()||1;var aq=aj.getPos(ap);aq.x=al;aq.y=ar})});M.onComplete();var X=-Number.MAX_VALUE;var ad=Number.MAX_VALUE;var W=-Number.MAX_VALUE;var ac=Number.MAX_VALUE;U.eachNode(function(aj){e.each(G,function(al){var ak=aj.getPos(al);if(ak.x>X){X=ak.x}if(ak.x<ad){ad=ak.x}if(ak.y>W){W=ak.y}if(ak.y<ac){ac=ak.y}})});var ai;var ab;if(X<0){ab=Math.ceil(Math.floor(Math.abs(ad))-Math.floor(Math.abs(X)))}else{if(ad>=0){ab=Math.ceil(X-ad)}else{ab=Math.ceil(X+Math.abs(ad))}}if(W<0){ai=Math.ceil(Math.floor(Math.abs(ac))-Math.floor(Math.abs(W)))}else{if(ac>=0){ai=Math.ceil(W-ac)}else{ai=Math.ceil(W+Math.abs(ac))}}var Y=I.width/2;var ag=I.height/2;U.eachNode(function(aj){e.each(G,function(am){var ak=aj.getPos(am);var al=aj.getData("dim");if(ad<0){ak.x=((ak.x+Math.abs(ad))*(I.width/ab))-(I.width/2)}else{ak.x=((ak.x-ad)*(I.width/ab))-(I.width/2)}if(ak.x<=-Y+al){ak.x=-Y+(al*2)}if(ak.x>=Y-al){ak.x=Y-(al*2)}if(ac<0){ak.y=((ak.y+Math.abs(ac))*(I.height/ai))-(I.height/2)}else{ak.y=((ak.y-ac)*(I.height/ai))-(I.height/2)}if(ak.y<=-ag+al){ak.y=-ag+(al*2)}if(ak.y>=ag-al){ak.y=ag-(al*2)}})});return}}M.onStep(Math.round(K/(F-1)*100));setTimeout(N,1)})()}});$jit.ForceDirected=new v({Implements:[f,t,i.ForceDirected],initialize:function(G){var F=$jit.ForceDirected;var H={iterations:50,levelDistance:50};this.controller=this.config=e.merge(q("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),H,G);var I=this.config;if(I.useCanvas){this.canvas=I.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(I.background){I.background=e.merge({type:"Circles"},I.background)}this.canvas=new p(this,I);this.config.labelContainer=(typeof I.injectInto=="string"?I.injectInto:I.injectInto.id)+"-label"}this.graphOptions={klass:u,Node:{selected:false,exist:true,drawn:true}};this.graph=new g(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new F.Label[I.Label.type](this);this.fx=new F.Plot(this,F);this.op=new F.Op(this);this.json=null;this.busy=false;this.initializeExtras()},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},computeIncremental:function(F){F=e.merge({iter:20,property:"end",onStep:e.empty,onComplete:e.empty},F||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.compute(F.property,F)},computePrefuse:function(F){F=e.merge({iter:20,property:"end",onStep:e.empty,onComplete:e.empty},F||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.computeFast(F.property,F)},plot:function(){this.fx.plot()},animate:function(F){this.fx.animate(e.merge({modes:["linear"]},F||{}))}});$jit.ForceDirected.$extend=true;(function(F){F.Op=new v({Implements:g.Op});F.Plot=new v({Implements:g.Plot});F.Label={};F.Label.Native=new v({Implements:g.Label.Native});F.Label.SVG=new v({Implements:g.Label.SVG,initialize:function(G){this.viz=G},placeLabel:function(Q,K,L){var O=K.pos.getc(true),H=this.viz.canvas,I=H.translateOffsetX,G=H.translateOffsetY,P=H.scaleOffsetX,N=H.scaleOffsetY,M=H.getSize();var J={x:Math.round(O.x*P+I+M.width/2),y:Math.round(O.y*N+G+M.height/2)};Q.setAttribute("x",J.x);Q.setAttribute("y",J.y);L.onPlaceLabel(Q,K)}});F.Label.HTML=new v({Implements:g.Label.HTML,initialize:function(G){this.viz=G},placeLabel:function(R,L,M){var P=L.pos.getc(true),I=this.viz.canvas,J=I.translateOffsetX,H=I.translateOffsetY,Q=I.scaleOffsetX,O=I.scaleOffsetY,N=I.getSize();var K={x:Math.round(P.x*Q+J+N.width/2),y:Math.round(P.y*O+H+N.height/2)};var G=R.style;G.left=K.x+"px";G.top=K.y+"px";G.display=this.fitsInCanvas(K,I)?"":"none";M.onPlaceLabel(R,L)}});F.Plot.NodeTypes=new v({none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(H,G){var J=H.pos.getc(true),I=H.getData("dim");this.nodeHelper.circle.render("fill",J,I,G)},contains:function(G,J){var I=G.pos.getc(true),H=G.getData("dim");return this.nodeHelper.circle.contains(I,J,H)}},ellipse:{render:function(J,H){var K=J.pos.getc(true),I=J.getData("width"),G=J.getData("height");this.nodeHelper.ellipse.render("fill",K,I,G,H)},contains:function(I,K){var J=I.pos.getc(true),H=I.getData("width"),G=I.getData("height");return this.nodeHelper.ellipse.contains(J,K,H,G)}},square:{render:function(H,G){var J=H.pos.getc(true),I=H.getData("dim");this.nodeHelper.square.render("fill",J,I,G)},contains:function(G,J){var I=G.pos.getc(true),H=G.getData("dim");return this.nodeHelper.square.contains(I,J,H)}},rectangle:{render:function(J,H){var K=J.pos.getc(true),I=J.getData("width"),G=J.getData("height");this.nodeHelper.rectangle.render("fill",K,I,G,H)},contains:function(I,K){var J=I.pos.getc(true),H=I.getData("width"),G=I.getData("height");return this.nodeHelper.rectangle.contains(J,K,H,G)}},triangle:{render:function(H,G){var J=H.pos.getc(true),I=H.getData("dim");this.nodeHelper.triangle.render("fill",J,I,G)},contains:function(G,J){var I=G.pos.getc(true),H=G.getData("dim");return this.nodeHelper.triangle.contains(I,J,H)}},star:{render:function(H,G){var J=H.pos.getc(true),I=H.getData("dim");this.nodeHelper.star.render("fill",J,I,G)},contains:function(G,J){var I=G.pos.getc(true),H=G.getData("dim");return this.nodeHelper.star.contains(I,J,H)}},roundedRectangle:{render:function(K,I){var L=K.pos.getc(true),J=K.getData("width"),H=K.getData("height"),G=K.getData("radius");this.nodeHelper.roundedRectangle.render("fill",L,J,H,G,I)},contains:function(J,L){var K=J.pos.getc(true),I=J.getData("width"),H=J.getData("height"),G=J.getData("radius");return this.nodeHelper.roundedRectangle.contains(K,L,I,H,G)}}});F.Plot.EdgeTypes=new v({none:e.empty,line:{render:function(G,H){var J=G.nodeFrom.pos.getc(true),I=G.nodeTo.pos.getc(true);this.edgeHelper.line.render(J,I,H)},contains:function(G,J){var I=G.nodeFrom.pos.getc(true),H=G.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(I,H,J,this.edge.epsilon)}},arrow:{render:function(H,I){var M=H.nodeFrom.pos.getc(true),L=H.nodeTo.pos.getc(true),K=H.getData("dim"),J=H.data.$direction,G=(J&&J.length>1&&J[0]!=H.nodeFrom.id);this.edgeHelper.arrow.render(M,L,K,G,I)},contains:function(G,J){var I=G.nodeFrom.pos.getc(true),H=G.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(I,H,J,this.edge.epsilon)}}})})($jit.ForceDirected);$jit.TM={};var E=$jit.TM;$jit.TM.$extend=true;E.Base={layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(F){var G={orientation:"h",titleHeight:13,offset:2,levelsToShow:0,labelsToShow:[0,-1],constrained:false,animate:false,Node:{type:"rectangle",overridable:true,width:3,height:3,color:"#444",props:"node-property:width:height"},Label:{textAlign:"center",textBaseline:"top"},Edge:{type:"none"},duration:700,fps:45};this.controller=this.config=e.merge(q("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),G,F);this.layout.orientation=this.config.orientation;var H=this.config;if(H.useCanvas){this.canvas=H.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(H.background){H.background=e.merge({type:"Circles"},H.background)}this.canvas=new p(this,H);this.config.labelContainer=(typeof H.injectInto=="string"?H.injectInto:H.injectInto.id)+"-label"}this.graphOptions={klass:u,Node:{selected:false,exist:true,drawn:true}};this.graph=new g(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new E.Label[H.Label.type](this);this.fx=new E.Plot(this);this.op=new E.Op(this);this.group=new E.Group(this);this.geom=new E.Geom(this);this.clickedNode=null;this.busy=false;this.initializeExtras()},refresh:function(){if(this.busy){return}this.busy=true;var G=this;if(this.config.animate){this.compute("end");this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root));this.fx.animate(e.merge(this.config,{modes:["linear",this.config.Node.props],onComplete:function(){G.busy=false}}))}else{var F=this.config.Label.type;if(F!="Native"){this.graph.eachNode(function(H){G.labels.hideLabel(H,false)})}this.busy=false;this.compute();this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root));this.plot()}},plot:function(){this.fx.plot()},leaf:function(F){return F.getSubnodes([1,1],"ignore").length==0},enter:function(L){if(this.busy){return}this.busy=true;var H=this,G=this.config,J=this.graph,F=L,I=this.clickedNode;var K={onComplete:function(){H.geom.setRightLevelToShow(L);if(G.request){H.compute()}if(G.animate){J.nodeList.setData("alpha",0,"end");L.eachSubgraph(function(M){M.setData("alpha",1,"end");M.selected=false},"ignore");F.selected=true;H.fx.animate({duration:H.config.duration/3,modes:["node-property:alpha"],onComplete:function(){H.clickedNode=F;H.compute("end");H.clickedNode=I;H.fx.animate({duration:2*H.config.duration/3,modes:["linear",H.config.Node.props],onComplete:function(){H.busy=false;H.clickedNode=F;H.geom.setRightLevelToShow(F)}})}})}else{H.busy=false;H.clickedNode=L;H.refresh()}}};this.geom.setRightLevelToShow(L);if(G.request){this.requestNodes(F,K)}else{K.onComplete()}},out:function(){if(this.busy){return}this.busy=true;this.events.hoveredNode=false;var J=this,H=this.config,L=this.graph,G=L.getNode(this.clickedNode&&this.clickedNode.id||this.root).getParents(),I=G[0],F=I,K=this.clickedNode;if(!I){this.busy=false;return}I.selected=true;var M={onComplete:function(){K.selected=false;J.clickedNode=I;if(H.request){J.requestNodes(I,{onComplete:function(){J.compute();J.plot();J.busy=false}})}else{J.compute();J.plot();J.busy=false}J.geom.setRightLevelToShow(I);J.plot()}};this.geom.setRightLevelToShow(I);if(H.animate){this.clickedNode=F;this.compute("end");this.clickedNode=K;this.fx.animate({duration:2*this.config.duration/3,modes:["linear",this.config.Node.props],onComplete:function(){J.clickedNode=F;F.eachSubgraph(function(N){N.setDataset(["current","end"],{alpha:[0,1]})},"ignore");K.eachSubgraph(function(N){N.setData("alpha",1)},"ignore");J.geom.setRightLevelToShow(I);J.fx.animate({duration:J.config.duration/3,modes:["node-property:alpha"],onComplete:function(){M.onComplete()}})}})}else{M.onComplete()}},requestNodes:function(H,I){var G=e.merge(this.controller,I),F=this.config.levelsToShow;if(G.request){var K=[],J=H._depth;H.eachLevel(0,F,function(M){var L=F-(M._depth-J);if(M.drawn&&!M.anySubnode()&&L>0){K.push(M);M._level=L}});this.group.requestNodes(K,G)}else{G.onComplete()}},reposition:function(){this.compute("end")}};E.Op=new v({Implements:g.Op,initialize:function(F){this.viz=F}});E.Geom=new v({Implements:g.Geom,getRightLevelToShow:function(){return this.viz.config.levelsToShow},setRightLevelToShow:function(G){var J=this.getRightLevelToShow(),I=this.viz.config.labelsToShow,F=this.viz.labels;var H={};G.eachLevel(0,false,function(L){var K=L._depth-G._depth;L._hideLabel=I[0]>=0&&K<I[0]||I[1]>=0&&K>I[1];if(J>0&&K>J){L.drawn=false;L.exist=false;L.ignore=true;F.hideLabel(L,false)}else{L.drawn=true;L.exist=true;delete L.ignore}H[L.name]=L._hideLabel});G.drawn=true;delete G.ignore}});E.Group=new v({initialize:function(F){this.viz=F;this.canvas=F.canvas;this.config=F.config},requestNodes:function(K,J){var I=0,G=K.length,M={};var H=function(){J.onComplete()};var F=this.viz;if(G==0){H()}for(var L=0;L<G;L++){M[K[L].id]=K[L];J.request(K[L].id,K[L]._level,{onComplete:function(O,N){if(N&&N.children){N.id=O;F.op.sum(N,{type:"nothing"})}if(++I==G){F.graph.computeLevels(F.root,0);H()}}})}}});E.Plot=new v({Implements:g.Plot,initialize:function(F){this.viz=F;this.config=F.config;this.node=this.config.Node;this.edge=this.config.Edge;this.animation=new D;this.nodeTypes=new E.Plot.NodeTypes;this.edgeTypes=new E.Plot.EdgeTypes;this.labels=F.labels},plot:function(H,G){var F=this.viz,I=F.graph;F.canvas.clear();this.plotTree(I.getNode(F.clickedNode&&F.clickedNode.id||F.root),e.merge(F.config,H||{},{withLabels:true,hideLabels:false,plotSubtree:function(K,J){return K.anySubnode("exist")}}),G)}});E.Label={};E.Label.Native=new v({Implements:g.Label.Native,initialize:function(F){this.config=F.config;this.leaf=F.leaf},renderLabel:function(G,H,I){if(H._hideLabel||!this.leaf(H)&&!this.config.titleHeight){return}var K=H.pos.getc(true),N=G.getCtx(),F=H.getData("width"),M=H.getData("height"),L=K.x+F/2,J=K.y;if(isNaN(F)||F===0){N.fillText(H.name,L,J)}else{N.fillText(H.name,L,J,F)}}});E.Label.SVG=new v({Implements:g.Label.SVG,initialize:function(F){this.viz=F;this.leaf=F.leaf;this.config=F.config},placeLabel:function(P,J,K){K=K||this.viz.controller;var N=J.pos.getc(true),G=this.viz.canvas,H=G.translateOffsetX,F=G.translateOffsetY,O=G.scaleOffsetX,M=G.scaleOffsetY,L=G.getSize();var I={x:Math.round(N.x*O+H+L.width/2),y:Math.round(N.y*M+F+L.height/2)};P.setAttribute("x",I.x);P.setAttribute("y",I.y);if(J._hideLabel||!this.leaf(J)&&!this.config.titleHeight){P.style.display="none"}K.onPlaceLabel(P,J)}});E.Label.HTML=new v({Implements:g.Label.HTML,initialize:function(F){this.viz=F;this.leaf=F.leaf;this.config=F.config},placeLabel:function(Q,K,L){L=L||this.viz.controller;var O=K.pos.getc(true),H=this.viz.canvas,I=H.translateOffsetX,G=H.translateOffsetY,P=H.scaleOffsetX,N=H.scaleOffsetY,M=H.getSize();var J={x:Math.round(O.x*P+I+M.width/2),y:Math.round(O.y*N+G+M.height/2)};var F=Q.style;F.left=J.x+"px";F.top=J.y+"px";F.width=Math.max(0,K.getData("width")*P)+"px";F.height=Math.max(0,K.getData("height")*N)+"px";F.zIndex=K._depth*100;F.display="";if(K._hideLabel||!this.leaf(K)&&!this.config.titleHeight){Q.style.display="none"}L.onPlaceLabel(Q,K)}});E.Plot.NodeTypes=new v({none:{render:e.empty},rectangle:{render:function(I,G,V){var M=this.viz.leaf(I),H=this.config,R=H.offset,L=H.titleHeight,Q=I.pos.getc(true),F=I.getData("width"),S=I.getData("height"),K=I.getData("border"),U=G.getCtx(),P=Q.x+R/2,N=Q.y+R/2;if(F<=R||S<=R){return}if(M){if(H.cushion){var T=U.createRadialGradient(P+(F-R)/2,N+(S-R)/2,1,P+(F-R)/2,N+(S-R)/2,F<S?S:F);var J=I.getData("color");var O=e.rgbToHex(e.map(e.hexToRgb(J),function(W){return W*0.2>>0}));T.addColorStop(0,J);T.addColorStop(1,O);U.fillStyle=T}U.fillRect(P,N,F-R,S-R);if(K){U.save();U.strokeStyle=K;U.strokeRect(P,N,F-R,S-R);U.restore()}}else{if(L>0){U.fillRect(Q.x+R/2,Q.y+R/2,F-R,L-R);if(K){U.save();U.strokeStyle=K;U.strokeRect(Q.x+R/2,Q.y+R/2,F-R,S-R);U.restore()}}}},contains:function(I,K){if(this.viz.clickedNode&&!I.isDescendantOf(this.viz.clickedNode.id)||I.ignore){return false}var J=I.pos.getc(true),H=I.getData("width"),G=this.viz.leaf(I),F=G?I.getData("height"):this.config.titleHeight;return this.nodeHelper.rectangle.contains({x:J.x+H/2,y:J.y+F/2},K,H,F)}}});E.Plot.EdgeTypes=new v({none:e.empty});E.SliceAndDice=new v({Implements:[f,t,E.Base,i.TM.SliceAndDice]});E.Squarified=new v({Implements:[f,t,E.Base,i.TM.Squarified]});E.Strip=new v({Implements:[f,t,E.Base,i.TM.Strip]});$jit.RGraph=new v({Implements:[f,t,i.Radial],initialize:function(F){var G=$jit.RGraph;var H={interpolation:"linear",levelDistance:100};this.controller=this.config=e.merge(q("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),H,F);var I=this.config;if(I.useCanvas){this.canvas=I.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(I.background){I.background=e.merge({type:"Circles"},I.background)}this.canvas=new p(this,I);this.config.labelContainer=(typeof I.injectInto=="string"?I.injectInto:I.injectInto.id)+"-label"}this.graphOptions={klass:d,Node:{selected:false,exist:true,drawn:true}};this.graph=new g(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new G.Label[I.Label.type](this);this.fx=new G.Plot(this,G);this.op=new G.Op(this);this.json=null;this.root=null;this.busy=false;this.parent=false;this.initializeExtras()},createLevelDistanceFunc:function(){var F=this.config.levelDistance;return function(G){return(G._depth+1)*F}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(M){var H=false;var L=this.graph.getNode(M);var J=L.getParents();var I=(J.length>0)?J[0]:false;if(I){var F=I.pos.getc(),K=L.pos.getc();var G=F.add(K.scale(-1));H=Math.atan2(G.y,G.x);if(H<0){H+=2*Math.PI}}return{parent:I,theta:H}},tagChildren:function(J,L){if(J.angleSpan){var K=[];J.eachAdjacency(function(M){K.push(M.nodeTo)},"ignore");var F=K.length;for(var I=0;I<F&&L!=K[I].id;I++){}for(var H=(I+1)%F,G=0;L!=K[H].id;H=(H+1)%F){K[H].dist=G++}}},onClick:function(K,G){if(this.root!=K&&!this.busy){this.busy=true;this.root=K;var H=this;this.controller.onBeforeCompute(this.graph.getNode(K));var I=this.getNodeAndParentAngle(K);this.tagChildren(I.parent,K);this.parent=I.parent;this.compute("end");var F=I.theta-I.parent.endPos.theta;this.graph.eachNode(function(L){L.endPos.set(L.endPos.getp().add(m(F,0)))});var J=this.config.interpolation;G=e.merge({onComplete:e.empty},G||{});this.fx.animate(e.merge({hideLabels:true,modes:[J]},G,{onComplete:function(){H.busy=false;G.onComplete()}}))}}});$jit.RGraph.$extend=true;(function(F){F.Op=new v({Implements:g.Op});F.Plot=new v({Implements:g.Plot});F.Label={};F.Label.Native=new v({Implements:g.Label.Native,initialize:function(G){this.viz=G;this.label=G.config.Label;this.config=G.config},renderLabel:function(J,L,N){var U=L.getData("span");if(U<Math.PI/2&&Math.tan(U)*this.config.levelDistance*L._depth<10){return}var V=J.getCtx();var H=V.measureText(L.name);if(L.id==this.viz.root){var T=-H.width/2,R=0,S=0;var G=0}else{var K=5;var G=N.levelDistance-K;var Q=L.pos.clone();Q.rho+=K+(L.getData("dim")||0);var I=Q.getp(true);var O=Q.getc(true);var T=O.x,R=O.y;var M=Math.PI;var P=(I.theta>M/2&&I.theta<3*M/2);var S=P?I.theta+M:I.theta;if(P){T-=Math.abs(Math.cos(I.theta)*H.width);R+=Math.sin(I.theta)*H.width}else{if(L.id==this.viz.root){T-=H.width/2}}}V.save();V.translate(T,R);V.rotate(S);V.fillText(L.name,0,0);V.restore()}});F.Label.SVG=new v({Implements:g.Label.SVG,initialize:function(G){this.viz=G},placeLabel:function(Q,K,L){var O=K.pos.getc(true),H=this.viz.canvas,I=H.translateOffsetX,G=H.translateOffsetY,P=H.scaleOffsetX,N=H.scaleOffsetY,M=H.getSize();var J={x:Math.round(O.x*P+I+M.width/2),y:Math.round(O.y*N+G+M.height/2)};Q.setAttribute("x",J.x);Q.setAttribute("y",J.y);L.onPlaceLabel(Q,K)}});F.Label.HTML=new v({Implements:g.Label.HTML,initialize:function(G){this.viz=G},placeLabel:function(R,L,M){var P=L.pos.getc(true),I=this.viz.canvas,J=I.translateOffsetX,H=I.translateOffsetY,Q=I.scaleOffsetX,O=I.scaleOffsetY,N=I.getSize();var K={x:Math.round(P.x*Q+J+N.width/2),y:Math.round(P.y*O+H+N.height/2)};var G=R.style;G.left=K.x+"px";G.top=K.y+"px";G.display=this.fitsInCanvas(K,I)?"":"none";M.onPlaceLabel(R,L)}});F.Plot.NodeTypes=new v({none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(H,G){var J=H.pos.getc(true),I=H.getData("dim");this.nodeHelper.circle.render("fill",J,I,G)},contains:function(G,J){var I=G.pos.getc(true),H=G.getData("dim");return this.nodeHelper.circle.contains(I,J,H)}},ellipse:{render:function(J,H){var K=J.pos.getc(true),I=J.getData("width"),G=J.getData("height");this.nodeHelper.ellipse.render("fill",K,I,G,H)},contains:function(I,K){var J=I.pos.getc(true),H=I.getData("width"),G=I.getData("height");return this.nodeHelper.ellipse.contains(J,K,H,G)}},square:{render:function(H,G){var J=H.pos.getc(true),I=H.getData("dim");this.nodeHelper.square.render("fill",J,I,G)},contains:function(G,J){var I=G.pos.getc(true),H=G.getData("dim");return this.nodeHelper.square.contains(I,J,H)}},rectangle:{render:function(J,H){var K=J.pos.getc(true),I=J.getData("width"),G=J.getData("height");this.nodeHelper.rectangle.render("fill",K,I,G,H)},contains:function(I,K){var J=I.pos.getc(true),H=I.getData("width"),G=I.getData("height");return this.nodeHelper.rectangle.contains(J,K,H,G)}},triangle:{render:function(H,G){var J=H.pos.getc(true),I=H.getData("dim");this.nodeHelper.triangle.render("fill",J,I,G)},contains:function(G,J){var I=G.pos.getc(true),H=G.getData("dim");return this.nodeHelper.triangle.contains(I,J,H)}},star:{render:function(H,G){var J=H.pos.getc(true),I=H.getData("dim");this.nodeHelper.star.render("fill",J,I,G)},contains:function(G,J){var I=G.pos.getc(true),H=G.getData("dim");return this.nodeHelper.star.contains(I,J,H)}},roundedRectangle:{render:function(K,I){var L=K.pos.getc(true),J=K.getData("width"),H=K.getData("height"),G=K.getData("radius");this.nodeHelper.roundedRectangle.render("fill",L,J,H,G,I)},contains:function(J,L){var K=J.pos.getc(true),I=J.getData("width"),H=J.getData("height"),G=J.getData("radius");return this.nodeHelper.roundedRectangle.contains(K,L,I,H,G)}}});F.Plot.EdgeTypes=new v({none:e.empty,line:{render:function(G,H){var J=G.nodeFrom.pos.getc(true),I=G.nodeTo.pos.getc(true);this.edgeHelper.line.render(J,I,H)},contains:function(G,J){var I=G.nodeFrom.pos.getc(true),H=G.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(I,H,J,this.edge.epsilon)}},arrow:{render:function(H,I){var N=H.nodeFrom.pos.getc(true),M=H.nodeTo.pos.getc(true),L=H.getData("dim"),K=H.data.$direction,G=(K&&K.length>1&&K[0]!=H.nodeFrom.id),J=this.edge.arrowPosition||"end";this.edgeHelper.arrow.render(N,M,L,G,I,J)},contains:function(G,J){var I=G.nodeFrom.pos.getc(true),H=G.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(I,H,J,this.edge.epsilon)}}})})($jit.RGraph);u.prototype.moebiusTransformation=function(H){var F=this.add(H);var G=H.$conjugate().$prod(this);G.x++;return F.$div(G)};g.Util.moebiusTransformation=function(H,J,I,G,F){this.eachNode(H,function(L){for(var K=0;K<I.length;K++){var N=J[K].scale(-1),M=G?G:I[K];L.getPos(I[K]).set(L.getPos(M).getc().moebiusTransformation(N))}},F)};$jit.Hypertree=new v({Implements:[f,t,i.Radial],initialize:function(F){var I=$jit.Hypertree;var G={radius:"auto",offset:0,Edge:{type:"hyperline"},duration:1500,fps:35};this.controller=this.config=e.merge(q("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),G,F);var H=this.config;if(H.useCanvas){this.canvas=H.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(H.background){H.background=e.merge({type:"Circles"},H.background)}this.canvas=new p(this,H);this.config.labelContainer=(typeof H.injectInto=="string"?H.injectInto:H.injectInto.id)+"-label"}this.graphOptions={klass:d,Node:{selected:false,exist:true,drawn:true}};this.graph=new g(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new I.Label[H.Label.type](this);this.fx=new I.Plot(this,I);this.op=new I.Op(this);this.json=null;this.root=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var J=this.getRadius();var L=0,F=Math.max,G=this.config;this.graph.eachNode(function(M){L=F(M._depth,L)},"ignore");L++;var K=function(M){return function(O){O.scale=J;var Q=O._depth+1;var P=0,N=Math.pow;while(Q){P+=N(M,Q--)}return P-G.offset}};for(var I=0.51;I<=1;I+=0.01){var H=(1-Math.pow(I,L))/(1-I);if(H>=2){return K(I-0.01)}}return K(0.75)},getRadius:function(){var F=this.config.radius;if(F!=="auto"){return F}var G=this.canvas.getSize();return Math.min(G.width,G.height)/2},refresh:function(F){if(F){this.reposition();this.graph.eachNode(function(G){G.startPos.rho=G.pos.rho=G.endPos.rho;G.startPos.theta=G.pos.theta=G.endPos.theta})}else{this.compute()}this.plot()},reposition:function(){this.compute("end");var F=this.graph.getNode(this.root).pos.getc().scale(-1);g.Util.moebiusTransformation(this.graph,[F],["end"],"end","ignore");this.graph.eachNode(function(G){if(G.ignore){G.endPos.rho=G.pos.rho;G.endPos.theta=G.pos.theta}})},plot:function(){this.fx.plot()},onClick:function(H,F){var G=this.graph.getNode(H).pos.getc(true);this.move(G,F)},move:function(J,H){var G=x(J.x,J.y);if(this.busy===false&&G.norm()<1){this.busy=true;var F=this.graph.getClosestNodeToPos(G),I=this;this.graph.computeLevels(F.id,0);this.controller.onBeforeCompute(F);H=e.merge({onComplete:e.empty},H||{});this.fx.animate(e.merge({modes:["moebius"],hideLabels:true},H,{onComplete:function(){I.busy=false;H.onComplete()}}),G)}}});$jit.Hypertree.$extend=true;(function(F){F.Op=new v({Implements:g.Op});F.Plot=new v({Implements:g.Plot});F.Label={};F.Label.Native=new v({Implements:g.Label.Native,initialize:function(G){this.viz=G},renderLabel:function(I,K,H){var G=I.getCtx();var L=K.pos.getc(true);var J=this.viz.getRadius();G.fillText(K.name,L.x*J,L.y*J)}});F.Label.SVG=new v({Implements:g.Label.SVG,initialize:function(G){this.viz=G},placeLabel:function(R,L,M){var P=L.pos.getc(true),I=this.viz.canvas,J=I.translateOffsetX,H=I.translateOffsetY,Q=I.scaleOffsetX,O=I.scaleOffsetY,N=I.getSize(),G=this.viz.getRadius();var K={x:Math.round((P.x*Q)*G+J+N.width/2),y:Math.round((P.y*O)*G+H+N.height/2)};R.setAttribute("x",K.x);R.setAttribute("y",K.y);M.onPlaceLabel(R,L)}});F.Label.HTML=new v({Implements:g.Label.HTML,initialize:function(G){this.viz=G},placeLabel:function(S,M,N){var Q=M.pos.getc(true),J=this.viz.canvas,K=J.translateOffsetX,I=J.translateOffsetY,R=J.scaleOffsetX,P=J.scaleOffsetY,O=J.getSize(),G=this.viz.getRadius();var L={x:Math.round((Q.x*R)*G+K+O.width/2),y:Math.round((Q.y*P)*G+I+O.height/2)};var H=S.style;H.left=L.x+"px";H.top=L.y+"px";H.display=this.fitsInCanvas(L,J)?"":"none";N.onPlaceLabel(S,M)}});F.Plot.NodeTypes=new v({none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(I,G){var H=this.node,K=I.getData("dim"),J=I.pos.getc();K=H.transform?K*(1-J.squaredNorm()):K;J.$scale(I.scale);if(K>0.2){this.nodeHelper.circle.render("fill",J,K,G)}},contains:function(G,J){var H=G.getData("dim"),I=G.pos.getc().$scale(G.scale);return this.nodeHelper.circle.contains(I,J,H)}},ellipse:{render:function(J,H){var K=J.pos.getc().$scale(J.scale),I=J.getData("width"),G=J.getData("height");this.nodeHelper.ellipse.render("fill",K,I,G,H)},contains:function(I,K){var H=I.getData("width"),G=I.getData("height"),J=I.pos.getc().$scale(I.scale);return this.nodeHelper.circle.contains(J,K,H,G)}},square:{render:function(I,G){var H=this.node,K=I.getData("dim"),J=I.pos.getc();K=H.transform?K*(1-J.squaredNorm()):K;J.$scale(I.scale);if(K>0.2){this.nodeHelper.square.render("fill",J,K,G)}},contains:function(G,J){var H=G.getData("dim"),I=G.pos.getc().$scale(G.scale);return this.nodeHelper.square.contains(I,J,H)}},rectangle:{render:function(K,H){var J=this.node,I=K.getData("width"),G=K.getData("height"),L=K.pos.getc();I=J.transform?I*(1-L.squaredNorm()):I;G=J.transform?G*(1-L.squaredNorm()):G;L.$scale(K.scale);if(I>0.2&&G>0.2){this.nodeHelper.rectangle.render("fill",L,I,G,H)}},contains:function(I,K){var H=I.getData("width"),G=I.getData("height"),J=I.pos.getc().$scale(I.scale);return this.nodeHelper.rectangle.contains(J,K,H,G)}},triangle:{render:function(I,G){var H=this.node,K=I.getData("dim"),J=I.pos.getc();K=H.transform?K*(1-J.squaredNorm()):K;J.$scale(I.scale);if(K>0.2){this.nodeHelper.triangle.render("fill",J,K,G)}},contains:function(G,J){var H=G.getData("dim"),I=G.pos.getc().$scale(G.scale);return this.nodeHelper.triangle.contains(I,J,H)}},star:{render:function(I,G){var H=this.node,K=I.getData("dim"),J=I.pos.getc();K=H.transform?K*(1-J.squaredNorm()):K;J.$scale(I.scale);if(K>0.2){this.nodeHelper.star.render("fill",J,K,G)}},contains:function(G,J){var H=G.getData("dim"),I=G.pos.getc().$scale(G.scale);return this.nodeHelper.star.contains(I,J,H)}},roundedRectangle:{render:function(L,I){var K=this.node,J=L.getData("width"),H=L.getData("height"),G=L.getData("radius"),M=L.pos.getc();J=K.transform?J*(1-M.squaredNorm()):J;H=K.transform?H*(1-M.squaredNorm()):H;M.$scale(L.scale);if(J>0.2&&H>0.2){this.nodeHelper.roundedRectangle.render("fill",M,J,H,G,I)}},contains:function(J,L){var I=J.getData("width"),H=J.getData("height"),G=J.getData("radius"),K=J.pos.getc().$scale(J.scale);return this.nodeHelper.roundedRectangle.contains(K,L,I,H,G)}}});F.Plot.EdgeTypes=new v({none:e.empty,line:{render:function(G,H){var K=G.nodeFrom.pos.getc(true),J=G.nodeTo.pos.getc(true),I=G.nodeFrom.scale;this.edgeHelper.line.render({x:K.x*I,y:K.y*I},{x:J.x*I,y:J.y*I},H)},contains:function(G,K){var J=G.nodeFrom.pos.getc(true),I=G.nodeTo.pos.getc(true),H=G.nodeFrom.scale;return this.edgeHelper.line.contains({x:J.x*H,y:J.y*H},{x:I.x*H,y:I.y*H},K,this.edge.epsilon)}},arrow:{render:function(H,I){var N=H.nodeFrom.pos.getc(true),M=H.nodeTo.pos.getc(true),J=H.nodeFrom.scale,L=H.getData("dim"),K=H.data.$direction,G=(K&&K.length>1&&K[0]!=H.nodeFrom.id);this.edgeHelper.arrow.render({x:N.x*J,y:N.y*J},{x:M.x*J,y:M.y*J},L,G,I)},contains:function(G,K){var J=G.nodeFrom.pos.getc(true),I=G.nodeTo.pos.getc(true),H=G.nodeFrom.scale;return this.edgeHelper.arrow.contains({x:J.x*H,y:J.y*H},{x:I.x*H,y:I.y*H},K,this.edge.epsilon)}},hyperline:{render:function(G,H){var K=G.nodeFrom.pos.getc(),J=G.nodeTo.pos.getc(),I=this.viz.getRadius();this.edgeHelper.hyperline.render(K,J,I,H)},contains:e.lambda(false)}})})($jit.Hypertree)})();